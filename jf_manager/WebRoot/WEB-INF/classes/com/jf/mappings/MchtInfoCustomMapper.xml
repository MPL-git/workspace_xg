<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jf.dao.MchtInfoCustomMapper">
    <resultMap id="BaseResultCustomMap" type="com.jf.entity.MchtInfoCustom"
               extends="com.jf.dao.MchtInfoMapper.BaseResultMap">
        <result column="mcht_type_desc" property="mchtTypeDesc" jdbcType="VARCHAR"/>
        <result column="is_manage_self_desc" property="isManageSelfDesc" jdbcType="VARCHAR"/>
        <result column="status_desc" property="statusDesc" jdbcType="VARCHAR"/>
        <result column="is_company_inf_perfect_desc" property="isCompanyInfPerfectDesc" jdbcType="VARCHAR"/>
        <result column="tax_invoice_audit_status" property="taxInvoiceAuditStatus" jdbcType="VARCHAR"/>
        <result column="tax_invoice_audit_status_desc" property="taxInvoiceAuditStatusDesc" jdbcType="VARCHAR"/>
        <result column="mcht_product_type" property="mchtProductType" jdbcType="VARCHAR"/>
        <result column="mcht_product_brand" property="mchtProductBrand" jdbcType="VARCHAR"/>
        <result column="contact_province_name" property="contactProvinceName" jdbcType="VARCHAR"/>
        <result column="contact_city_name" property="contactCityName" jdbcType="VARCHAR"/>
        <result column="contact_county_name" property="contactCountyName" jdbcType="VARCHAR"/>
        <result column="reg_fee_type_desc" property="regFeeTypeDesc" jdbcType="VARCHAR"/>
        <result column="pic_count" property="mchtblpic" jdbcType="VARCHAR"/>
        <result column="total_audit_status_desc" property="totalAuditStatusDesc" jdbcType="VARCHAR"/>
        <result column="shop_type_desc" property="shopTypeDesc" jdbcType="VARCHAR"/>
        <result column="shop_name_audit_status_desc" property="shopNameAuditStatusDesc" jdbcType="VARCHAR"/>
        <result column="total_audit_statusdesc" property="totalAuditStatusdesc" jdbcType="VARCHAR"/>

        <result column="zs_contact_name" property="zsContactName" jdbcType="VARCHAR"/>
        <result column="yy_contact_name" property="yyContactName" jdbcType="VARCHAR"/>
        <result column="dd_contact_name" property="ddContactName" jdbcType="VARCHAR"/>
        <result column="sh_contact_name" property="shContactName" jdbcType="VARCHAR"/>
        <result column="cw_contact_name" property="cwContactName" jdbcType="VARCHAR"/>
        <result column="kf_contact_name" property="kfContactName" jdbcType="VARCHAR"/>
        <result column="fw_contact_name" property="fwContactName" jdbcType="VARCHAR"/>
        <result column="sj_contact_name" property="sjContactName" jdbcType="VARCHAR"/>
        <result column="zs_mobile" property="zsMobile" jdbcType="VARCHAR"/>
        <result column="yy_mobile" property="yyMobile" jdbcType="VARCHAR"/>
        <result column="dd_mobile" property="ddMobile" jdbcType="VARCHAR"/>
        <result column="sh_mobile" property="shMobile" jdbcType="VARCHAR"/>
        <result column="cw_mobile" property="cwMobile" jdbcType="VARCHAR"/>
        <result column="kf_mobile" property="kfMobile" jdbcType="VARCHAR"/>
        <result column="fw_mobile" property="fwMobile" jdbcType="VARCHAR"/>
        <result column="sj_mobile" property="sjMobile" jdbcType="VARCHAR"/>

        <result column="ds_mcht_contact_name" property="dsMchtContactName" jdbcType="VARCHAR"/>
        <result column="yy_mcht_contact_name" property="yyMchtContactName" jdbcType="VARCHAR"/>
        <result column="dd_mcht_contact_name" property="ddMchtContactName" jdbcType="VARCHAR"/>
        <result column="sh_mcht_contact_name" property="shMchtContactName" jdbcType="VARCHAR"/>
        <result column="cw_mcht_contact_name" property="cwMchtContactName" jdbcType="VARCHAR"/>
        <result column="kf_mcht_contact_name" property="kfMchtContactName" jdbcType="VARCHAR"/>

        <result column="ds_mcht_mobile" property="dsMchtMobile" jdbcType="VARCHAR"/>
        <result column="yy_mcht_mobile" property="yyMchtMobile" jdbcType="VARCHAR"/>
        <result column="dd_mcht_mobile" property="ddMchtMobile" jdbcType="VARCHAR"/>
        <result column="sh_mcht_mobile" property="shMchtMobile" jdbcType="VARCHAR"/>
        <result column="cw_mcht_mobile" property="cwMchtMobile" jdbcType="VARCHAR"/>
        <result column="kf_mcht_mobile" property="kfMchtMobile" jdbcType="VARCHAR"/>

        <result column="ds_mcht_qq" property="dsMchtQq" jdbcType="VARCHAR"/>
        <result column="yy_mcht_qq" property="yyMchtQq" jdbcType="VARCHAR"/>
        <result column="dd_mcht_qq" property="ddMchtQq" jdbcType="VARCHAR"/>
        <result column="sh_mcht_qq" property="shMchtQq" jdbcType="VARCHAR"/>
        <result column="cw_mcht_qq" property="cwMchtQq" jdbcType="VARCHAR"/>
        <result column="kf_mcht_qq" property="kfMchtQq" jdbcType="VARCHAR"/>

        <result column="ds_mcht_email" property="dsMchtEmail" jdbcType="VARCHAR"/>
        <result column="yy_mcht_email" property="yyMchtEmail" jdbcType="VARCHAR"/>
        <result column="dd_mcht_email" property="ddMchtEmail" jdbcType="VARCHAR"/>
        <result column="sh_mcht_email" property="shMchtEmail" jdbcType="VARCHAR"/>
        <result column="cw_mcht_email" property="cwMchtEmail" jdbcType="VARCHAR"/>
        <result column="kf_mcht_email" property="kfMchtEmail" jdbcType="VARCHAR"/>

        <result column="mcht_user_code" property="mchtUserCode" jdbcType="VARCHAR"/>
        <result column="mcht_user_name" property="mchtUserName" jdbcType="VARCHAR"/>
        <result column="mcht_mobile" property="mchtMobile" jdbcType="VARCHAR"/>
        <result column="mcht_email" property="mchtEmail" jdbcType="VARCHAR"/>

        <result column="settled_contact_name" property="settledContactName" jdbcType="VARCHAR"/>
        <result column="settled_phone" property="settledPhone" jdbcType="VARCHAR"/>
        <result column="settled_email" property="settledEmail" jdbcType="VARCHAR"/>
        <result column="settled_tmall_shop" property="settledTmallShop" jdbcType="VARCHAR"/>
        <result column="settled_taobao_shop" property="settledTaobaoShop" jdbcType="VARCHAR"/>
        <result column="settled_jd_shop" property="settledJdShop" jdbcType="VARCHAR"/>
        <result column="settled_vips_shop" property="settledVipsShop" jdbcType="VARCHAR"/>
        <result column="settled_other_shop" property="settledOtherShop" jdbcType="VARCHAR"/>

        <result column="each_day" property="eachDay" jdbcType="VARCHAR"/>
        <result column="mcht_count" property="mchtcount" jdbcType="INTEGER"/>
        <result column="settled_count" property="settledcount" jdbcType="INTEGER"/>
        <result column="commitauditdate_count" property="commitauditdatecount" jdbcType="INTEGER"/>
        <result column="qualificationthrough_count" property="qualificationthroughcount" jdbcType="INTEGER"/>
        <result column="cooperatebegindate_count" property="cooperatebegindatecount" jdbcType="INTEGER"/>
        <result column="settledun_submitted" property="settledunsubmitted" jdbcType="INTEGER"/>
        <result column="settledau_dited" property="settledaudited" jdbcType="INTEGER"/>
        <result column="settleda_dopt" property="settledadopt" jdbcType="INTEGER"/>
        <result column="shop_open" property="shopopen" jdbcType="INTEGER"/>
        <result column="contract_file" property="contractfile" jdbcType="INTEGER"/>

        <result column="xiaoneng_bus_id" property="xiaonengBusId" jdbcType="INTEGER"/>
        <result column="xiaoneng_code" property="xiaonengCode" jdbcType="VARCHAR"/>
        <result column="xiaoneng_status" property="xiaonengStatus" jdbcType="VARCHAR"/>
        <result column="xiaoneng_mcht_name" property="xiaonengMchtName" jdbcType="VARCHAR"/>


        <result column="product_name" property="productname" jdbcType="VARCHAR"/>
        <result column="general_qualification" property="generalqualification" jdbcType="INTEGER"/>
        <result column="open_to_open" property="opentoopen" jdbcType="INTEGER"/>
        <result column="already_opened" property="alreadyopened" jdbcType="INTEGER"/>
        <result column="contract_filing" property="contractfiling" jdbcType="INTEGER"/>
        <result column="sendback" property="sendback" jdbcType="INTEGER"/>
        <result column="shop" property="shop" jdbcType="INTEGER"/>
        <result column="unsubmitted" property="unsubmitted" jdbcType="INTEGER"/>
        <result column="submission" property="submission" jdbcType="INTEGER"/>
        <result column="cancell_ation" property="cancellation" jdbcType="INTEGER"/>

        <result column="sum_quantity" property="sumQuantity" jdbcType="INTEGER"/>
        <result column="avg_product_score" property="avgProductScore" jdbcType="VARCHAR"/>
        <result column="avg_mcht_score" property="avgMchtScore" jdbcType="VARCHAR"/>
        <result column="avg_wuliu_score" property="avgWuliuScore" jdbcType="VARCHAR"/>
        <result column="grade_desc" property="gradeDesc" jdbcType="VARCHAR"/>
        <result column="mcht_close_application_id" property="mchtCloseApplicationId" jdbcType="VARCHAR"/>
        <result column="mcht_product_brand_name" property="mchtProductBrandName" jdbcType="VARCHAR"/>
        <result column="shop_status_desc" property="shopStatusDesc" jdbcType="VARCHAR"/>
        <result column="activity_auth_status_desc" property="activityAuthStatusDesc" jdbcType="VARCHAR"/>
        <result column="degree_adaptability_desc" property="degreeAdaptabilityDesc" jdbcType="VARCHAR"/>
        <result column="mcht_optimize_operate_remarks" property="mchtOptimizeOperateRemarks" jdbcType="VARCHAR"/>
        <result column="audit_risk_desc" property="auditRiskDesc" jdbcType="VARCHAR"/>
        <result column="resource_grade_desc" property="resourceGradeDesc" jdbcType="VARCHAR"/>
        <result column="spop_mcht_product_brand_name" property="spopmchtProductBrandName" jdbcType="VARCHAR"/>

        <result column="mcht_optimize_deposit_remarks" property="mchtOptimizeDepositRemarks" jdbcType="VARCHAR"/>
        <result column="mcht_optimize_gross_profit_rate_remarks" property="mchtOptimizeGrossProfitRateRemarks"
                jdbcType="VARCHAR"/>
        <result column="mcht_optimize_product_remarks" property="mchtOptimizeProductRemarks" jdbcType="VARCHAR"/>
        <result column="mcht_optimize_service_remarks" property="mchtOptimizeServiceRemarks" jdbcType="VARCHAR"/>
        <result column="mcht_optimize_wuliu_remarks" property="mchtOptimizeWuliuRemarks" jdbcType="VARCHAR"/>
        <result column="mcht_optimize_spread_remarks" property="mchtOptimizeSpreadRemarks" jdbcType="VARCHAR"/>

        <result column="each_month" property="eachMonth" jdbcType="VARCHAR"/>
        <result column="mcht_Count" property="mchtCount" jdbcType="INTEGER"/>
        <result column="settledun_Submitted" property="settledunSubmitted" jdbcType="INTEGER"/>
        <result column="settle_Daudited" property="settleDaudited" jdbcType="INTEGER"/>
        <result column="settle_Dadopt" property="settleDadopt" jdbcType="INTEGER"/>
        <result column="shop_Open" property="shopOpen" jdbcType="INTEGER"/>
        <result column="contract_File" property="contractFile" jdbcType="INTEGER"/>
        <result column="mchtclose_Application" property="mchtcloseApplication" jdbcType="INTEGER"/>
        <result column="mchtclose_Count" property="mchtcloseCount" jdbcType="INTEGER"/>
        <result column="settled_Count" property="settledCount" jdbcType="INTEGER"/>
        <result column="popcommitaudit_Count" property="popcommitauditCount" jdbcType="INTEGER"/>
        <result column="popqualificationthrough_Count" property="popqualificationthroughCount" jdbcType="INTEGER"/>
        <result column="popcooperatebegin_Count" property="popcooperatebeginCount" jdbcType="INTEGER"/>
        <result column="popmchtclose_AppliCation" property="popmchtcloseAppliCation" jdbcType="INTEGER"/>
        <result column="popmchtclose_Count" property="popmchtcloseCount" jdbcType="INTEGER"/>
        <result column="license_status_desc" property="licenseStatusDesc" jdbcType="VARCHAR"/>
        <result column="product_type_name" property="productTypeName" jdbcType="VARCHAR"/>
        <result column="product_type_id" property="productTypeId" jdbcType="INTEGER"/>

        <result column="productbrand_name" property="productbrandName" jdbcType="VARCHAR"/>
        <result column="degreeadaptability_desc" property="degreeadaptabilitydDesc" jdbcType="VARCHAR"/>
        <result column="degree_audit_risk_desc" property="degreeAuditriskDesc" jdbcType="VARCHAR"/>

        <result column="days" property="days" jdbcType="INTEGER"/>
        <result column="send_date" property="sendDate" jdbcType="TIMESTAMP"/>
        <result column="contract_code" property="contractCode" jdbcType="VARCHAR"/>
        <result column="contract_begin_date" property="contractBeginDate" jdbcType="VARCHAR"/>
        <result column="contract_end_date" property="contractEndDate" jdbcType="VARCHAR"/>

        <result column="customer_service_order_rateB" property="customerServiceOrderRateB" jdbcType="DECIMAL"/>
        <result column="customer_service_order_rateC" property="customerServiceOrderRateC" jdbcType="DECIMAL"/>
        <result column="customer_service_order_rateA" property="customerServiceOrderRateA" jdbcType="DECIMAL"/>
        <result column="product_applauserate" property="productApplauseRate" jdbcType="DECIMAL"/>


        <result column="member_visitors_num" property="memberVisitorsNum" jdbcType="INTEGER" />
        <result column="unmember_visitors_num" property="unmemberVisitorsNum" jdbcType="INTEGER" />
        <result column="member_page_view" property="memberPageView" jdbcType="INTEGER" />
        <result column="unmember_page_view" property="unmemberPageView" jdbcType="INTEGER" />
        <result column="payment_amount" property="paymentAmount" jdbcType="INTEGER" />
        <result column="add_product_num" property="addProductNum" jdbcType="INTEGER" />
        <result column="submit_order_num" property="submitOrderNum" jdbcType="INTEGER" />
        <result column="add_product_rate" property="addProductRate" jdbcType="VARCHAR" />
        <result column="submit_order_rate" property="submitOrderRate" jdbcType="VARCHAR" />
        <result column="payment_rate" property="paymentRate" jdbcType="VARCHAR" />
        <result column="pay_money" property="payMoney" jdbcType="DECIMAL" />


    </resultMap>

    <sql id="Base_Column_List">
        a.*,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","MCHT_TYPE", a.mcht_type) mcht_type_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","IS_MANAGE_SELF", a.is_manage_self) is_manage_self_desc,
        (select md.unpay_amt from bu_mcht_deposit md where md.del_flag='0' and md.mcht_id=a.id) unpay_deposit_amt,
        (select md.total_amt from bu_mcht_deposit md where md.del_flag='0' and md.mcht_id=a.id) total_amt,
        (select mc.id from bu_mcht_contract mc where mc.mcht_id=a.id and mc.del_flag='0' order by id desc limit 1)
        mcht_contract_id,
        (select mc.audit_date from bu_mcht_contract mc where mc.mcht_id=a.id and mc.del_flag='0' order by id desc limit
        1) contract_audit_date,
        FUN_GET_STATUS_DESC("BU_MCHT_CONTRACT","AUDIT_STATUS",(select mc.audit_status from bu_mcht_contract mc where
        mc.mcht_id=a.id and mc.del_flag='0' order by id desc limit 1)) contract_audit_status_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_CONTRACT","ARCHIVE_STATUS",(select mc.archive_status from bu_mcht_contract mc where
        mc.mcht_id=a.id and mc.del_flag='0' order by id desc limit 1)) contract_archive_status_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_TAX_INVOICE_INFO","AUDIT_STATUS", (select mtii.audit_status from
        bu_mcht_tax_invoice_info mtii where mtii.mcht_id=a.id and mtii.del_flag='0' limit 1)) tax_status_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_BANK_ACCOUNT","STATUS", (select mba.status from bu_mcht_bank_account mba where
        mba.mcht_id=a.id and mba.del_flag='0' limit 1)) bank_status_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","TOTAL_AUDIT_STATUS", a.total_audit_status) total_audit_status_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","STATUS", a.status) status_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","SHOP_TYPE", a.shop_type) shop_type_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","IS_COMPANY_INF_PERFECT", a.is_company_inf_perfect)
        is_company_inf_perfect_desc,
        (select pa.area_name from bu_p_area pa where pa.area_id = a.contact_province) contact_province_name,
        (select pb.area_name from bu_p_area pb where pb.area_id = a.contact_city) contact_city_name,
        (select pc.area_name from bu_p_area pc where pc.area_id = a.contact_county) contact_county_name,
        (select b.audit_status from bu_mcht_tax_invoice_info b where b.mcht_id=a.id) tax_invoice_audit_status,
        FUN_GET_STATUS_DESC("BU_MCHT_TAX_INVOICE_INFO","AUDIT_STATUS", (select b.audit_status from
        bu_mcht_tax_invoice_info b where b.mcht_id=a.id)) tax_invoice_audit_status_desc,
        (select GROUP_CONCAT(d.name separator ',') from bu_mcht_product_type c, bu_product_type d where c.mcht_id=a.id
        and c.del_flag='0' and c.product_type_id=d.id and d.del_flag=0 and c.is_main='1') mcht_product_type,
        <![CDATA[ (select GROUP_CONCAT(CONCAT('<span style="color:red;">[',FUN_GET_STATUS_DESC("BU_MCHT_PRODUCT_BRAND","AUDIT_STATUS",E.audit_status),']</span>','<span style="color:green;">[',FUN_GET_STATUS_DESC("BU_MCHT_PRODUCT_BRAND","STATUS",E.status),']</span>',f.name) separator '<br>')  from bu_mcht_product_brand e, bu_product_brand f where e.mcht_id=a.id and e.del_flag='0' and e.product_brand_id=f.id and f.del_flag='0') mcht_product_brand,]]>
        <![CDATA[ (select GROUP_CONCAT(CONCAT('<span style="color:red;">[',FUN_GET_STATUS_DESC("BU_MCHT_PRODUCT_BRAND","AUDIT_STATUS",E.audit_status),']</span>','<span style="color:green;">[',FUN_GET_STATUS_DESC("BU_MCHT_PRODUCT_BRAND","STATUS",E.status),']</span>',e.product_brand_name) separator '<br>')  from bu_mcht_product_brand e where e.mcht_id=a.id and e.del_flag='0' and e.product_brand_id is null) product_brand_null,]]>
        (select count(*) from bu_mcht_product_brand m where m.mcht_id=a.id and m.del_flag='0' and m.audit_status='3')
        audit_status_num_3,
        (select count(*) from bu_mcht_product_brand m where m.mcht_id=a.id and m.del_flag='0' and m.audit_status in
        ('0','4')) audit_status_num_0_4,
        (select count(*) from bu_mcht_product_brand m where m.mcht_id=a.id and m.del_flag='0' and m.audit_status in
        ('1','2')) audit_status_num_1_2,
        (select b.user_code from bu_mcht_user b where b.mcht_id = a.id and b.is_primary = '1' and
        b.del_flag='0')user_code,
        (select b.contact_name from bu_mcht_contact b where b.mcht_id = a.id and b.contact_type = '2' and b.del_flag='0'
        LIMIT 1)mcht_contact_name,

        (select c.contact_name from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id
        and b.mcht_id = a.id and c.contact_type = '1' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1)zs_contact_name, <!-- 1 招商对接人 -->
        (select c.contact_name from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id
        and b.mcht_id = a.id and c.contact_type = '2' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1)yy_contact_name, <!-- 2 运营对接人 -->
        (select c.contact_name from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id
        and b.mcht_id = a.id and c.contact_type = '3' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1)dd_contact_name, <!-- 3 订单对接人 -->
        (select c.contact_name from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id
        and b.mcht_id = a.id and c.contact_type = '4' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1)sh_contact_name, <!-- 4 售后对接人 -->
        (select c.contact_name from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id
        and b.mcht_id = a.id and c.contact_type = '5' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1)cw_contact_name, <!-- 5 财务对接人 -->
        (select c.contact_name from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id
        and b.mcht_id = a.id and c.contact_type = '6' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1)kf_contact_name, <!-- 6 客服对接人 -->
        (select c.contact_name from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id
        and b.mcht_id = a.id and c.contact_type = '7' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1)fw_contact_name, <!-- 7 法务对接人 -->
        (select c.contact_name from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id
        and b.mcht_id = a.id and c.contact_type = '8' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1)sj_contact_name, <!-- 8 商家服务专员 -->

        (select c.staff_id from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id and
        b.mcht_id = a.id and c.contact_type = '2' and b.del_flag='0' and c.del_flag='0' and b.status='1' LIMIT
        1)yy_staff_id,
        (select c.staff_id from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id and
        b.mcht_id = a.id and c.contact_type = '1' and b.del_flag='0' and c.del_flag='0' and b.status='1' LIMIT
        1)zs_staff_id,
        (select c.staff_id from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id and
        b.mcht_id = a.id and c.contact_type = '7' and b.del_flag='0' and c.del_flag='0' and b.status='1' LIMIT
        1)fw_staff_id,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","SHOP_NAME_AUDIT_STATUS", a.shop_name_audit_status)
        shop_name_audit_status_desc,
        (select pt.name from bu_mcht_product_type mpt, bu_product_type pt where mpt.mcht_id = a.id and mpt.is_main = '1'
        and mpt.del_flag = '0' and mpt.product_type_id = pt.id and pt.del_flag = '0' limit 1 )
        product_type_name, <!-- 主营类目 -->
        (select mca.id from bu_mcht_close_application mca where mca.mcht_id=a.id and mca.del_flag='0' limit
        1)mcht_close_application_id,
        (select GROUP_CONCAT(mpb.product_brand_name) from bu_mcht_product_brand mpb where mpb.mcht_id = a.id and
        mpb.zs_audit_status != 2 and mpb.del_flag = '0')brand_names,
        (select GROUP_CONCAT(mpb.product_brand_name) from bu_mcht_product_brand mpb where mpb.mcht_id = a.id and
        mpb.audit_status != 3 and mpb.del_flag = '0')fw_brand_names,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","GRADE", a.grade) grade_desc,
        (select GROUP_CONCAT(CONCAT(pb.`name`,'（',ROUND(mpb.pop_commission_rate*100),'%）',pb.id)) from
        bu_mcht_product_brand mpb, bu_product_brand pb where mpb.mcht_id = a.id and mpb.del_flag = '0' and
        mpb.product_brand_id = pb.id and pb.del_flag = '0') mcht_product_brand_name,
        (select GROUP_CONCAT(CONCAT(pb.`name`,' ',pb.id)) from
        bu_mcht_product_brand mpb, bu_product_brand pb where mpb.mcht_id = a.id and mpb.del_flag = '0' and
        mpb.product_brand_id = pb.id and pb.del_flag = '0') spop_mcht_product_brand_name, 
        FUN_GET_STATUS_DESC("BU_MCHT_INFO", "SHOP_STATUS", a.shop_status) shop_status_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO", "ACTIVITY_AUTH_STATUS", a.activity_auth_status) activity_auth_status_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_OPTIMIZE", "DEGREE_ADAPTABILITY", (select mo.degree_adaptability from
        bu_mcht_optimize mo where mo.del_flag = '0' and mo.mcht_id = a.id)) degree_adaptability_desc,
        (select mo.operate_remarks from bu_mcht_optimize mo where mo.del_flag = '0' and mo.mcht_id = a.id)
        mcht_optimize_operate_remarks,
        FUN_GET_STATUS_DESC("BU_MCHT_OPTIMIZE", "AUDIT_RISK", (select mo.audit_risk from bu_mcht_optimize mo where
        mo.del_flag = '0' and mo.mcht_id = a.id)) audit_risk_desc
    </sql>

    <select id="selectMchtInfoList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        select
        <if test="distinct">
            distinct
        </if>
        <include refid="Base_Column_List"/>
        from bu_mcht_info a
        where a.del_flag = '0'
        <if test="productTypeIds!='' and productTypeIds!=null">
            and EXISTS(select mpt.id from bu_mcht_product_type mpt where mpt.del_flag = '0' and mpt.mcht_id= a.id AND
            mpt.is_main='1' AND mpt.`status`!=3 AND mpt.product_type_id IN
            <foreach collection="productTypeIds" index="index" item="id" open="(" separator="," close=")">
                #{id}
            </foreach>
            )
        </if>
        <if test="productTypeContactIsNull != '' and productTypeContactIsNull != null">
            and (
            a.id IN(select mpt.mcht_id from sys_staff_product_type spt, bu_mcht_product_type mpt where spt.del_flag =
            '0' and spt.staff_id = #{productTypeContactIsNull }
            and mpt.del_flag = '0' and mpt.is_main = '1' and mpt.product_type_id = spt.product_type_id )
            OR
            a.id IN(select mpc.mcht_id from bu_platform_contact pc, bu_mcht_platform_contact mpc where pc.del_flag = '0'
            and pc.status = '0' and (pc.staff_id = #{productTypeContactIsNull } or pc.assistant_id in(select bpc.id from
            bu_platform_contact bpc where bpc.del_flag = '0' and bpc.status = '0' and bpc.staff_id =
            #{productTypeContactIsNull }) )
            and mpc.del_flag = '0' and mpc.status = '1' and mpc.platform_contact_id = pc.id )
            )
        </if>
        <if test="zs_total_audit_status!='' and zs_total_audit_status!=null">
            and a.zs_total_audit_status =#{zs_total_audit_status}
        </if>
        <if test="total_audit_status_notEqual!='' and total_audit_status_notEqual!=null">
            and a.total_audit_status !=#{total_audit_status_notEqual}
        </if>
        <if test="mcht_type!='' and mcht_type!=null">
            and a.mcht_type =#{mcht_type}
        </if>
        <if test="is_manage_self!='' and is_manage_self!=null">
            and a.is_manage_self =#{is_manage_self}
        </if>
        <if test="status!='' and status!=null">
            and a.status =#{status}
        </if>
        <if test="grade != '' and grade != null">
            and a.grade = #{grade }
        </if>
        <if test="not_equals_status!='' and not_equals_status!=null">
            and a.status != #{not_equals_status}
        </if>
        <if test="is_company_inf_perfect!='' and is_company_inf_perfect!=null">
            and a.is_company_inf_perfect =#{is_company_inf_perfect}
        </if>
        <if test="shop_name_audit_status!='' and shop_name_audit_status!=null">
            and a.shop_name_audit_status =#{shop_name_audit_status}
        </if>
        <if test="total_audit_status!='' and total_audit_status!=null">
            and a.total_audit_status =#{total_audit_status}
        </if>
        <if test="total_audit_status_not!='' and total_audit_status_not!=null">
            and a.total_audit_status <![CDATA[ <> ]]>#{total_audit_status_not}
        </if>
        <if test="total_audit_status_not_in!='' and total_audit_status_not_in!=null">
            and a.total_audit_status not in (#{total_audit_status_not_in})
        </if>
        <if test="status_in!='' and status_in!=null">
            and a.status in
            <foreach collection="statusList" index="index" item="status" open="(" separator="," close=")">
                #{status}
            </foreach>
        </if>
        <if test="andWhereClause!='' and andWhereClause!=null">
            and ${andWhereClause}
        </if>
        <if test="in_blacklist!='' and in_blacklist!=null">
            and a.in_blacklist =#{in_blacklist}
        </if>
        <if test="productType!='' and productType!=null">
            and #{productType} in (select b.product_type_id from bu_mcht_product_type b where b.mcht_id=a.id and
            b.del_flag='0')
        </if>
        <if test="productBrandName!='' and productBrandName!=null">
            and a.id in (select b.mcht_id from bu_mcht_product_brand b, bu_product_brand c where b.product_brand_id=c.id
            and b.del_flag='0' and c.name like concat('%',#{productBrandName,jdbcType=VARCHAR},'%'))
        </if>
        <if test="shortName!='' and shortName!=null">
            and a.short_name like concat('%',#{shortName},'%')
        </if>
        <if test="mcht_code!='' and mcht_code!=null">
            and a.mcht_code =#{mcht_code}
        </if>
        <if test="company_name!='' and company_name!=null">
            and a.company_name like concat('%',#{company_name},'%')
        </if>
        <if test="shop_name!='' and shop_name!=null">
            and a.shop_name like concat('%',#{shop_name},'%')
        </if>
        <if test="mchtcodelist!='' and mchtcodelist!=null">
            and a.mcht_code in
            <foreach collection="mchtCodeList" index="index" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="companyOrShop!='' and companyOrShop!=null">
            and (a.company_name like concat('%',#{companyOrShop,jdbcType=VARCHAR},'%')
            or a.shop_name like concat('%',#{companyOrShop,jdbcType=VARCHAR},'%')
            )
        </if>
        <if test="mcht_name!='' and mcht_name!=null">
            and (a.short_name like concat('%',#{mcht_name,jdbcType=VARCHAR},'%')
            or a.company_name like concat('%',#{mcht_name,jdbcType=VARCHAR},'%')
            or a.shop_name like concat('%',#{mcht_name,jdbcType=VARCHAR},'%')
            )
        </if>
        <if test="platContactId!='' and platContactId != null">
            and EXISTS (select mi.mcht_id from bu_mcht_platform_contact mi where mi.mcht_id=a.id and mi.status='1' and
            mi.del_flag='0' and mi.platform_contact_id = #{platContactId} )
        </if>
        <if test="productTypeId != '' and productTypeId != null">    <!-- 主营类目 -->
            and EXISTS (select mpt.id from bu_mcht_product_type mpt where mpt.mcht_id = a.id and mpt.is_main = '1' and
            mpt.del_flag = '0' and mpt.product_type_id = #{productTypeId } )
        </if>
        <if test="deposit_status!='' and deposit_status!=null">
            <if test="deposit_status==1">
                and EXISTS(select md.id from bu_mcht_deposit md where md.mcht_id=a.id and md.unpay_amt>0) and
                a.deposit_type='2'
            </if>

            <if test="deposit_status==2">
                and EXISTS(select md.id from bu_mcht_deposit md where md.mcht_id=a.id and md.unpay_amt>0) and
                a.deposit_type='1'
            </if>

            <if test="deposit_status==3">
                and EXISTS(select md.id from bu_mcht_deposit md where md.mcht_id=a.id and md.unpay_amt<![CDATA[ <= ]]>0)
            </if>

            <if test="deposit_status==4">
                and EXISTS(select md.id from bu_mcht_deposit md where md.mcht_id=a.id and
                md.contract_deposit!=md.total_amt)
            </if>
        </if>
        <if test="endYear!='' and endYear!=null">
            and DATE_FORMAT(a.agreement_end_date,'%Y') = #{endYear,jdbcType=VARCHAR}
        </if>
        <if test="endMonth!='' and endMonth!=null">
            and DATE_FORMAT(a.agreement_end_date,'%m') = #{endMonth,jdbcType=VARCHAR}
        </if>
        <if test="updatedateBegin!='' and updatedateBegin!=null">
            and DATE_FORMAT(a.create_date,'%Y-%m-%d') <![CDATA[ >= ]]> #{updatedateBegin,jdbcType=VARCHAR}
        </if>
        <if test="updatedateEnd!='' and updatedateEnd!=null">
            and DATE_FORMAT(a.create_date,'%Y-%m-%d') <![CDATA[ <= ]]> #{updatedateEnd,jdbcType=VARCHAR}
        </if>
        <if test="statusNot!='' and statusNot!=null">
            and status <![CDATA[ <> ]]> #{statusNot,jdbcType=VARCHAR}
        </if>
        <if test="contract_audit_status!='' and contract_audit_status!=null">
            and (select mc.audit_status from bu_mcht_contract mc where mc.mcht_id=a.id and mc.del_flag='0' order by id
            desc limit 1)=#{contract_audit_status,jdbcType=VARCHAR}
        </if>
        <if test="contract_archive_status!='' and contract_archive_status!=null">
            and (select mc.archive_status from bu_mcht_contract mc where mc.mcht_id=a.id and mc.del_flag='0' order by id
            desc limit 1)=#{contract_archive_status,jdbcType=VARCHAR}
        </if>
        <if test="financeConfirmStatus!=null">
            and a.finance_confirm_status = #{financeConfirmStatus}
        </if>
        <if test="commitAuditDateNotNull != null">
            and a.commit_audit_date is not null
        </if>
        <if test="zsAuditStatusIsNull != null">
            and (a.zs_audit_status is null or a.zs_audit_status = '0')
        </if>
        <if test="zs_commit_audit_date_begin !='' and zs_commit_audit_date_begin != null">
            and a.zs_commit_audit_date <![CDATA[ >= ]]>#{zs_commit_audit_date_begin}
        </if>
        <if test="zs_commit_audit_date_end !='' and zs_commit_audit_date_end != null">
            and a.zs_commit_audit_date <![CDATA[ <= ]]>#{zs_commit_audit_date_end}
        </if>
        <if test="commit_audit_date_begin !='' and commit_audit_date_begin != null">
            and a.commit_audit_date <![CDATA[ >= ]]>#{commit_audit_date_begin}
        </if>
        <if test="commit_audit_date_end !='' and commit_audit_date_end != null">
            and a.commit_audit_date <![CDATA[ <= ]]>#{commit_audit_date_end}
        </if>
        <if test="zs_audit_status != null">
            and a.zs_audit_status = #{zs_audit_status}
        </if>
        <if test="in_zs_platform_contact_ids != '' and in_zs_platform_contact_ids != null">
            and a.id in(select mpc.mcht_id from bu_mcht_platform_contact mpc, bu_platform_contact pc where mpc.del_flag
            = '0' and pc.del_flag = '0' and mpc.status = '1' and pc.contact_type = '1' and pc.status = '0' and
            mpc.platform_contact_id = pc.id and pc.id in(${in_zs_platform_contact_ids}) )
        </if>
        <if test="zs_platform_contact_id != '' and zs_platform_contact_id != null">
            and a.id in(select mpc.mcht_id from bu_mcht_platform_contact mpc, bu_platform_contact pc where mpc.del_flag
            = '0' and pc.del_flag = '0' and mpc.status = '1' and pc.contact_type = '1' and pc.status = '0' and
            mpc.platform_contact_id = pc.id and pc.id = ${zs_platform_contact_id} )
        </if>
        <if test="fw_platform_contact_id != '' and fw_platform_contact_id != null">
            and a.id in(select mpc.mcht_id from bu_mcht_platform_contact mpc, bu_platform_contact pc where mpc.del_flag
            = '0' and pc.del_flag = '0' and mpc.status = '1' and pc.contact_type = '7' and pc.status = '0' and
            mpc.platform_contact_id = pc.id and pc.id = ${fw_platform_contact_id} )
        </if>
        <if test="zs_total_audit_status_notEqual != null">
            and a.zs_total_audit_status !=#{zs_total_audit_status_notEqual}
        </if>
        <if test="my_audit_product_type_staff_id != '' and my_audit_product_type_staff_id != null">
            and EXISTS (select mpt.id from sys_staff_product_type spt, bu_mcht_product_type mpt where spt.del_flag = '0'
            and spt.staff_id = #{my_audit_product_type_staff_id} and spt.product_type_id = mpt.product_type_id and
            mpt.del_flag = '0' and mpt.is_main = '1' and mpt.mcht_id = a.id )
        </if>
        <if test="audit_risk != '' and audit_risk != null">
            and a.id in(select mo.mcht_id from bu_mcht_optimize mo where mo.del_flag = '0' and mo.audit_risk =
            #{audit_risk })
        </if>
        <if test="degree_adaptability != '' and degree_adaptability != null">
            and a.id in(select mo.mcht_id from bu_mcht_optimize mo where mo.del_flag = '0' and mo.degree_adaptability =
            #{degree_adaptability })
        </if>
        <if test="company_inf_audit_inner_status == 1">
            and (a.company_inf_audit_inner_remarks = '' or a.company_inf_audit_inner_remarks is null)
        </if>
        <if test="company_inf_audit_inner_status == 2">
            and a.company_inf_audit_inner_remarks != '' and a.company_inf_audit_inner_remarks is not null
        </if>
        <if test="platContactStaffId != '' and platContactStaffId != null">
            and a.id IN(select mpc.mcht_id from bu_platform_contact pc, bu_mcht_platform_contact mpc where pc.del_flag =
            '0' and pc.status = '0' and (pc.staff_id = #{platContactStaffId } or pc.assistant_id in(select bpc.id from
            bu_platform_contact bpc where bpc.del_flag = '0' and bpc.status = '0' and bpc.staff_id =
            #{platContactStaffId }) )
            and mpc.del_flag = '0' and mpc.status = '1' and mpc.platform_contact_id = pc.id )
        </if>
        <if test="cooperateBeginDateBegin != '' and cooperateBeginDateBegin != null">
            and a.cooperate_begin_date<![CDATA[ >= ]]>#{cooperateBeginDateBegin}
        </if>
        <if test="cooperateBeginDateEnd != '' and cooperateBeginDateEnd != null">
            and a.cooperate_begin_date<![CDATA[ <= ]]>#{cooperateBeginDateEnd}
        </if>
        <if test="closeDateBegin != '' and closeDateBegin != null">
            and a.status ='3' and a.status_date<![CDATA[ >= ]]>#{closeDateBegin}
        </if>
        <if test="closeDateEnd != '' and closeDateEnd != null">
            and a.status ='3' and a.status_date<![CDATA[ <= ]]>#{closeDateEnd}
        </if>
        <if test="yearlyInspectionDateLessThan != '' and yearlyInspectionDateLessThan != null">
            and a.yearly_inspection_date<![CDATA[ < ]]>#{yearlyInspectionDateLessThan}
        </if>
        <if test="yearlyInspectionDateMoreThans != '' and yearlyInspectionDateMoreThans != null and yearlyInspectionDateLessThans != '' and yearlyInspectionDateLessThans != null and corporationIdcardDateMoreThans != '' and corporationIdcardDateMoreThans != null and corporationIdcardDateLessThans != '' and corporationIdcardDateLessThans != null">
            and (a.yearly_inspection_date<![CDATA[ > ]]>#{yearlyInspectionDateMoreThans} and a.yearly_inspection_date
            <![CDATA[ <= ]]>#{yearlyInspectionDateLessThans} or a.corporation_idcard_date<![CDATA[ > ]]>
            #{corporationIdcardDateMoreThans} and a.yearly_inspection_date<![CDATA[ <= ]]>
            #{corporationIdcardDateLessThans})
        </if>
        <if test="settledType != '' and settledType != null">
            and a.settled_type=#{settledType}
        </if>
        <if test="isManageSelf != '' and isManageSelf != null">
            and a.is_manage_self=#{isManageSelf}
        </if>
        <if test="delay_status != '' and delay_status != null">
            and a.delay_status=#{delay_status}
        </if>
        <if test="orderByClause != null">
            order by ${orderByClause}
        </if>
        <if test="MAX_NUM!=null and MAX_NUM!=''">
            limit #{MIN_NUM},#{MAX_NUM}
        </if>
    </select>

    <select id="selectMchtInfoListCount" resultType="Integer" parameterType="map">
        select count(*)
        from bu_mcht_info a
        where a.del_flag='0'
        <if test="mcht_type!='' and mcht_type!=null">
            and a.mcht_type =#{mcht_type}
        </if>
        <if test="is_manage_self!='' and is_manage_self!=null">
            and a.is_manage_self =#{is_manage_self}
        </if>
        <if test="status!='' and status!=null">
            and a.status =#{status}
        </if>
        <if test="is_company_inf_perfect!='' and is_company_inf_perfect!=null">
            and a.is_company_inf_perfect =#{is_company_inf_perfect}
        </if>
        <if test="productType!='' and productType!=null">
            and #{productType} in (select b.product_type_id from bu_mcht_product_type b where b.mcht_id=a.id and
            b.del_flag='0')
        </if>
        <if test="productBrandName!='' and productBrandName!=null">
            and a.id in (select b.mcht_id from bu_mcht_product_brand b, bu_product_brand c where b.product_brand_id=c.id
            and b.del_flag='0' and c.name like concat('%',#{productBrandName,jdbcType=VARCHAR},'%'))
        </if>
        <if test="shortName!='' and shortName!=null">
            and a.short_name like concat('%',#{shortName},'%')
        </if>
        <if test="mcht_code!='' and mcht_code!=null">
            and a.mcht_code =#{mcht_code}
        </if>
        <if test="mcht_name!='' and mcht_name!=null">
            and (a.short_name like concat('%',#{mcht_name,jdbcType=VARCHAR},'%')
            or a.company_name like concat('%',#{mcht_name,jdbcType=VARCHAR},'%'))
        </if>
        <if test="platContactId!='' and platContactId!=null">
            and EXISTS (select mi.mcht_id from bu_mcht_platform_contact mi where mi.mcht_id=a.id and
            mi.platform_contact_id=#{platContactId})
        </if>
    </select>

    <select id="queryMchtCount" parameterType="java.util.HashMap" resultType="String">
        select count(*) totalnum
        from bu_mcht_info a
        where a.del_flag = '0'
        <if test="productTypeIds!='' and productTypeIds!=null">
            and EXISTS(select mpt.id from bu_mcht_product_type mpt where mpt.del_flag = '0' and mpt.mcht_id= a.id AND
            mpt.is_main='1' AND mpt.`status`!=3 AND mpt.product_type_id IN
            <foreach collection="productTypeIds" index="index" item="id" open="(" separator="," close=")">
                #{id}
            </foreach>
            )
        </if>
        <if test="productTypeContactIsNull != '' and productTypeContactIsNull != null">
            and (
            a.id IN(select mpt.mcht_id from sys_staff_product_type spt, bu_mcht_product_type mpt where spt.del_flag =
            '0' and spt.staff_id = #{productTypeContactIsNull }
            and mpt.del_flag = '0' and mpt.is_main = '1' and mpt.product_type_id = spt.product_type_id )
            OR
            a.id IN(select mpc.mcht_id from bu_platform_contact pc, bu_mcht_platform_contact mpc where pc.del_flag = '0'
            and pc.status = '0' and (pc.staff_id = #{productTypeContactIsNull } or pc.assistant_id in(select bpc.id from
            bu_platform_contact bpc where bpc.del_flag = '0' and bpc.status = '0' and bpc.staff_id =
            #{productTypeContactIsNull }) )
            and mpc.del_flag = '0' and mpc.status = '1' and mpc.platform_contact_id = pc.id )
            )
        </if>
        <if test="zs_total_audit_status!='' and zs_total_audit_status!=null">
            and a.zs_total_audit_status =#{zs_total_audit_status}
        </if>
        <if test="total_audit_status_notEqual!='' and total_audit_status_notEqual!=null">
            and a.total_audit_status !=#{total_audit_status_notEqual}
        </if>
        <if test="mcht_type!='' and mcht_type!=null">
            and a.mcht_type =#{mcht_type}
        </if>
        <if test="is_manage_self!='' and is_manage_self!=null">
            and a.is_manage_self =#{is_manage_self}
        </if>
        <if test="status!='' and status!=null">
            and a.status =#{status}
        </if>
        <if test="grade != '' and grade != null">
            and a.grade = #{grade }
        </if>
        <if test="not_equals_status!='' and not_equals_status!=null">
            and a.status != #{not_equals_status}
        </if>
        <if test="is_company_inf_perfect!='' and is_company_inf_perfect!=null">
            and a.is_company_inf_perfect =#{is_company_inf_perfect}
        </if>
        <if test="shop_name_audit_status!='' and shop_name_audit_status!=null">
            and a.shop_name_audit_status =#{shop_name_audit_status}
        </if>
        <if test="total_audit_status!='' and total_audit_status!=null">
            and a.total_audit_status =#{total_audit_status}
        </if>
        <if test="total_audit_status_not!='' and total_audit_status_not!=null">
            and a.total_audit_status <![CDATA[ <> ]]>#{total_audit_status_not}
        </if>
        <if test="total_audit_status_not_in!='' and total_audit_status_not_in!=null">
            and a.total_audit_status not in (#{total_audit_status_not_in})
        </if>
        <if test="status_in!='' and status_in!=null">
            and a.status in
            <foreach collection="statusList" index="index" item="status" open="(" separator="," close=")">
                #{status}
            </foreach>
        </if>
        <if test="andWhereClause!='' and andWhereClause!=null">
            and ${andWhereClause}
        </if>
        <if test="in_blacklist!='' and in_blacklist!=null">
            and a.in_blacklist =#{in_blacklist}
        </if>
        <if test="productType!='' and productType!=null">
            and #{productType} in (select b.product_type_id from bu_mcht_product_type b where b.mcht_id=a.id and
            b.del_flag='0')
        </if>
        <if test="productBrandName!='' and productBrandName!=null">
            and a.id in (select b.mcht_id from bu_mcht_product_brand b, bu_product_brand c where b.product_brand_id=c.id
            and b.del_flag='0' and c.name like concat('%',#{productBrandName,jdbcType=VARCHAR},'%'))
        </if>
        <if test="shortName!='' and shortName!=null">
            and a.short_name like concat('%',#{shortName},'%')
        </if>
        <if test="mcht_code!='' and mcht_code!=null">
            and a.mcht_code =#{mcht_code}
        </if>
        <if test="company_name!='' and company_name!=null">
            and a.company_name like concat('%',#{company_name},'%')
        </if>
        <if test="shop_name!='' and shop_name!=null">
            and a.shop_name like concat('%',#{shop_name},'%')
        </if>
        <if test="mchtcodelist!='' and mchtcodelist!=null">
            and a.mcht_code in
            <foreach collection="mchtCodeList" index="index" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="mcht_name!='' and mcht_name!=null">
            and (a.short_name like concat('%',#{mcht_name,jdbcType=VARCHAR},'%')
            or a.company_name like concat('%',#{mcht_name,jdbcType=VARCHAR},'%')
            or a.shop_name like concat('%',#{mcht_name,jdbcType=VARCHAR},'%')
            )
        </if>
        <if test="platContactId!='' and platContactId!=null">
            and EXISTS (select mi.mcht_id from bu_mcht_platform_contact mi where mi.mcht_id=a.id and mi.status='1' and
            mi.del_flag='0' and mi.platform_contact_id = #{platContactId} )
        </if>
        <if test="productTypeId != '' and productTypeId != null">    <!-- 主营类目 -->
            and EXISTS (select mpt.id from bu_mcht_product_type mpt where mpt.mcht_id = a.id and mpt.is_main = '1' and
            mpt.del_flag = '0' and mpt.product_type_id = #{productTypeId } )
        </if>
        <if test="deposit_status!='' and deposit_status!=null">
            <if test="deposit_status==1">
                and EXISTS(select md.id from bu_mcht_deposit md where md.mcht_id=a.id and md.unpay_amt>0) and
                a.deposit_type='2'
            </if>

            <if test="deposit_status==2">
                and EXISTS(select md.id from bu_mcht_deposit md where md.mcht_id=a.id and md.unpay_amt>0) and
                a.deposit_type='1'
            </if>

            <if test="deposit_status==3">
                and EXISTS(select md.id from bu_mcht_deposit md where md.mcht_id=a.id and md.unpay_amt<![CDATA[ <= ]]>0)
            </if>

            <if test="deposit_status==4">
                and EXISTS(select md.id from bu_mcht_deposit md where md.mcht_id=a.id and
                md.contract_deposit!=md.total_amt)
            </if>
        </if>
        <if test="endYear!='' and endYear!=null">
            and DATE_FORMAT(a.agreement_end_date,'%Y') = #{endYear,jdbcType=VARCHAR}
        </if>
        <if test="endMonth!='' and endMonth!=null">
            and DATE_FORMAT(a.agreement_end_date,'%m') = #{endMonth,jdbcType=VARCHAR}
        </if>
        <if test="updatedateBegin!='' and updatedateBegin!=null">
            and DATE_FORMAT(a.create_date,'%Y-%m-%d') <![CDATA[ >= ]]> #{updatedateBegin,jdbcType=VARCHAR}
        </if>
        <if test="updatedateEnd!='' and updatedateEnd!=null">
            and DATE_FORMAT(a.create_date,'%Y-%m-%d') <![CDATA[ <= ]]> #{updatedateEnd,jdbcType=VARCHAR}
        </if>
        <if test="statusNot!='' and statusNot!=null">
            and status <![CDATA[ <> ]]> #{statusNot,jdbcType=VARCHAR}
        </if>
        <if test="contract_audit_status!='' and contract_audit_status!=null">
            and (select mc.audit_status from bu_mcht_contract mc where mc.mcht_id=a.id and mc.del_flag='0' order by id
            desc limit 1)=#{contract_audit_status,jdbcType=VARCHAR}
        </if>
        <if test="contract_archive_status!='' and contract_archive_status!=null">
            and (select mc.archive_status from bu_mcht_contract mc where mc.mcht_id=a.id and mc.del_flag='0' order by id
            desc limit 1)=#{contract_archive_status,jdbcType=VARCHAR}
        </if>
        <if test="financeConfirmStatus!=null">
            and a.finance_confirm_status = #{financeConfirmStatus}
        </if>
        <if test="commitAuditDateNotNull != null">
            and a.commit_audit_date is not null
        </if>
        <if test="zsAuditStatusIsNull != null">
            and (a.zs_audit_status is null or a.zs_audit_status = '0')
        </if>
        <if test="zs_commit_audit_date_begin !='' and zs_commit_audit_date_begin != null">
            and a.zs_commit_audit_date <![CDATA[ >= ]]>#{zs_commit_audit_date_begin}
        </if>
        <if test="zs_commit_audit_date_end !='' and zs_commit_audit_date_end != null">
            and a.zs_commit_audit_date <![CDATA[ <= ]]>#{zs_commit_audit_date_end}
        </if>
        <if test="commit_audit_date_begin !='' and commit_audit_date_begin != null">
            and a.commit_audit_date <![CDATA[ >= ]]>#{commit_audit_date_begin}
        </if>
        <if test="commit_audit_date_end !='' and commit_audit_date_end != null">
            and a.commit_audit_date <![CDATA[ <= ]]>#{commit_audit_date_end}
        </if>
        <if test="zs_audit_status != null">
            and a.zs_audit_status = #{zs_audit_status}
        </if>
        <if test="in_zs_platform_contact_ids != '' and in_zs_platform_contact_ids != null">
            and a.id in(select mpc.mcht_id from bu_mcht_platform_contact mpc, bu_platform_contact pc where mpc.del_flag
            = '0' and pc.del_flag = '0' and mpc.status = '1' and pc.contact_type = '1' and pc.status = '0' and
            mpc.platform_contact_id = pc.id and pc.id in(${in_zs_platform_contact_ids}) )
        </if>
        <if test="zs_platform_contact_id != '' and zs_platform_contact_id != null">
            and a.id in(select mpc.mcht_id from bu_mcht_platform_contact mpc, bu_platform_contact pc where mpc.del_flag
            = '0' and pc.del_flag = '0' and mpc.status = '1' and pc.contact_type = '1' and pc.status = '0' and
            mpc.platform_contact_id = pc.id and pc.id = ${zs_platform_contact_id} )
        </if>
        <if test="fw_platform_contact_id != '' and fw_platform_contact_id != null">
            and a.id in(select mpc.mcht_id from bu_mcht_platform_contact mpc, bu_platform_contact pc where mpc.del_flag
            = '0' and pc.del_flag = '0' and mpc.status = '1' and pc.contact_type = '7' and pc.status = '0' and
            mpc.platform_contact_id = pc.id and pc.id = ${fw_platform_contact_id} )
        </if>
        <if test="zs_total_audit_status_notEqual != null">
            and a.zs_total_audit_status !=#{zs_total_audit_status_notEqual}
        </if>
        <if test="my_audit_product_type_staff_id != '' and my_audit_product_type_staff_id != null">
            and EXISTS (select mpt.id from sys_staff_product_type spt, bu_mcht_product_type mpt where spt.del_flag = '0'
            and spt.staff_id = #{my_audit_product_type_staff_id} and spt.product_type_id = mpt.product_type_id and
            mpt.del_flag = '0' and mpt.is_main = '1' and mpt.mcht_id = a.id )
        </if>
        <if test="audit_risk != '' and audit_risk != null">
            and a.id in(select mo.mcht_id from bu_mcht_optimize mo where mo.del_flag = '0' and mo.audit_risk =
            #{audit_risk })
        </if>
        <if test="degree_adaptability != '' and degree_adaptability != null">
            and a.id in(select mo.mcht_id from bu_mcht_optimize mo where mo.del_flag = '0' and mo.degree_adaptability =
            #{degree_adaptability })
        </if>
        <if test="company_inf_audit_inner_status == 1">
            and (a.company_inf_audit_inner_remarks = '' or a.company_inf_audit_inner_remarks is null)
        </if>
        <if test="company_inf_audit_inner_status == 2">
            and a.company_inf_audit_inner_remarks != '' and a.company_inf_audit_inner_remarks is not null
        </if>
        <if test="platContactStaffId != '' and platContactStaffId != null">
            and a.id IN(select mpc.mcht_id from bu_platform_contact pc, bu_mcht_platform_contact mpc where pc.del_flag =
            '0' and pc.status = '0' and (pc.staff_id = #{platContactStaffId } or pc.assistant_id in(select bpc.id from
            bu_platform_contact bpc where bpc.del_flag = '0' and bpc.status = '0' and bpc.staff_id =
            #{platContactStaffId }) )
            and mpc.del_flag = '0' and mpc.status = '1' and mpc.platform_contact_id = pc.id )
        </if>
        <if test="cooperateBeginDateBegin != '' and cooperateBeginDateBegin != null">
            and a.cooperate_begin_date<![CDATA[ >= ]]>#{cooperateBeginDateBegin}
        </if>
        <if test="cooperateBeginDateEnd != '' and cooperateBeginDateEnd != null">
            and a.cooperate_begin_date<![CDATA[ <= ]]>#{cooperateBeginDateEnd}
        </if>
        <if test="closeDateBegin != '' and closeDateBegin != null">
            and a.status ='3' and a.status_date<![CDATA[ >= ]]>#{closeDateBegin}
        </if>
        <if test="closeDateEnd != '' and closeDateEnd != null">
            and a.status ='3' and a.status_date<![CDATA[ <= ]]>#{closeDateEnd}
        </if>
        <if test="yearlyInspectionDateLessThan != '' and yearlyInspectionDateLessThan != null">
            and a.yearly_inspection_date<![CDATA[ < ]]>#{yearlyInspectionDateLessThan}
        </if>
        <if test="yearlyInspectionDateMoreThans != '' and yearlyInspectionDateMoreThans != null and yearlyInspectionDateLessThans != '' and yearlyInspectionDateLessThans != null and corporationIdcardDateMoreThans != '' and corporationIdcardDateMoreThans != null and corporationIdcardDateLessThans != '' and corporationIdcardDateLessThans != null">
            and (a.yearly_inspection_date<![CDATA[ > ]]>#{yearlyInspectionDateMoreThans} and a.yearly_inspection_date
            <![CDATA[ <= ]]>#{yearlyInspectionDateLessThan} or a.corporation_idcard_date<![CDATA[ > ]]>
            #{corporationIdcardDateMoreThans} and a.yearly_inspection_date<![CDATA[ <= ]]>
            #{corporationIdcardDateLessThans})
        </if>
        <if test="settledType != '' and settledType != null">
            and a.settled_type=#{settledType}
        </if>
        <if test="isManageSelf != '' and isManageSelf != null">
            and a.is_manage_self=#{isManageSelf}
        </if>
        <if test="delay_status != '' and delay_status != null">
            and a.delay_status=#{delay_status}
        </if>
    </select>

    <select id="selectMchtInfoCustomById" resultMap="BaseResultCustomMap" parameterType="java.lang.Integer">
        select t.*,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","MCHT_TYPE", t.mcht_type) mcht_type_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","IS_MANAGE_SELF", t.is_manage_self) is_manage_self_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","STATUS", t.status) status_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","IS_COMPANY_INF_PERFECT", t.is_company_inf_perfect)
        is_company_inf_perfect_desc,
        (select b.audit_status from bu_mcht_tax_invoice_info b where b.mcht_id=t.id) tax_invoice_audit_status,
        FUN_GET_STATUS_DESC("BU_MCHT_TAX_INVOICE_INFO","AUDIT_STATUS", (select b.audit_status from
        bu_mcht_tax_invoice_info b where b.mcht_id=t.id)) tax_invoice_audit_status_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","COMPANY_TYPE", t.company_type) company_type_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","REG_FEE_TYPE", t.reg_fee_type) reg_fee_type_desc,
        (select a.AREA_NAME from bu_p_area a where a.AREA_ID=t.contact_province) contact_province_name,
        (select b.AREA_NAME from bu_p_area b where b.AREA_ID=t.contact_city) contact_city_name,
        (select c.AREA_NAME from bu_p_area c where c.AREA_ID=t.contact_county) contact_county_name,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","TOTAL_AUDIT_STATUS", t.total_audit_status) total_audit_status_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","SHOP_TYPE", t.shop_type) shop_type_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","SHOP_NAME_AUDIT_STATUS", t.shop_name_audit_status)
        shop_name_audit_status_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","GRADE", t.grade) grade_desc,
        (select GROUP_CONCAT(CONCAT(pb.`name`,'（',ROUND(mpb.pop_commission_rate*100),'%）',pb.id)) from
        bu_mcht_product_brand mpb, bu_product_brand pb where mpb.mcht_id = t.id and mpb.del_flag = '0' and
        mpb.product_brand_id = pb.id and pb.del_flag = '0') mcht_product_brand_name,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO", "SHOP_STATUS", t.shop_status) shop_status_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO", "ACTIVITY_AUTH_STATUS", t.activity_auth_status) activity_auth_status_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_OPTIMIZE", "DEGREE_ADAPTABILITY", (select mo.degree_adaptability from
        bu_mcht_optimize mo where mo.del_flag = '0' and mo.mcht_id = t.id)) degree_adaptability_desc,
        (select mo.operate_remarks from bu_mcht_optimize mo where mo.del_flag = '0' and mo.mcht_id = t.id)
        mcht_optimize_operate_remarks,
        (select mo.deposit_remarks from bu_mcht_optimize mo where mo.del_flag = '0' and mo.mcht_id = t.id)
        mcht_optimize_deposit_remarks,
        (select mo.gross_profit_rate_remarks from bu_mcht_optimize mo where mo.del_flag = '0' and mo.mcht_id = t.id)
        mcht_optimize_gross_profit_rate_remarks,
        (select mo.product_remarks from bu_mcht_optimize mo where mo.del_flag = '0' and mo.mcht_id = t.id)
        mcht_optimize_product_remarks,
        (select mo.service_remarks from bu_mcht_optimize mo where mo.del_flag = '0' and mo.mcht_id = t.id)
        mcht_optimize_service_remarks,
        (select mo.wuliu_remarks from bu_mcht_optimize mo where mo.del_flag = '0' and mo.mcht_id = t.id)
        mcht_optimize_wuliu_remarks,
        (select mo.spread_remarks from bu_mcht_optimize mo where mo.del_flag = '0' and mo.mcht_id = t.id)
        mcht_optimize_spread_remarks,
        FUN_GET_STATUS_DESC("BU_MCHT_OPTIMIZE", "AUDIT_RISK", (select mo.audit_risk from bu_mcht_optimize mo where
        mo.del_flag = '0' and mo.mcht_id = t.id)) audit_risk_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_OPTIMIZE", "AUDIT_RISK", (select mo.resource_grade from bu_mcht_optimize mo where
        mo.del_flag = '0' and mo.mcht_id = t.id)) resource_grade_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO", "LICENSE_STATUS", t.license_status) license_status_desc,
        (select pt.name from bu_mcht_product_type mpt, bu_product_type pt where mpt.mcht_id = t.id and mpt.is_main = '1'
        and mpt.del_flag = '0' and mpt.product_type_id = pt.id and pt.del_flag = '0' limit 1 )
        product_type_name, <!-- 主营类目 -->
        (select mpt.product_type_id from bu_mcht_product_type mpt where mpt.mcht_id = t.id and mpt.is_main = '1' and
        mpt.del_flag = '0' limit 1 ) product_type_id, <!-- 主营类目ID -->
        <![CDATA[ IF((select COUNT(1) from bu_sub_order so, bu_combine_order co, bu_customer_service_order cso where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date between concat(DATE_SUB(CURDATE(), INTERVAL 90 DAY), ' 00:00:00') and concat(CURDATE(), ' 23:59:59') and cso.del_flag = '0' and cso.sub_order_id = so.id and cso.service_type = 'B' AND cso.status='1') = 0,
						'0.0',
						CONCAT(ROUND(
							(select COUNT(1) from bu_sub_order so, bu_combine_order co, bu_customer_service_order cso where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date between concat(DATE_SUB(CURDATE(), INTERVAL 90 DAY), ' 00:00:00') and concat(CURDATE(), ' 23:59:59') and cso.del_flag = '0' and cso.sub_order_id = so.id and cso.service_type = 'B' AND cso.status='1')
							/(select SUM(od.quantity) from bu_sub_order so, bu_combine_order co, bu_order_dtl od where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date between concat(DATE_SUB(CURDATE(), INTERVAL 90 DAY), ' 00:00:00') and concat(CURDATE(), ' 23:59:59') AND od.sub_order_id = so.id )*100, 1))) customer_service_order_rateB, ]]> <!--商家近三个月退货率-->


        <![CDATA[ IF((select COUNT(1) from bu_sub_order so, bu_combine_order co, bu_customer_service_order cso where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date between concat(DATE_SUB(CURDATE(), INTERVAL 90 DAY), ' 00:00:00') and concat(CURDATE(), ' 23:59:59') and cso.del_flag = '0' and cso.sub_order_id = so.id and cso.service_type = 'C' AND cso.status='1' ) = 0,
						'0.0',
						CONCAT(ROUND(
							(select COUNT(1) from bu_sub_order so, bu_combine_order co, bu_customer_service_order cso where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date between concat(DATE_SUB(CURDATE(), INTERVAL 90 DAY), ' 00:00:00') and concat(CURDATE(), ' 23:59:59') and cso.del_flag = '0' and cso.sub_order_id = so.id and cso.service_type = 'C' AND cso.status='1')
							/(select SUM(od.quantity) from bu_sub_order so, bu_combine_order co, bu_order_dtl od where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date between concat(DATE_SUB(CURDATE(), INTERVAL 90 DAY), ' 00:00:00') and concat(CURDATE(), ' 23:59:59') AND od.sub_order_id = so.id )*100, 1))) customer_service_order_rateC, ]]> <!--商家近三个月换货率-->

        <![CDATA[ IF((select COUNT(1) from bu_sub_order so, bu_combine_order co, bu_customer_service_order cso where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date between concat(DATE_SUB(CURDATE(), INTERVAL 90 DAY), ' 00:00:00') and concat(CURDATE(), ' 23:59:59') and cso.del_flag = '0' and cso.sub_order_id = so.id and cso.service_type = 'A' AND cso.status='1') = 0,
						'0.0',
						CONCAT(ROUND(
							(select COUNT(1) from bu_sub_order so, bu_combine_order co, bu_customer_service_order cso where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date between concat(DATE_SUB(CURDATE(), INTERVAL 90 DAY), ' 00:00:00') and concat(CURDATE(), ' 23:59:59') and cso.del_flag = '0' and cso.sub_order_id = so.id and cso.service_type = 'A' AND cso.status='1')
							/(select SUM(od.quantity) from bu_sub_order so, bu_combine_order co, bu_order_dtl od where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date between concat(DATE_SUB(CURDATE(), INTERVAL 90 DAY), ' 00:00:00') and concat(CURDATE(), ' 23:59:59') AND od.sub_order_id = so.id )*100, 1))) customer_service_order_rateA,]]> <!--商家近三个月退款率-->


        <![CDATA[ IF((select COUNT(1) from bu_comment c where c.del_flag = '0' and c.mcht_id = t.id and c.create_date  between concat(DATE_SUB(CURDATE(), INTERVAL 90 DAY), ' 00:00:00') and concat(CURDATE(), ' 23:59:59') and c.product_score in(4, 5)) = 0,
						'0.0',
						CONCAT(TRUNCATE(
							(select COUNT(1) from bu_comment c where c.del_flag = '0' and c.mcht_id = t.id and c.product_score in(4, 5) )
							/(select COUNT(1) from bu_comment c where c.del_flag = '0' and c.mcht_id = t.id )*100
						, 2))) product_applauserate]]><!--商品好评率 -->
        from bu_mcht_info t where t.id = #{id}
    </select>


    <select id="selectMchtInfoAndPicCustomById" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT
        a.*,
        m.audit_status auditStatus,
        b.status accountStatus,
        (select pc.contact_name from bu_platform_contact pc, bu_mcht_platform_contact pm where pc.status = '0' and
        pc.del_flag = '0' and pm.status = '1' and pm.del_flag = '0' and pm.platform_contact_id = pc.id and pm.mcht_id =
        a.id and pc.contact_type = '1' and pc.status='0' LIMIT 1 ) zs_contact_name,
        (select pc.contact_name from bu_platform_contact pc, bu_mcht_platform_contact pm where pc.status = '0' and
        pc.del_flag = '0' and pm.status = '1' and pm.del_flag = '0' and pm.platform_contact_id = pc.id and pm.mcht_id =
        a.id and pc.contact_type = '2' and pc.status='0' LIMIT 1 ) yy_contact_name,
        (select pc.contact_name from bu_platform_contact pc, bu_mcht_platform_contact pm where pc.status = '0' and
        pc.del_flag = '0' and pm.status = '1' and pm.del_flag = '0' and pm.platform_contact_id = pc.id and pm.mcht_id =
        a.id and pc.contact_type = '7' and pc.status='0' LIMIT 1 ) fw_contact_name,
        (select pc.contact_name from bu_platform_contact pc, bu_mcht_platform_contact pm where pc.status = '0' and
        pc.del_flag = '0' and pm.status = '1' and pm.del_flag = '0' and pm.platform_contact_id = pc.id and pm.mcht_id =
        a.id and pc.contact_type = '5' and pc.status='0' LIMIT 1 ) cw_contact_name
        FROM bu_mcht_info a
        LEFT JOIN bu_mcht_tax_invoice_info m
        ON a.id = m.mcht_id
        LEFT JOIN bu_mcht_bank_account b
        ON a.id = b.mcht_id
        WHERE a.del_flag = '0'
        and b.del_flag = '0'
        and m.del_flag = '0'
        AND a.status IN(0,1)
        AND (a.is_company_inf_perfect IN(2,3)
        OR a.shop_name_audit_status IN(1,2)
        OR m.audit_status IN(1,2)
        OR b.status IN(0,1))
        <if test="status == '' or status == null">
            AND a.status IN(0,1)
        </if>
        <if test="status != '' and status != null">
            AND a.status = #{status}
        </if>
        <if test="mchtCode != '' and mchtCode != null">
            AND a.mcht_code like concat('%',#{mchtCode,jdbcType=VARCHAR},'%')
        </if>
        <if test="mchtType != '' and mchtType != null">
            AND a.mcht_type = #{mchtType}
        </if>
        <if test="companyName != '' and companyName != null">
            and (a.short_name like concat('%',#{companyName,jdbcType=VARCHAR},'%')
            or a.company_name like concat('%',#{companyName,jdbcType=VARCHAR},'%')
            or a.shop_name like concat('%',#{companyName,jdbcType=VARCHAR},'%')
            )
        </if>
        <if test="isCompanyInfPerfect != '' and isCompanyInfPerfect != null">
            AND a.is_company_inf_perfect = #{isCompanyInfPerfect}
        </if>
        <if test="shopNameAuditStatus != '' and shopNameAuditStatus != null">
            AND a.shop_name_audit_status = #{shopNameAuditStatus}
        </if>
        <if test="auditStatus != '' and auditStatus != null">
            AND m.audit_status = #{auditStatus}
        </if>
        <if test="accountStatus != '' and accountStatus != null">
            AND b.status = #{accountStatus}
        </if>
        <if test="myContactType != '' and myContactType != null">
            AND EXISTS(select pc.id from bu_platform_contact pc, bu_mcht_platform_contact pm where pc.status = '0' and
            pc.del_flag = '0' and pm.status = '1' and pm.del_flag = '0' and pm.platform_contact_id = pc.id and
            pm.mcht_id = a.id and pc.contact_type = #{myContactType } )
        </if>
        <if test="MAX_NUM!=null and MAX_NUM!=''">
            limit #{MIN_NUM},#{MAX_NUM}
        </if>
    </select>


    <!--     <select id="selectMchtInfoAndPicCustomById" resultMap="BaseResultCustomMap" parameterType="java.util.HashMap" > -->
    <!-- 	    select a.*,  -->
    <!-- 	    (select count(*) from bu_mcht_bl_pic ap where ap.del_flag='0' and a.id=ap.mcht_id) pic_count -->
    <!-- 	    from bu_mcht_info a -->
    <!-- 	    where a.del_flag = '0' -->
    <!-- 	 	<if test="status!='' and status!=null"> -->
    <!-- 			and a.status =#{status} -->
    <!-- 		</if> -->
    <!-- 	 	<if test="isManageself!='' and isManageself!=null"> -->
    <!-- 			and a.is_manage_self =#{isManageself} -->
    <!-- 		</if> -->
    <!-- 		<if test="isCompanyInfPerfect!='' and isCompanyInfPerfect!=null and isCompanyInfPerfect!='2,3'"> -->
    <!-- 			and a.is_company_inf_perfect =#{isCompanyInfPerfect} -->
    <!-- 		</if> -->
    <!-- 		<if test="isCompanyInfPerfect=='2,3'"> -->
    <!-- 			and a.is_company_inf_perfect in ('2','3') -->
    <!-- 		</if> -->
    <!-- 		<if test="mchtType!='' and mchtType!=null"> -->
    <!-- 			and a.mcht_type =#{mchtType} -->
    <!-- 		</if> -->
    <!-- 		<if test="companyName!='' and companyName!=null"> -->
    <!-- 			and a.company_name like concat('%',#{companyName,jdbcType=VARCHAR},'%') -->
    <!-- 		</if> -->
    <!-- 		<if test="mchtCode!='' and mchtCode!=null"> -->
    <!-- 			and a.mcht_code like concat('%',#{mchtCode,jdbcType=VARCHAR},'%') -->
    <!-- 		</if> -->
    <!-- 		<if test="MAX_NUM!=null and MAX_NUM!=''"> -->
    <!-- 		   		limit #{MIN_NUM},#{MAX_NUM} -->
    <!-- 	     </if> -->
    <!--    	</select> -->


    <select id="selectCountMchtInfoAndPicCustomById" resultType="int" parameterType="java.util.HashMap">
        SELECT
        count(1)
        FROM bu_mcht_info a
        LEFT JOIN bu_mcht_tax_invoice_info m
        ON a.id = m.mcht_id
        LEFT JOIN bu_mcht_bank_account b
        ON a.id = b.mcht_id
        WHERE a.del_flag = '0'
        AND a.status IN(0,1)
        AND (a.is_company_inf_perfect IN(2,3)
        OR a.shop_name_audit_status IN(1,2)
        OR m.audit_status IN(1,2)
        OR b.status IN(0,1))
        <if test="status == '' or status == null">
            AND a.status IN(0,1)
        </if>
        <if test="status != '' and status != null">
            AND a.status = #{status}
        </if>
        <if test="mchtCode != '' and mchtCode != null">
            AND a.mcht_code like concat('%',#{mchtCode,jdbcType=VARCHAR},'%')
        </if>
        <if test="mchtType != '' and mchtType != null">
            AND a.mcht_type = #{mchtType}
        </if>
        <if test="companyName != '' and companyName != null">
            and (a.short_name like concat('%',#{companyName,jdbcType=VARCHAR},'%')
            or a.company_name like concat('%',#{companyName,jdbcType=VARCHAR},'%')
            or a.shop_name like concat('%',#{companyName,jdbcType=VARCHAR},'%')
            )
        </if>
        <if test="isCompanyInfPerfect != '' and isCompanyInfPerfect != null">
            AND a.is_company_inf_perfect = #{isCompanyInfPerfect}
        </if>
        <if test="shopNameAuditStatus != '' and shopNameAuditStatus != null">
            AND a.shop_name_audit_status = #{shopNameAuditStatus}
        </if>
        <if test="auditStatus != '' and auditStatus != null">
            AND m.audit_status = #{auditStatus}
        </if>
        <if test="accountStatus != '' and accountStatus != null">
            AND b.status = #{accountStatus}
        </if>
        <if test="myContactType != '' and myContactType != null">
            AND EXISTS(select pc.id from bu_platform_contact pc, bu_mcht_platform_contact pm where pc.status = '0' and
            pc.del_flag = '0' and pm.status = '1' and pm.del_flag = '0' and pm.platform_contact_id = pc.id and
            pm.mcht_id = a.id and pc.contact_type = #{myContactType } )
        </if>
    </select>


    <!--     <select id="selectCountMchtInfoAndPicCustomById" resultType="int" parameterType="java.util.HashMap" > -->
    <!-- 	    select count(1) -->
    <!-- 	    from bu_mcht_info a -->
    <!-- 	    where a.del_flag = '0' -->
    <!-- 	 	<if test="status!='' and status!=null"> -->
    <!-- 			and a.status =#{status} -->
    <!-- 		</if> -->
    <!-- 	 	<if test="isManageself!='' and isManageself!=null"> -->
    <!-- 			and a.is_manage_self =#{isManageself} -->
    <!-- 		</if> -->
    <!-- 		<if test="isCompanyInfPerfect!='' and isCompanyInfPerfect!=null and isCompanyInfPerfect!='2,3'"> -->
    <!-- 			and a.is_company_inf_perfect =#{isCompanyInfPerfect} -->
    <!-- 		</if> -->
    <!-- 		<if test="isCompanyInfPerfect=='2,3'"> -->
    <!-- 			and a.is_company_inf_perfect in ('2','3') -->
    <!-- 		</if> -->
    <!-- 		<if test="mchtType!='' and mchtType!=null"> -->
    <!-- 			and a.mcht_type =#{mchtType} -->
    <!-- 		</if> -->
    <!-- 		<if test="companyName!='' and companyName!=null"> -->
    <!-- 			and a.company_name like concat('%',#{companyName,jdbcType=VARCHAR},'%') -->
    <!-- 		</if> -->
    <!-- 		<if test="mchtCode!='' and mchtCode!=null"> -->
    <!-- 			and a.mcht_code like concat('%',#{mchtCode,jdbcType=VARCHAR},'%') -->
    <!-- 		</if> -->
    <!--    </select> -->


    <select id="selectMchtInfoAllList" resultMap="BaseResultCustomMap" parameterType="map">
        select t.*,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","MCHT_TYPE", t.mcht_type) mcht_type_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","IS_MANAGE_SELF", t.is_manage_self) is_manage_self_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","STATUS", t.status) status_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","IS_COMPANY_INF_PERFECT", t.is_company_inf_perfect)
        is_company_inf_perfect_desc,
        (select b.audit_status from bu_mcht_tax_invoice_info b where b.mcht_id=t.id) tax_invoice_audit_status,
        FUN_GET_STATUS_DESC("BU_MCHT_TAX_INVOICE_INFO","AUDIT_STATUS", (select b.audit_status from
        bu_mcht_tax_invoice_info b where b.mcht_id=t.id)) tax_invoice_audit_status_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","COMPANY_TYPE", t.company_type) company_type_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","REG_FEE_TYPE", t.reg_fee_type) reg_fee_type_desc,
        (select a.AREA_NAME from bu_p_area a where a.AREA_ID=t.contact_province) contact_province_name,
        (select b.AREA_NAME from bu_p_area b where b.AREA_ID=t.contact_city) contact_city_name,
        (select c.AREA_NAME from bu_p_area c where c.AREA_ID=t.contact_county) contact_county_name
        from bu_mcht_info t where t.del_flag='0'
        <if test="shortName!=null">
            and t.short_name like concat('%',#{shortName,jdbcType=VARCHAR},'%')
        </if>
        <if test="mchtCode!=null">
            and t.mcht_code like concat('%',#{mchtCode,jdbcType=VARCHAR},'%')
        </if>
        <if test="MAX_NUM!=null and MAX_NUM!=''">
            limit #{MIN_NUM},#{MAX_NUM}
        </if>
    </select>


    <sql id="Mcht_Info_Custom_Column_List">
        id, mcht_code, short_name, mcht_type, cooperate_begin_date, is_manage_self, agreement_begin_date,
        agreement_end_date, shop_name, shop_catalog, business_firms, product_type, brand,
        shop_type, shop_name_audit_status, shop_name_audit_remarks, status, status_date,
        total_audit_status, total_audit_remarks, total_audit_date, commit_audit_date, is_total_audit_re_commit,
        company_name, company_type, company_reg_name, uscc, company_address, founded_date,
        reg_capital, reg_fee_type, corporation_name, corporation_idcard_no, corporation_mobile,
        corporation_idcard_img_1, corporation_idcard_img_2, bl_pic, occ_pic, trc_pic, atq_pic,
        boaal_pic, yearly_inspection_date, company_tel, contact_province, contact_city, contact_county,
        contact_address, is_company_inf_perfect, company_inf_audit_remarks, contract_deposit,
        brand_deposit, select_contract_deposit, select_brand_deposit, deposit_type, deposit_content,
        custom_service_type, sobot_id, xiaoneng_id, in_blacklist, zs_audit_status, zs_audit_by,
        finance_confirm_status, finance_confirm_by, shop_status, shop_status_date, shop_logo,
        grade, activity_auth_status, shop_name_audit_inner_remarks, zs_total_audit_status,
        zs_total_audit_by, zs_total_audit_remarks, zs_total_audit_date, is_zs_total_audit_re_commit,
        zs_commit_audit_date, total_audit_by, idcard_img_1_archive_status, idcard_img_2_archive_status,
        occ_pic_archive_status, trc_pic_archive_status, atq_pic_archive_status, boaal_pic_archive_status,
        company_inf_audit_inner_remarks, activity_auth_status_date, operate_status, operate_status_date,
        operate_remarks, fee_rate, archive_status, allow_mcht_apply_close, company_info_archive_status,
        mcht_brand_archive_status, scope_of_business, delay_status, delay_days, change_apply_type,
        change_end_date, settled_type, specially_approved_status, specially_approved_remarks,
        last_close_date, last_close_remarks, supply_chain_status, license_is_must, business_license_pic,
        license_status, license_reject_reason, other, create_by, create_date, update_by,
        update_date, del_flag,

        FUN_GET_STATUS_DESC("BU_MCHT_INFO","MCHT_TYPE", a.mcht_type) mcht_type_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","IS_COMPANY_INF_PERFECT", a.is_company_inf_perfect)
        is_company_inf_perfect_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","SHOP_NAME_AUDIT_STATUS", a.shop_name_audit_status)
        shop_name_audit_status_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","STATUS", a.status) status_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","TOTAL_AUDIT_STATUS", a.total_audit_status) total_audit_statusdesc,
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","GRADE", a.grade) grade_desc, <!-- 商家等级 -->
        FUN_GET_STATUS_DESC("BU_MCHT_INFO", "SHOP_STATUS", a.shop_status) shop_status_desc,

        (select pa.area_name from bu_p_area pa where pa.area_id = a.contact_province) contact_province_name,
        (select pb.area_name from bu_p_area pb where pb.area_id = a.contact_city) contact_city_name,
        (select pc.area_name from bu_p_area pc where pc.area_id = a.contact_county) contact_county_name,

        (select c.contact_name from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id
        and b.mcht_id = a.id and c.contact_type = '1' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1)zs_contact_name, <!-- 1 招商对接人 -->
        (select c.mobile from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id and
        b.mcht_id = a.id and c.contact_type = '1' and b.del_flag='0' and c.del_flag='0' and b.status='1' LIMIT
        1)zs_mobile, <!-- 1 招商对接人 -->

        (select c.contact_name from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id
        and b.mcht_id = a.id and c.contact_type = '2' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1)yy_contact_name, <!-- 2 运营对接人 -->
        (select c.mobile from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id and
        b.mcht_id = a.id and c.contact_type = '2' and b.del_flag='0' and c.del_flag='0' and b.status='1' LIMIT
        1)yy_mobile, <!-- 2 运营对接人 -->

        (select c.contact_name from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id
        and b.mcht_id = a.id and c.contact_type = '3' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1)dd_contact_name, <!-- 3 订单对接人 -->
        (select c.mobile from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id and
        b.mcht_id = a.id and c.contact_type = '3' and b.del_flag='0' and c.del_flag='0' and b.status='1' LIMIT
        1)dd_mobile, <!-- 3 订单对接人 -->

        (select c.contact_name from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id
        and b.mcht_id = a.id and c.contact_type = '4' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1)sh_contact_name, <!-- 4 售后对接人 -->
        (select c.mobile from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id and
        b.mcht_id = a.id and c.contact_type = '4' and b.del_flag='0' and c.del_flag='0' and b.status='1' LIMIT
        1)sh_mobile, <!-- 4 售后对接人 -->

        (select c.contact_name from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id
        and b.mcht_id = a.id and c.contact_type = '5' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1)cw_contact_name, <!-- 5 财务对接人 -->
        (select c.mobile from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id and
        b.mcht_id = a.id and c.contact_type = '5' and b.del_flag='0' and c.del_flag='0' and b.status='1' LIMIT
        1)cw_mobile, <!-- 5 财务对接人 -->

        (select c.contact_name from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id
        and b.mcht_id = a.id and c.contact_type = '6' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1)kf_contact_name, <!-- 6 客服对接人 -->
        (select c.mobile from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id and
        b.mcht_id = a.id and c.contact_type = '6' and b.del_flag='0' and c.del_flag='0' and b.status='1' LIMIT
        1)kf_mobile, <!-- 6 客服对接人 -->

        (select c.contact_name from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id
        and b.mcht_id = a.id and c.contact_type = '7' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1)fw_contact_name, <!-- 7 法务对接人 -->
        (select c.mobile from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id and
        b.mcht_id = a.id and c.contact_type = '7' and b.del_flag='0' and c.del_flag='0' and b.status='1' LIMIT
        1)fw_mobile, <!-- 7 法务对接人 -->

        (select c.contact_name from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id
        and b.mcht_id = a.id and c.contact_type = '8' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1)sj_contact_name, <!-- 8 商家服务专员 -->
        (select c.mobile from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id and
        b.mcht_id = a.id and c.contact_type = '8' and b.del_flag='0' and c.del_flag='0' and b.status='1' LIMIT
        1)sj_mobile, <!-- 8 商家服务专员 -->

        (select bmc.contact_name from bu_mcht_contact bmc where bmc.mcht_id = a.id and bmc.del_flag = '0' and
        bmc.contact_type = '1' LIMIT 1) ds_mcht_contact_name, <!-- 1 电商总负责人 -->
        (select bmc.mobile from bu_mcht_contact bmc where bmc.mcht_id = a.id and bmc.del_flag = '0' and bmc.contact_type
        = '1' LIMIT 1) ds_mcht_mobile, <!-- 1 电商总负责人 -->
        (select bmc.qq from bu_mcht_contact bmc where bmc.mcht_id = a.id and bmc.del_flag = '0' and bmc.contact_type =
        '1' LIMIT 1) ds_mcht_qq, <!-- 1 电商总负责人 -->
        (select bmc.email from bu_mcht_contact bmc where bmc.mcht_id = a.id and bmc.del_flag = '0' and bmc.contact_type
        = '1' LIMIT 1) ds_mcht_email, <!-- 1 电商总负责人 -->

        (select bmc.contact_name from bu_mcht_contact bmc where bmc.mcht_id = a.id and bmc.del_flag = '0' and
        bmc.contact_type = '2' LIMIT 1) yy_mcht_contact_name, <!-- 2 运营对接人 -->
        (select bmc.mobile from bu_mcht_contact bmc where bmc.mcht_id = a.id and bmc.del_flag = '0' and bmc.contact_type
        = '2' LIMIT 1) yy_mcht_mobile, <!-- 2 运营对接人 -->
        (select bmc.qq from bu_mcht_contact bmc where bmc.mcht_id = a.id and bmc.del_flag = '0' and bmc.contact_type =
        '2' LIMIT 1) yy_mcht_qq, <!-- 2 运营对接人 -->
        (select bmc.email from bu_mcht_contact bmc where bmc.mcht_id = a.id and bmc.del_flag = '0' and bmc.contact_type
        = '2' LIMIT 1) yy_mcht_email, <!-- 2 运营对接人 -->

        (select bmc.contact_name from bu_mcht_contact bmc where bmc.mcht_id = a.id and bmc.del_flag = '0' and
        bmc.contact_type = '3' LIMIT 1) dd_mcht_contact_name, <!-- 3 订单对接人 -->
        (select bmc.mobile from bu_mcht_contact bmc where bmc.mcht_id = a.id and bmc.del_flag = '0' and bmc.contact_type
        = '3' LIMIT 1) dd_mcht_mobile, <!-- 3 订单对接人 -->
        (select bmc.qq from bu_mcht_contact bmc where bmc.mcht_id = a.id and bmc.del_flag = '0' and bmc.contact_type =
        '3' LIMIT 1) dd_mcht_qq, <!-- 3 订单对接人 -->
        (select bmc.email from bu_mcht_contact bmc where bmc.mcht_id = a.id and bmc.del_flag = '0' and bmc.contact_type
        = '3' LIMIT 1) dd_mcht_email, <!-- 3 订单对接人 -->

        (select bmc.contact_name from bu_mcht_contact bmc where bmc.mcht_id = a.id and bmc.del_flag = '0' and
        bmc.contact_type = '4' LIMIT 1) sh_mcht_contact_name, <!-- 4 售后对接人 -->
        (select bmc.mobile from bu_mcht_contact bmc where bmc.mcht_id = a.id and bmc.del_flag = '0' and bmc.contact_type
        = '4' LIMIT 1) sh_mcht_mobile, <!-- 4 售后对接人 -->
        (select bmc.qq from bu_mcht_contact bmc where bmc.mcht_id = a.id and bmc.del_flag = '0' and bmc.contact_type =
        '4' LIMIT 1) sh_mcht_qq, <!-- 4 售后对接人 -->
        (select bmc.email from bu_mcht_contact bmc where bmc.mcht_id = a.id and bmc.del_flag = '0' and bmc.contact_type
        = '4' LIMIT 1) sh_mcht_email, <!-- 4 售后对接人 -->

        (select bmc.contact_name from bu_mcht_contact bmc where bmc.mcht_id = a.id and bmc.del_flag = '0' and
        bmc.contact_type = '5' LIMIT 1) cw_mcht_contact_name, <!-- 5 财务对接人 -->
        (select bmc.mobile from bu_mcht_contact bmc where bmc.mcht_id = a.id and bmc.del_flag = '0' and bmc.contact_type
        = '5' LIMIT 1) cw_mcht_mobile, <!-- 5 财务对接人 -->
        (select bmc.qq from bu_mcht_contact bmc where bmc.mcht_id = a.id and bmc.del_flag = '0' and bmc.contact_type =
        '5' LIMIT 1) cw_mcht_qq, <!-- 5 财务对接人 -->
        (select bmc.email from bu_mcht_contact bmc where bmc.mcht_id = a.id and bmc.del_flag = '0' and bmc.contact_type
        = '5' LIMIT 1) cw_mcht_email, <!-- 5 财务对接人 -->

        (select bmc.contact_name from bu_mcht_contact bmc where bmc.mcht_id = a.id and bmc.del_flag = '0' and
        bmc.contact_type = '6' LIMIT 1) kf_mcht_contact_name, <!-- 6 客服对接人 -->
        (select bmc.mobile from bu_mcht_contact bmc where bmc.mcht_id = a.id and bmc.del_flag = '0' and bmc.contact_type
        = '6' LIMIT 1) kf_mcht_mobile, <!-- 6 客服对接人 -->
        (select bmc.qq from bu_mcht_contact bmc where bmc.mcht_id = a.id and bmc.del_flag = '0' and bmc.contact_type =
        '6' LIMIT 1) kf_mcht_qq, <!-- 6 客服对接人 -->
        (select bmc.email from bu_mcht_contact bmc where bmc.mcht_id = a.id and bmc.del_flag = '0' and bmc.contact_type
        = '6' LIMIT 1) kf_mcht_email, <!-- 6 客服对接人 -->

        (select mu.user_code from bu_mcht_user mu where a.id = mu.mcht_id and mu.del_flag = '0' and mu.status = '0' and
        mu.is_primary = '1' LIMIT 1) mcht_user_code, <!-- 帐号 -->
        (select mu.user_name from bu_mcht_user mu where a.id = mu.mcht_id and mu.del_flag = '0' and mu.status = '0' and
        mu.is_primary = '1' LIMIT 1) mcht_user_name, <!-- 姓名 -->
        (select mu.mobile from bu_mcht_user mu where a.id = mu.mcht_id and mu.del_flag = '0' and mu.status = '0' and
        mu.is_primary = '1' LIMIT 1) mcht_mobile, <!-- 手机 -->
        (select mu.email from bu_mcht_user mu where a.id = mu.mcht_id and mu.del_flag = '0' and mu.status = '0' and
        mu.is_primary = '1' LIMIT 1) mcht_email, <!-- 电子邮箱 -->

        (select sa.contact_name from bu_mcht_settled_apply sa where a.id = sa.mcht_id and sa.del_flag = '0' LIMIT 1)
        settled_contact_name, <!-- 申请人姓名-->
        (select sa.phone from bu_mcht_settled_apply sa where a.id = sa.mcht_id and sa.del_flag = '0' LIMIT 1)
        settled_phone, <!-- 申请人手机-->
        (select sa.email from bu_mcht_settled_apply sa where a.id = sa.mcht_id and sa.del_flag = '0' LIMIT 1)
        settled_email, <!-- 申请人邮箱-->
        (select sa.tmall_shop from bu_mcht_settled_apply sa where a.id = sa.mcht_id and sa.del_flag = '0' LIMIT 1)
        settled_tmall_shop, <!-- 天猫-->
        (select sa.taobao_shop from bu_mcht_settled_apply sa where a.id = sa.mcht_id and sa.del_flag = '0' LIMIT 1)
        settled_taobao_shop, <!-- 淘宝-->
        (select sa.jd_shop from bu_mcht_settled_apply sa where a.id = sa.mcht_id and sa.del_flag = '0' LIMIT 1)
        settled_jd_shop, <!-- 京东-->
        (select sa.vips_shop from bu_mcht_settled_apply sa where a.id = sa.mcht_id and sa.del_flag = '0' LIMIT 1)
        settled_vips_shop, <!-- 唯品会-->
        (select sa.other_shop from bu_mcht_settled_apply sa where a.id = sa.mcht_id and sa.del_flag = '0' LIMIT 1)
        settled_other_shop, <!-- 其他店铺-->
        (select xcs.bus_id from bu_xiaoneng_customer_service xcs where xcs.del_flag = '0' and xcs.id = a.xiaoneng_id
        LIMIT 1) xiaoneng_bus_id,
        (select xcs.code from bu_xiaoneng_customer_service xcs where xcs.del_flag = '0' and xcs.id = a.xiaoneng_id LIMIT
        1) xiaoneng_code,
        (select xcs.status from bu_xiaoneng_customer_service xcs where xcs.del_flag = '0' and xcs.id = a.xiaoneng_id
        LIMIT 1) xiaoneng_status,
        (select xcs.mcht_name from bu_xiaoneng_customer_service xcs where xcs.del_flag = '0' and xcs.id = a.xiaoneng_id
        LIMIT 1) xiaoneng_mcht_name,
        (select pt.name from bu_mcht_product_type mpt, bu_product_type pt where mpt.mcht_id = a.id and mpt.is_main = '1'
        and mpt.status='1' and pt.status='1' and mpt.del_flag = '0' and mpt.product_type_id = pt.id and pt.del_flag =
        '0' LIMIT 1 ) product_type_name, <!-- 主营类目 -->

        (select IFNULL(SUM(od.quantity), 0) from bu_sub_order so, bu_order_dtl od where so.del_flag = '0' and
        od.del_flag = '0' and so.status = '3' and so.id = od.sub_order_id and od.product_status = '1' and od.is_give =
        '0' and so.mcht_id = a.id ) sum_quantity, <!-- 销售量 -->
        (select TRUNCATE(AVG(c.product_score), 1) from bu_comment c where c.del_flag = '0' and c.mcht_id = a.id )
        avg_product_score, <!-- 商品评价得分 -->
        (select TRUNCATE(AVG(ss.mcht_score), 1) from bu_shop_score ss where ss.del_flag = '0' and ss.mcht_id = a.id )
        avg_mcht_score, <!-- 卖家服务得分 -->
        (select TRUNCATE(AVG(ss.wuliu_score), 1) from bu_shop_score ss where ss.del_flag = '0' and ss.mcht_id = a.id )
        avg_wuliu_score, <!-- 物流服务得分 -->
        (select GROUP_CONCAT(pb.name) from bu_mcht_product_brand mpb,bu_product_brand pb where mpb.mcht_id = a.id and
        mpb.del_flag = '0' and mpb.product_brand_id = pb.id and pb.del_flag = '0') productbrand_name,
        FUN_GET_STATUS_DESC("BU_MCHT_OPTIMIZE", "DEGREE_ADAPTABILITY", (select mo.degree_adaptability from
        bu_mcht_optimize mo where mo.del_flag = '0' and a.id = mo.mcht_id)) degreeadaptability_desc,
        FUN_GET_STATUS_DESC("BU_MCHT_OPTIMIZE", "AUDIT_RISK", (select mo.audit_risk from bu_mcht_optimize mo where
        mo.del_flag = '0' and a.id = mo.mcht_id)) degree_audit_risk_desc,
        (select GROUP_CONCAT(CONCAT(pb.`name`,'（',ROUND(mpb.pop_commission_rate*100),'%）',pb.id)) from
        bu_mcht_product_brand mpb, bu_product_brand pb where mpb.mcht_id = a.id and mpb.del_flag = '0' and
        mpb.product_brand_id = pb.id and pb.del_flag = '0') mcht_product_brand_name,
        DATEDIFF((select b.end_date from bu_mcht_contract b where b.mcht_id = a.id and b.del_flag = '0' order by id desc
        limit 1),NOW()) as days,
        (select send_date from sys_sms where del_flag='0' and sms_type='5' and mobile = (select t.mobile from
        bu_mcht_user t where t.mcht_id = a.id and t.is_primary = '1' and t.del_flag = '0') order by id desc limit 1)
        send_date,
        (select b.contract_code from bu_mcht_contract b where b.mcht_id = a.id and b.del_flag = '0' order by b.id desc
        limit 1) contract_code,
        (select b.begin_date from bu_mcht_contract b where b.mcht_id = a.id and b.del_flag = '0' order by b.id desc
        limit 1) contract_begin_date,
        (select b.end_date from bu_mcht_contract b where b.mcht_id = a.id and b.del_flag = '0' order by b.id desc limit
        1) contract_end_date
    </sql>
    <select id="selectByExample" resultMap="BaseResultCustomMap" parameterType="com.jf.entity.MchtInfoCustomExample">
        select
        <if test="distinct">
            distinct
        </if>
        <include refid="Mcht_Info_Custom_Column_List"/>
        from bu_mcht_info a
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
        <if test="orderByClause != null">
            order by ${orderByClause}
        </if>
        <if test="limitStart != null and limitStart>=0">
            limit #{limitStart} , #{limitSize}
        </if>
    </select>
    <select id="countByExample" parameterType="com.jf.entity.MchtInfoCustomExample" resultType="java.lang.Integer">
        select count(*) from bu_mcht_info a
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
    </select>
    <sql id="Example_Where_Clause">
        <where>
            <foreach collection="oredCriteria" item="criteria" separator="or">
                <if test="criteria.valid">
                    <trim prefix="(" suffix=")" prefixOverrides="and">
                        <foreach collection="criteria.criteria" item="criterion">
                            <choose>
                                <when test="criterion.noValue">
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue">
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue">
                                    and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue">
                                    and ${criterion.condition}
                                    <foreach collection="criterion.value" item="listItem" open="(" close=")"
                                             separator=",">
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>

    <select id="mchtCoum" parameterType="java.util.HashMap" resultMap="BaseResultCustomMap">
			    
SELECT t.each_day,SUM(settled_count) settled_count,SUM(mcht_count) mcht_count,SUM(commitauditdate_count) commitauditdate_count,SUM(qualificationthrough_count) qualificationthrough_count,SUM(cooperatebegindate_count) cooperatebegindate_count from (
SELECT DATE_FORMAT(T.create_date,'%Y-%m-%d') AS each_day,count(*) AS settled_count, 0 AS mcht_count,0 AS commitauditdate_count,0 AS qualificationthrough_count ,0 AS cooperatebegindate_count  from bu_mcht_settled_apply T WHERE T.del_flag='0' AND T.create_date <![CDATA[ >= ]]> #{DateBegin} AND T.create_date <![CDATA[ <= ]]> #{DateEnd} GROUP BY DATE_FORMAT(T.create_date,'%Y-%m-%d')
UNION ALL
SELECT DATE_FORMAT(T.create_date,'%Y-%m-%d') AS each_day,0 AS settled_count, count(*) AS mcht_count,0 AS commitauditdate_count,0 AS qualificationthrough_count ,0 AS cooperatebegindate_count from bu_mcht_info T WHERE T.del_flag='0' AND T.create_date <![CDATA[ >= ]]> #{DateBegin} AND T.create_date <![CDATA[ <= ]]> #{DateEnd} GROUP BY DATE_FORMAT(T.create_date,'%Y-%m-%d')
UNION ALL
SELECT DATE_FORMAT(T.commit_audit_date,'%Y-%m-%d') AS each_day,0 AS settled_count, 0 AS mcht_count,count(*) AS commitauditdate_count,0 AS qualificationthrough_count ,0 AS cooperatebegindate_count from bu_mcht_info T WHERE T.del_flag='0'  AND T.mcht_type='2' AND T.commit_audit_date <![CDATA[ >= ]]> #{DateBegin} AND T.commit_audit_date <![CDATA[ <= ]]> #{DateEnd} GROUP BY DATE_FORMAT(T.create_date,'%Y-%m-%d')
UNION ALL
SELECT DATE_FORMAT(T.total_audit_date,'%Y-%m-%d') AS each_day,0 AS settled_count, 0 AS mcht_count,0 AS commitauditdate_count,count(*) AS qualificationthrough_count ,0 AS cooperatebegindate_count  from bu_mcht_info T WHERE T.del_flag='0' AND T.mcht_type='2' AND T.total_audit_date <![CDATA[ >= ]]> #{DateBegin} AND T.total_audit_date <![CDATA[ <= ]]> #{DateEnd} AND T.total_audit_status='2' GROUP BY DATE_FORMAT(T.create_date,'%Y-%m-%d')
UNION ALL
SELECT DATE_FORMAT(T.cooperate_begin_date,'%Y-%m-%d') AS each_day,0 AS settled_count, 0 AS mcht_count,0 AS commitauditdate_count,0 AS qualificationthrough_count ,count(*) AS cooperatebegindate_count  from bu_mcht_info T WHERE T.del_flag='0' AND T.mcht_type='2' AND T.cooperate_begin_date <![CDATA[ >= ]]> #{DateBegin} AND T.cooperate_begin_date <![CDATA[ <= ]]> #{DateEnd} GROUP BY DATE_FORMAT(T.create_date,'%Y-%m-%d')
)T GROUP BY t.each_day 	    
			    
 </select>

    <select id="totalmchtCoum" parameterType="java.util.HashMap" resultMap="BaseResultCustomMap">
SELECT t.each_day,SUM(mcht_count) mcht_count,SUM(settledun_submitted) settledun_submitted,SUM(settledau_dited) settledau_dited,SUM(settleda_dopt) settleda_dopt,SUM(shop_open) shop_open,SUM(contract_file) contract_file FROM (
SELECT DATE_FORMAT(t.create_date,'%Y-%m-%d') AS each_day,COUNT(*) as mcht_count, 0 AS settledun_submitted,0 AS settledau_dited,0 AS settleda_dopt ,0 AS shop_open,0 AS contract_file FROM bu_mcht_info t WHERE t.del_flag='0' AND t.create_date <![CDATA[ >= ]]> #{DateBegin} AND t.create_date <![CDATA[ <= ]]> #{DateEnd} GROUP BY DATE_FORMAT(t.create_date,'%Y-%m-%d')
UNION ALL
SELECT DATE_FORMAT(t.create_date,'%Y-%m-%d') AS each_day,0 AS mcht_count, COUNT(*) AS settledun_submitted,0 AS settledau_dited,0 AS settleda_dopt ,0 AS shop_open,0 AS contract_file FROM bu_mcht_info t WHERE t.del_flag='0' AND t.total_audit_status='4' AND t.status='0' AND t.create_date <![CDATA[ >= ]]> #{DateBegin} AND t.create_date <![CDATA[ <= ]]> #{DateEnd} GROUP BY DATE_FORMAT(t.create_date,'%Y-%m-%d')
UNION ALL
SELECT DATE_FORMAT(t.create_date,'%Y-%m-%d') AS each_day,0 AS mcht_count, 0 AS settledun_submitted,COUNT(*) AS settledau_dited,0 AS settleda_dopt ,0 AS shop_open,0 AS contract_file FROM bu_mcht_info t WHERE t.del_flag='0' AND t.total_audit_status in (0,1) AND t.status='0' AND t.create_date <![CDATA[ >= ]]> #{DateBegin} AND t.create_date <![CDATA[ <= ]]> #{DateEnd} GROUP BY DATE_FORMAT(t.create_date,'%Y-%m-%d')
UNION ALL
SELECT DATE_FORMAT(t.create_date,'%Y-%m-%d') AS each_day,0 AS mcht_count, 0 AS settledun_submitted,0 AS settledau_dited,COUNT(*) AS settleda_dopt ,0 AS shop_open,0 AS contract_file FROM bu_mcht_info t WHERE t.del_flag='0' AND t.total_audit_status='2' AND t.create_date <![CDATA[ >= ]]> #{DateBegin} AND t.create_date <![CDATA[ <= ]]> #{DateEnd} GROUP BY DATE_FORMAT(t.create_date,'%Y-%m-%d')
UNION ALL
SELECT DATE_FORMAT(t.create_date,'%Y-%m-%d') AS each_day,0 AS mcht_count, 0 AS settledun_submitted,0 AS settledau_dited,0 AS settleda_dopt ,COUNT(*) AS shop_open,0 AS contract_file FROM bu_mcht_info t WHERE t.del_flag='0' AND t.status='1' AND t.create_date <![CDATA[ >= ]]> #{DateBegin} AND t.create_date <![CDATA[ <= ]]> #{DateEnd} GROUP BY DATE_FORMAT(t.create_date,'%Y-%m-%d')
UNION ALL
SELECT DATE_FORMAT(t.create_date,'%Y-%m-%d') AS each_day,0 AS mcht_count, 0 AS settledun_submitted,0 AS settledau_dited,0 AS settleda_dopt ,0 AS shop_open, COUNT(*) AS contract_file FROM bu_mcht_contract t WHERE t.del_flag='0' AND t.archive_status='1' AND t.create_date <![CDATA[ >= ]]> #{DateBegin} AND t.create_date <![CDATA[ <= ]]> #{DateEnd} GROUP BY DATE_FORMAT(t.create_date,'%Y-%m-%d')
)T GROUP BY t.each_day 
  </select>

    <select id="totalmchtinfoCoum" parameterType="com.jf.entity.MchtInfoCustomExample" resultMap="BaseResultCustomMap">
  SELECT t.product_name,SUM(general_qualification) general_qualification,SUM(open_to_open) open_to_open,SUM(already_opened) already_opened,SUM(contract_filing) contract_filing,SUM(sendback) sendback,SUM(shop) shop,SUM(unsubmitted) unsubmitted,SUM(submission) submission,SUM(cancell_ation) cancell_ation  from (
SELECT p.`name` AS product_name,count(*) AS general_qualification, 0 AS open_to_open,0 AS already_opened,0 AS contract_filing,0 AS sendback,0 AS shop,0 AS unsubmitted,0 AS submission,0 AS cancell_ation from bu_mcht_info t,bu_product_type p,bu_mcht_product_type m WHERE m.mcht_id=t.id AND m.product_type_id=p.id AND m.is_main='1' AND m.status='1' AND p.status='1' AND t.total_audit_status='2' AND m.del_flag='0' AND p.del_flag='0' AND t.del_flag='0' GROUP BY p.`name`
UNION ALL
SELECT p.`name`AS product_name,0 AS general_qualification, count(*) AS open_to_open,0 AS already_opened,0 AS contract_filing ,0 AS sendback,0 AS shop,0 AS unsubmitted,0 AS submission,0 AS cancell_ation from bu_mcht_info t,bu_product_type p,bu_mcht_product_type m WHERE m.mcht_id=t.id AND m.product_type_id=p.id AND m.is_main='1' AND m.status='1' AND p.status='1' AND t.total_audit_status='2' AND t.`status`='0' AND m.del_flag='0' AND p.del_flag='0' AND t.del_flag='0' GROUP BY p.`name`
UNION ALL
SELECT p.`name` AS product_name,0 AS general_qualification, 0 AS open_to_open,count(*) AS already_opened,0 AS contract_filing ,0 AS sendback,0 AS shop,0 AS unsubmitted,0 AS submission,0 AS cancell_ation from bu_mcht_info t,bu_product_type p,bu_mcht_product_type m WHERE m.mcht_id=t.id AND m.product_type_id=p.id AND m.is_main='1' AND m.status='1' AND p.status='1' AND t.`status`='1' AND m.del_flag='0' AND p.del_flag='0' AND t.del_flag='0' GROUP BY p.`name`
UNION ALL
SELECT p.`name` AS product_name,0 AS general_qualification, 0 AS open_to_open,0 AS already_opened,count(*) AS contract_filing ,0 AS sendback,0 AS shop,0 AS unsubmitted,0 AS submission,0 AS cancell_ation  from bu_mcht_info t,bu_mcht_contract a,bu_product_type p,bu_mcht_product_type m WHERE a.mcht_id=t.id AND m.mcht_id=t.id AND m.product_type_id=p.id AND m.is_main='1' AND m.status='1' AND p.status='1' AND a.archive_status='1' AND m.del_flag='0' AND a.del_flag='0' AND p.del_flag='0' AND t.del_flag='0' GROUP BY t.id
UNION ALL
SELECT p.`name` AS product_name,0 AS general_qualification, 0 AS open_to_open,0 AS already_opened,0 AS contract_filing,count(*) AS sendback,0 AS shop,0 AS unsubmitted,0 AS submission,0 AS cancell_ation from bu_mcht_info t,bu_mcht_contract a,bu_product_type p,bu_mcht_product_type m WHERE a.mcht_id=t.id AND m.mcht_id=t.id AND m.product_type_id=p.id AND m.is_main='1' AND m.status='1' AND p.status='1' AND a.archive_status='2' AND m.del_flag='0' AND a.del_flag='0' AND p.del_flag='0' AND t.del_flag='0' GROUP BY p.`name`
UNION ALL
SELECT p.`name` AS product_name,0 AS general_qualification, 0 AS open_to_open,0 AS already_opened,0 AS contract_filing ,0 AS sendback,count(*) AS shop,0 AS unsubmitted,0 AS submission,0 AS cancell_ation  from bu_mcht_info t,bu_product_type p,bu_mcht_product_type m WHERE m.mcht_id=t.id AND m.product_type_id=p.id AND m.is_main='1' AND m.status='1' AND p.status='1' AND t.`status` in ('3','5') AND t.cooperate_begin_date IS NOT NULL AND m.del_flag='0' AND p.del_flag='0' AND t.del_flag='0' GROUP BY p.`name`
UNION ALL
SELECT p.`name` AS product_name,0 AS general_qualification, 0 AS open_to_open,0 AS already_opened,0 AS contract_filing ,0 AS sendback,0 AS shop,count(*) AS unsubmitted,0 AS submission,0 AS cancell_ation from bu_mcht_info t,bu_product_type p,bu_mcht_product_type m WHERE m.mcht_id=t.id AND m.product_type_id=p.id AND m.is_main='1' AND m.status='1' AND p.status='1' AND t.`status`='0' AND t.total_audit_status='4' AND m.del_flag='0' AND p.del_flag='0' AND t.del_flag='0' GROUP BY p.`name`
UNION ALL
SELECT p.`name` AS product_name,0 AS general_qualification, 0 AS open_to_open,0 AS already_opened,0 AS contract_filing,0 AS sendback,0 AS shop,0 AS unsubmitted,count(*) AS submission,0 AS cancell_ation from bu_mcht_info t,bu_product_type p,bu_mcht_product_type m WHERE m.mcht_id=t.id AND m.product_type_id=p.id AND m.is_main='1' AND m.status='1' AND p.status='1' AND t.`status`='0' AND t.total_audit_status<![CDATA[ <> ]]>4 AND m.del_flag='0' AND p.del_flag='0' AND t.del_flag='0' GROUP BY p.`name`
UNION ALL
SELECT p.`name` AS product_name,0 AS general_qualification, 0 AS open_to_open,0 AS already_opened,0 AS contract_filing,0 AS sendback,0 AS shop,0 AS unsubmitted,0 AS submission,count(*) AS cancell_ation from bu_mcht_info t,bu_product_type p,bu_mcht_product_type m WHERE m.mcht_id=t.id AND m.product_type_id=p.id AND m.is_main='1' AND m.status='1' AND p.status='1' AND t.cooperate_begin_date IS NULL AND t.`status` in ('3','5') AND m.del_flag='0' AND p.del_flag='0' AND t.del_flag='0' GROUP BY p.`name`
)T GROUP BY t.product_name
  </select>


    <!-- 结算金额情况 -->
    <select id="selectSettlementAmount" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT
        A.mcht_id,
        (SELECT mi.mcht_code FROM bu_mcht_info mi WHERE mi.del_flag = '0' AND mi.id = A.mcht_id) mcht_code,
        (SELECT mi.company_name FROM bu_mcht_info mi WHERE mi.del_flag = '0' AND mi.id = A.mcht_id) company_name,
        (SELECT mi.shop_name FROM bu_mcht_info mi WHERE mi.del_flag = '0' AND mi.id = A.mcht_id) shop_name,
        (SELECT sum(mso.settle_amount) FROM bu_mcht_settle_order mso WHERE mso.mcht_id = A.mcht_id AND mso.del_flag =
        '0') close_settle_amount,
        MAX(A.open_settle_amount) open_settle_amount,
        MAX(A.sum_settle_amount) sum_settle_amount,
        MAX(A.sum_customer_amount) sum_customer_amount
        FROM
        (
        (
        SELECT
        so.mcht_id mcht_id,
        0 open_settle_amount,
        IFNULL(sum(od.settle_amount), 0) sum_settle_amount,
        0 sum_customer_amount
        FROM
        bu_combine_order co,
        bu_sub_order so,
        bu_order_dtl od
        WHERE
        co.del_flag = '0'
        AND so.del_flag = '0'
        AND od.del_flag = '0'
        AND co.id = so.combine_order_id
        AND so.id = od.sub_order_id
        AND co.pay_date <![CDATA[ < ]]> date_format(now(), '%Y-%m-%d 00:00:00')
        AND co.pay_status = '1'
        AND (
        od.product_status = '1'
        OR od.product_status IS NULL
        OR od.product_status = ''
        )
        GROUP BY
        so.mcht_id
        )
        UNION ALL
        (
        SELECT
        so.mcht_id mcht_id,
        IFNULL(sum(od.settle_amount), 0) open_settle_amount,
        0 sum_settle_amount,
        0 sum_customer_amount
        FROM
        bu_combine_order co,
        bu_sub_order so,
        bu_order_dtl od
        WHERE
        co.del_flag = '0'
        AND so.del_flag = '0'
        AND od.del_flag = '0'
        AND co.id = so.combine_order_id
        AND so.id = od.sub_order_id
        AND co.pay_date <![CDATA[ < ]]> date_format(now(), '%Y-%m-%d 00:00:00')
        AND co.pay_status = '1'
        AND (
        od.product_status = '1'
        OR od.product_status IS NULL
        OR od.product_status = ''
        )
        AND (
        od.mcht_settle_order_id IS NULL
        OR od.mcht_settle_order_id = ''
        )
        GROUP BY
        so.mcht_id
        )
        UNION ALL
        (
        SELECT
        so.mcht_id mcht_id,
        0 open_settle_amount,
        0 sum_settle_amount,
        IFNULL(sum(cs.amount), 0) sum_customer_amount
        FROM
        bu_sub_order so,
        bu_customer_service_order cs
        WHERE
        so.del_flag = '0'
        AND cs.del_flag = '0'
        AND so.id = cs.sub_order_id
        AND cs.service_type = 'D'
        AND cs. STATUS = '1'
        GROUP BY
        so.mcht_id
        )
        ) A
        WHERE
        EXISTS (
        SELECT
        mi.id
        FROM
        bu_mcht_info mi
        WHERE
        mi.id = A.mcht_id
        AND mi.del_flag = '0'
        AND mi.`status` <![CDATA[ <> ]]> '0'
        <if test="mchtCode != null">
            AND mi.mcht_code = #{mchtCode}
        </if>
        <if test="mchtName != null">
            AND (mi.company_name LIKE CONCAT('%',#{mchtName},'%') OR mi.shop_name LIKE CONCAT('%',#{mchtName},'%'))
        </if>
        <if test="productTypeId !=null and productTypeId != ''">
            AND A.mcht_id in (select mpt.mcht_id from bu_mcht_product_type mpt where mpt.del_flag = '0' and
            A.mcht_id=mpt.mcht_id and mpt.status = '1' and mpt.product_type_id=#{productTypeId})
        </if>
        <if test="productBrandName !=null and productBrandName != ''">
            AND A.mcht_id in (select mp.mcht_id from bu_product_brand pb,bu_mcht_product_brand mp where
            mp.product_brand_id=pb.id and mp.mcht_id = A.mcht_id and mp.audit_status = '3' and pb.del_flag='0' and
            mp.del_flag='0' and (pb.name LIKE concat('%',#{productBrandName},'%') OR pb.name_zh LIKE
            concat('%',#{productBrandName},'%') OR pb.name_en LIKE concat('%',#{productBrandName},'%')))
        </if>
        )
        GROUP BY
        A.mcht_id
        <if test="abnormityFlag != null">
            HAVING
            0 <![CDATA[ <> ]]> (
            (
            SELECT
            IFNULL(sum(mso.settle_amount), 0)
            FROM
            bu_mcht_settle_order mso
            WHERE
            mso.mcht_id = A.mcht_id
            AND mso.del_flag = '0'
            ) + MAX(A.open_settle_amount) + MAX(A.sum_customer_amount) - MAX(A.sum_settle_amount)
            )
        </if>
        <if test="orderByClause != null">
            ORDER BY ${orderByClause}
        </if>
        LIMIT #{limitStart} , #{limitSize}
    </select>

    <select id="selectSettlementAmountCount" parameterType="java.util.HashMap" resultType="java.lang.Integer">
        SELECT
        COUNT(B.mcht_id)
        FROM
        (SELECT
        A.mcht_id
        FROM
        (
        (
        SELECT
        so.mcht_id mcht_id,
        0 open_settle_amount,
        IFNULL(sum(od.settle_amount), 0) sum_settle_amount,
        0 sum_customer_amount
        FROM
        bu_combine_order co,
        bu_sub_order so,
        bu_order_dtl od
        WHERE
        co.del_flag = '0'
        AND so.del_flag = '0'
        AND od.del_flag = '0'
        AND co.id = so.combine_order_id
        AND so.id = od.sub_order_id
        AND co.pay_date <![CDATA[ < ]]> date_format(now(), '%Y-%m-%d 00:00:00')
        AND co.pay_status = '1'
        AND (
        od.product_status = '1'
        OR od.product_status IS NULL
        OR od.product_status = ''
        )
        GROUP BY
        so.mcht_id
        )
        UNION ALL
        (
        SELECT
        so.mcht_id mcht_id,
        IFNULL(sum(od.settle_amount), 0) open_settle_amount,
        0 sum_settle_amount,
        0 sum_customer_amount
        FROM
        bu_combine_order co,
        bu_sub_order so,
        bu_order_dtl od
        WHERE
        co.del_flag = '0'
        AND so.del_flag = '0'
        AND od.del_flag = '0'
        AND co.id = so.combine_order_id
        AND so.id = od.sub_order_id
        AND co.pay_date <![CDATA[ < ]]> date_format(now(), '%Y-%m-%d 00:00:00')
        AND co.pay_status = '1'
        AND (
        od.product_status = '1'
        OR od.product_status IS NULL
        OR od.product_status = ''
        )
        AND (
        od.mcht_settle_order_id IS NULL
        OR od.mcht_settle_order_id = ''
        )
        GROUP BY
        so.mcht_id
        )
        UNION ALL
        (
        SELECT
        so.mcht_id mcht_id,
        0 open_settle_amount,
        0 sum_settle_amount,
        IFNULL(sum(cs.amount), 0) sum_customer_amount
        FROM
        bu_sub_order so,
        bu_customer_service_order cs
        WHERE
        so.del_flag = '0'
        AND cs.del_flag = '0'
        AND so.id = cs.sub_order_id
        AND cs.service_type = 'D'
        AND cs. STATUS = '1'
        GROUP BY
        so.mcht_id
        )
        ) A
        WHERE
        EXISTS (
        SELECT
        mi.id
        FROM
        bu_mcht_info mi
        WHERE
        mi.id = A.mcht_id
        AND mi.del_flag = '0'
        AND mi.`status` <![CDATA[ <> ]]> '0'
        <if test="mchtCode != null">
            AND mi.mcht_code = #{mchtCode}
        </if>
        <if test="mchtName != null">
            AND (mi.company_name LIKE CONCAT('%',#{mchtName},'%') OR mi.shop_name LIKE CONCAT('%',#{mchtName},'%'))
        </if>
        <if test="productTypeId !=null and productTypeId != ''">
            AND A.mcht_id in (select mpt.mcht_id from bu_mcht_product_type mpt where mpt.del_flag = '0' and
            A.mcht_id=mpt.mcht_id and mpt.status = '1' and mpt.product_type_id=#{productTypeId})
        </if>
        <if test="productBrandName !=null and productBrandName != ''">
            AND A.mcht_id in (select mp.mcht_id from bu_product_brand pb,bu_mcht_product_brand mp where
            mp.product_brand_id=pb.id and mp.mcht_id = A.mcht_id and mp.audit_status = '3' and pb.del_flag='0' and
            mp.del_flag='0' and (pb.name LIKE concat('%',#{productBrandName},'%') OR pb.name_zh LIKE
            concat('%',#{productBrandName},'%') OR pb.name_en LIKE concat('%',#{productBrandName},'%')))
        </if>
        )
        GROUP BY
        A.mcht_id
        <if test="abnormityFlag != null">
            HAVING
            0 <![CDATA[ <> ]]> (
            (
            SELECT
            IFNULL(sum(mso.settle_amount), 0)
            FROM
            bu_mcht_settle_order mso
            WHERE
            mso.mcht_id = A.mcht_id
            AND mso.del_flag = '0'
            ) + MAX(A.open_settle_amount) + MAX(A.sum_customer_amount) - MAX(A.sum_settle_amount)
            )
        </if>
        ) B
    </select>


    <!-- 招商入驻进度 -->
    <!-- Pengl -->
    <sql id="Mcht_Info_Audit_Custom_Column_List">
        id, mcht_code, short_name, mcht_type, cooperate_begin_date, is_manage_self, agreement_begin_date,
        agreement_end_date, shop_name, shop_catalog, business_firms, product_type, brand,
        shop_type, shop_name_audit_status, shop_name_audit_remarks, status, status_date,
        total_audit_status, total_audit_remarks, total_audit_date, commit_audit_date, is_total_audit_re_commit,
        company_name, company_type, company_reg_name, uscc, company_address, founded_date,
        reg_capital, reg_fee_type, corporation_name, corporation_idcard_no, corporation_mobile,
        corporation_idcard_img_1, corporation_idcard_img_2, bl_pic, occ_pic, trc_pic, atq_pic,
        boaal_pic, yearly_inspection_date, company_tel, contact_province, contact_city, contact_county,
        contact_address, is_company_inf_perfect, company_inf_audit_remarks, contract_deposit,
        brand_deposit, select_contract_deposit, select_brand_deposit, deposit_type, deposit_content,
        custom_service_type, sobot_id, xiaoneng_id, in_blacklist, zs_audit_status, zs_audit_by,
        finance_confirm_status, finance_confirm_by, shop_status, shop_status_date, shop_logo,
        grade, activity_auth_status, shop_name_audit_inner_remarks, zs_total_audit_status,
        zs_total_audit_by, zs_total_audit_remarks, zs_total_audit_date, is_zs_total_audit_re_commit,
        zs_commit_audit_date, total_audit_by, idcard_img_1_archive_status, idcard_img_2_archive_status,
        occ_pic_archive_status, trc_pic_archive_status, atq_pic_archive_status, boaal_pic_archive_status,
        company_inf_audit_inner_remarks, activity_auth_status_date, operate_status, operate_status_date,
        operate_remarks, fee_rate, archive_status, allow_mcht_apply_close, company_info_archive_status,
        mcht_brand_archive_status, scope_of_business, delay_status, delay_days, change_apply_type,
        change_end_date, settled_type, specially_approved_status, specially_approved_remarks,
        last_close_date, last_close_remarks, supply_chain_status, license_is_must, business_license_pic,
        license_status, license_reject_reason, other, create_by, create_date, update_by,
        update_date, del_flag,

        (SELECT pc.contact_name FROM bu_platform_contact pc, bu_mcht_platform_contact mpc WHERE pc.del_flag = '0' AND
        mpc.del_flag = '0' AND pc.contact_type = '1' AND mpc.status = '1' AND pc.id = mpc.platform_contact_id AND
        mpc.mcht_id = t.id and pc.status='0' LIMIT 1) zs_contact_name, <!-- 1 招商对接人 -->
        FUN_GET_STATUS_DESC("BU_MCHT_INFO", "STATUS", t.status) mcht_status_desc, <!-- 合作状态 -->
        (SELECT pt.name FROM bu_mcht_product_type mpt, bu_product_type pt WHERE mpt.del_flag = '0' AND pt.del_flag = '0'
        AND mpt.is_main = '1' AND pt.status = '1' AND mpt.product_type_id = pt.id AND mpt.mcht_id = t.id LIMIT 1)
        mcht_product_type_name, <!-- 主营类目 -->
        (SELECT GROUP_CONCAT(CONCAT('[', FUN_GET_STATUS_DESC('BU_MCHT_PRODUCT_BRAND', 'AUDIT_STATUS', mpb.audit_status),
        ']', mpb.product_brand_name)) FROM bu_mcht_product_brand mpb WHERE mpb.del_flag = '0' AND mpb.status != '3' AND
        mpb.mcht_id = t.id ) product_brand_name_audit_status, <!-- 品牌 -->
        (SELECT msa.contact_name FROM bu_mcht_settled_apply msa WHERE msa.del_flag = '0' AND msa.mcht_id = t.id )
        mcht_settled_contact_name, <!-- 联系人 -->
        (SELECT msa.phone FROM bu_mcht_settled_apply msa WHERE msa.del_flag = '0' AND msa.mcht_id = t.id )
        mcht_settled_phone, <!-- 联系电话 -->
        FUN_GET_STATUS_DESC("BU_MCHT_INFO", "TOTAL_AUDIT_STATUS", t.total_audit_status)
        mcht_total_audit_status_desc, <!-- 法务总审状态 -->
        FUN_GET_STATUS_DESC("BU_MCHT_CONTRACT", "AUDIT_STATUS", (SELECT mc.audit_status FROM bu_mcht_contract mc WHERE
        mc.del_flag = '0' AND mc.mcht_id = t.id ORDER BY mc.id DESC LIMIT 1))
        mcht_contract_audit_status_desc, <!-- 线上合同 -->
        (SELECT md.total_amt FROM bu_mcht_deposit md WHERE md.del_flag = '0' AND md.mcht_id = t.id)
        mcht_deposit_total_amt, <!-- 应缴保证金 -->
        (SELECT md.pay_amt FROM bu_mcht_deposit md WHERE md.del_flag = '0' AND md.mcht_id = t.id)
        mcht_deposit_pay_amt, <!-- 已缴保证金 -->
        FUN_GET_STATUS_DESC("BU_MCHT_INFO", "DEPOSIT_TYPE", t.deposit_type) mcht_deposit_type_desc, <!-- 保证金类型 -->
        (SELECT mc.is_mcht_send FROM bu_mcht_contract mc WHERE mc.del_flag = '0' AND mc.mcht_id = t.id ORDER BY mc.id
        DESC LIMIT 1 ) mcht_contract_is_mcht_send, <!-- 商家合同寄出 -->
        FUN_GET_STATUS_DESC("BU_MCHT_CONTRACT", "ARCHIVE_STATUS", (SELECT mc.archive_status FROM bu_mcht_contract mc
        WHERE mc.del_flag = '0' AND mc.mcht_id = t.id ORDER BY mc.id DESC LIMIT 1 ))
        mcht_contract_archive_status_desc, <!-- 合同归档 -->
        (SELECT mc.is_platform_send FROM bu_mcht_contract mc WHERE mc.del_flag = '0' AND mc.mcht_id = t.id ORDER BY
        mc.id DESC LIMIT 1 ) mcht_contract_is_platform_send, <!-- 平台合同寄出 -->
        (SELECT mc.remarks FROM bu_mcht_contract mc WHERE mc.del_flag = '0' AND mc.mcht_id = t.id ORDER BY mc.id DESC
        LIMIT 1 ) mcht_contract_remarks, <!-- 合同备注驳回原因 -->
        <!-- (SELECT IFNULL(SUM(pi.stock), 0) FROM bu_product p, bu_product_item pi WHERE p.del_flag = '0' AND pi.del_flag = '0' AND p.id = pi.product_id AND p.mcht_id = t.id ) mcht_product_sum,--> <!-- 商品数 -->
        (SELECT IFNULL(COUNT(p.id), 0) FROM bu_product p WHERE p.del_flag = '0' AND p.mcht_id = t.id )
        mcht_product_sum, <!-- 商品数 -->
        <!--近月销售额 -->
        <!-- 近月特卖数 -->
        <![CDATA[
			(SELECT IFNULL(SUM(ol.pay_amount), 0) FROM bu_sub_order so, bu_order_dtl ol WHERE so.del_flag = '0' AND ol.del_flag = '0' AND so.id = ol.sub_order_id AND so.create_date <= NOW() AND so.create_date >= DATE_SUB(NOW(), INTERVAL 30 DAY) AND so.mcht_id = t.id ) order_dtl_pay_amount_sum, 
			(SELECT COUNT(aa.id) FROM bu_activity_area aa, bu_activity a WHERE aa.del_flag = '0' AND a.del_flag = '0' AND aa.source = '2' AND aa.activity_begin_time <= NOW() AND aa.activity_begin_time >= DATE_SUB(NOW(), INTERVAL 30 DAY) AND aa.id = a.activity_area_id AND aa.mcht_id = t.id) activity_area_count, 
	    ]]>
        (SELECT GROUP_CONCAT(CONCAT('[', FUN_GET_STATUS_DESC('BU_MCHT_PRODUCT_BRAND', 'AUDIT_STATUS', mpb.audit_status),
        ']', mpb.product_brand_name), '(', round(IFNULL(mpb.pop_commission_rate, 0)*100), '%)') FROM
        bu_mcht_product_brand mpb WHERE mpb.del_flag = '0' AND mpb.status != '3' AND mpb.mcht_id = t.id )
        product_brand_name_audit_status_rate <!-- 品牌（pop佣金比例） -->
    </sql>
    <select id="selectMchtInfoAudit" resultType="java.util.Map" parameterType="com.jf.entity.MchtInfoCustomExample">
        select
        <if test="distinct">
            distinct
        </if>
        <include refid="Mcht_Info_Audit_Custom_Column_List"/>
        from bu_mcht_info t
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
        <if test="orderByClause != null">
            order by ${orderByClause}
        </if>
        <if test="limitStart != null and limitStart>=0">
            limit #{limitStart} , #{limitSize}
        </if>
    </select>
    <select id="countMchtInfoAudit" parameterType="com.jf.entity.MchtInfoCustomExample" resultType="java.lang.Integer">
        select count(*) from bu_mcht_info t
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
    </select>

    <sql id="Mcht_Shop_Manager_Column_List">
		a.*,
		(select GROUP_CONCAT(d.name separator ',') from bu_mcht_product_type c, bu_product_type d where c.mcht_id=a.id and c.del_flag='0' and c.product_type_id=d.id and d.del_flag=0 and c.is_main='1' and c.status='1' and d.status='1') mcht_product_type,
		(select GROUP_CONCAT(d.name separator ',') from bu_mcht_product_brand c, bu_product_brand d where c.mcht_id=a.id and c.del_flag='0' and c.product_brand_id=d.id and d.del_flag=0 and c.status='1' and d.status='1') mcht_product_brand,
		(select count(p.id) from bu_product p where p.mcht_id = a.id and p.del_flag='0')total_product_count,
		(select count(p.id) from bu_product p where p.mcht_id = a.id and p.del_flag='0' and p.status='1' and p.audit_status='2' and p.is_show='1')up_product_count,
		FUN_GET_STATUS_DESC("BU_MCHT_INFO", "SHOP_STATUS", a.shop_status) shop_status_desc,
		(select b.create_date from bu_shop_status_log b where b.mcht_id = a.id and b.del_flag='0' order by b.id desc limit 1)last_open_date,
		(select GROUP_CONCAT(fc.rule separator ';') from bu_shop_preferential_info spi,bu_full_cut fc where spi.mcht_id = a.id and spi.preferential_id = fc.id and spi.del_flag='0' and fc.del_flag='0' and spi.status='1' and spi.begin_date <![CDATA[ <= ]]> now() and spi.end_date <![CDATA[ >= ]]> now() and spi.type='2') full_cut_rules,
		(select GROUP_CONCAT(fd.rule separator ';') from bu_shop_preferential_info spi,bu_full_discount fd where spi.mcht_id = a.id and spi.preferential_id = fd.id and spi.del_flag='0' and fd.del_flag='0' and spi.status='1' and spi.begin_date <![CDATA[ >= ]]> now() and spi.end_date <![CDATA[ <= ]]> now() and spi.type='4') full_discount_rules,
		(SELECT IFNULL(AVG( t.product_score ),5) AS avg_product_score FROM bu_comment t WHERE t.del_flag = '0' AND t.is_append_comment = '0' AND t.mcht_id = a.id) avg_product_score,
		(SELECT IFNULL((AVG( ss.wuliu_score ) + AVG( ss.mcht_score )),10) AS avg_serve_score FROM bu_shop_score ss WHERE ss.del_flag = '0' AND ss.mcht_id = a.id) avg_serve_score,
		(select SUM(od.pay_amount) FROM bu_order_dtl od,bu_sub_order so WHERE od.sub_order_id = so.id AND so.mcht_id=a.id AND od.product_status='1')allPayAmount,
		(select SUM(od.quantity) FROM bu_order_dtl od,bu_sub_order so WHERE od.sub_order_id = so.id AND so.mcht_id=a.id AND od.product_status='1' )allQuantity
	</sql>

    <select id="selectMchtShopManagerList" resultType="java.util.Map"
            parameterType="com.jf.entity.MchtInfoCustomExample">
        select
        <if test="distinct">
            distinct
        </if>
        <include refid="Mcht_Shop_Manager_Column_List"/>
        from bu_mcht_info a
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
        <if test="orderByClause != null">
            order by ${orderByClause}
        </if>
        <if test="limitStart != null and limitStart>=0">
            limit #{limitStart} , #{limitSize}
        </if>
    </select>
    <select id="countMchtShopManagerList" parameterType="com.jf.entity.MchtInfoCustomExample"
            resultType="java.lang.Integer">
        select count(*) from bu_mcht_info a
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
    </select>
    <select id="getMchtInfoByMchtCode" resultType="java.util.Map" parameterType="java.lang.String">
		select 
			GROUP_CONCAT(d.name separator ',') as mcht_product_type,a.shop_status,a.activity_auth_status,a.company_name,a.shop_name,a.mcht_code,a.id
		from bu_mcht_info a,bu_mcht_product_type c, bu_product_type d 
			where c.mcht_id=a.id and c.del_flag='0' and c.product_type_id=d.id and d.del_flag=0 and c.is_main='1' and c.status='1' and a.del_flag='0' and a.status='1' and a.mcht_code=#{mchtCode}
	</select>


    <sql id="Base_Mcht_Info_Column_List">
        id, mcht_code, short_name, mcht_type, cooperate_begin_date, is_manage_self, agreement_begin_date,
        agreement_end_date, shop_name, shop_catalog, business_firms, product_type, brand,
        shop_type, shop_name_audit_status, shop_name_audit_remarks, status, status_date,
        total_audit_status, total_audit_remarks, total_audit_date, commit_audit_date, is_total_audit_re_commit,
        company_name, company_type, company_reg_name, uscc, company_address, founded_date,
        reg_capital, reg_fee_type, corporation_name, corporation_idcard_no, corporation_mobile,
        corporation_idcard_img_1, corporation_idcard_img_2, bl_pic, occ_pic, trc_pic, atq_pic,
        boaal_pic, yearly_inspection_date, company_tel, contact_province, contact_city, contact_county,
        contact_address, is_company_inf_perfect, company_inf_audit_remarks, contract_deposit,
        brand_deposit, select_contract_deposit, select_brand_deposit, deposit_type, deposit_content,
        custom_service_type, sobot_id, xiaoneng_id, in_blacklist, zs_audit_status, zs_audit_by,
        finance_confirm_status, finance_confirm_by, shop_status, shop_status_date, shop_logo,
        grade, activity_auth_status, shop_name_audit_inner_remarks, zs_total_audit_status,
        zs_total_audit_by, zs_total_audit_remarks, zs_total_audit_date, is_zs_total_audit_re_commit,
        zs_commit_audit_date, total_audit_by, idcard_img_1_archive_status, idcard_img_2_archive_status,
        occ_pic_archive_status, trc_pic_archive_status, atq_pic_archive_status, boaal_pic_archive_status,
        company_inf_audit_inner_remarks, activity_auth_status_date, operate_status, operate_status_date,
        operate_remarks, fee_rate, archive_status, allow_mcht_apply_close, company_info_archive_status,
        mcht_brand_archive_status, scope_of_business, delay_status, delay_days, change_apply_type,
        change_end_date, settled_type, specially_approved_status, specially_approved_remarks,
        last_close_date, last_close_remarks, supply_chain_status, license_is_must, business_license_pic,
        license_status, license_reject_reason, other, create_by, create_date, update_by,
        update_date, del_flag,
        (select pt.name from bu_mcht_product_type mpt, bu_product_type pt where mpt.mcht_id = a.id and mpt.is_main = '1'
        and mpt.del_flag = '0' and mpt.product_type_id = pt.id and pt.del_flag = '0' LIMIT 1 )
        product_type_name, <!-- 主营类目 -->
        (select IFNULL(SUM(od.quantity), 0) from bu_sub_order so, bu_order_dtl od where so.del_flag = '0' and
        od.del_flag = '0' and so.status = '3' and so.id = od.sub_order_id and od.product_status = '1' and od.is_give =
        '0' and so.mcht_id = a.id ) sum_quantity, <!-- 销售量 -->
        (select TRUNCATE(AVG(c.product_score), 2) from bu_comment c where c.del_flag = '0' and c.is_append_comment = '0'
        and c.mcht_id = a.id ) avg_product_score, <!-- 商品评价得分 -->
        (select TRUNCATE(AVG(ss.mcht_score), 2) from bu_shop_score ss where ss.del_flag = '0' and ss.mcht_id = a.id )
        avg_mcht_score, <!-- 卖家服务得分 -->
        (select TRUNCATE(AVG(ss.wuliu_score), 2) from bu_shop_score ss where ss.del_flag = '0' and ss.mcht_id = a.id )
        avg_wuliu_score, <!-- 物流服务得分 -->
        (select group_concat(concat(mpb.id, '|', FUN_GET_STATUS_DESC("BU_MCHT_PRODUCT_BRAND","AUDIT_STATUS",
        mpb.audit_status), '|', FUN_GET_STATUS_DESC("BU_MCHT_PRODUCT_BRAND","STATUS", mpb.status), '|', IFNULL((select
        pb.name from bu_product_brand pb where pb.id = mpb.product_brand_id and pb.del_flag='0' LIMIT 1), ''), '|',
        IFNULL(mpb.product_brand_name, ''))) from bu_mcht_product_brand mpb where mpb.del_flag = '0' and mpb.status !=
        '3' and mpb.mcht_id = a.id ) mcht_product_brand_custom <!-- 品牌/资质/开通 -->

    </sql>
    <select id="selectMchtInfoCustomExample" resultType="java.util.HashMap"
            parameterType="com.jf.entity.MchtInfoCustomExample">
        select
        <if test="distinct">
            distinct
        </if>
        <include refid="Base_Mcht_Info_Column_List"/>
        from bu_mcht_info a
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
        <if test="orderByClause != null">
            order by ${orderByClause}
        </if>
        <if test="limitStart != null and limitStart>=0">
            limit #{limitStart} , #{limitSize}
        </if>
    </select>

    <!-- 店铺优化列表 -->
    <select id="selectMchtInfoCustomList" parameterType="java.util.Map" resultType="java.util.Map">
        select
        t.*,
        (select mc.id from bu_mcht_contract mc where mc.mcht_id = t.id and mc.del_flag = '0' order by id desc limit 1)
        mcht_contract_id,
        <!-- FUN_GET_MCHT_EXPRESS_100DAYS(t.id) express_names, -->
        (select pt.name from bu_mcht_product_type mpt, bu_product_type pt where mpt.mcht_id = t.id and mpt.is_main = '1'
        and mpt.del_flag = '0' and mpt.product_type_id = pt.id and pt.del_flag = '0' limit 1 )
        product_type_name, <!-- 主营类目 -->
        (select GROUP_CONCAT(CONCAT(pb.`name`,'（',ROUND(mpb.pop_commission_rate*100),'%）',pb.id)) from
        bu_mcht_product_brand mpb, bu_product_brand pb where mpb.mcht_id = t.id and mpb.del_flag = '0' and
        mpb.product_brand_id = pb.id and pb.del_flag = '0') mcht_product_brand_name, <!-- 品牌 -->
        (select md.total_amt from bu_mcht_deposit md where md.del_flag = '0' and md.mcht_id = t.id )
        total_amt, <!-- 应缴保证金 -->
        (select md.pay_amt from bu_mcht_deposit md where md.del_flag = '0' and md.mcht_id = t.id )
        pay_amt, <!-- 已缴保证金 -->
        FUN_GET_STATUS_DESC("BU_MCHT_INFO", "STATUS", t.status) status_desc, <!-- 合作状态 -->
        FUN_GET_STATUS_DESC("BU_MCHT_INFO", "ARCHIVE_STATUS", t.archive_status) archive_status_desc, <!-- 归档状态 -->
        (select mc.archive_status from bu_mcht_contract mc where mc.del_flag = '0' and mc.mcht_id = t.id order by mc.id
        desc limit 1) contract_archive_status, <!-- 合同归档状态 -->
        FUN_GET_STATUS_DESC("BU_MCHT_CONTRACT", "ARCHIVE_STATUS", (select mc.archive_status from bu_mcht_contract mc
        where mc.del_flag = '0' and mc.mcht_id = t.id order by mc.id desc limit 1))
        contract_archive_status_desc, <!-- 合同归档状态备注 -->
        FUN_GET_STATUS_DESC("BU_MCHT_OPTIMIZE", "AUDIT_RISK", (select mo.audit_risk from bu_mcht_optimize mo where
        mo.del_flag = '0' and mo.mcht_id = t.id)) audit_risk_desc, <!-- 法务风险等级 -->
        (select COUNT(1) from bu_product p where p.del_flag = '0' and p.mcht_id = t.id )
        mcht_product_count, <!-- 发布商品数量 -->
        <!-- <![CDATA[ (select COUNT(1) from bu_activity ba, bu_activity_area baa where ba.del_flag = '0' and ba.status = '6' and ba.mcht_id = t.id and ba.activity_area_id = baa.id and baa.del_flag = '0' and baa.source = '2' and baa.activity_begin_time >= #{periodDateBegin } and baa.activity_begin_time <= #{periodDateEnd } ) activity_count, ]]> 近期特卖数
        <![CDATA[ (select IFNULL(SUM(so.pay_amount), 0) from bu_sub_order so, bu_combine_order co where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date >= #{periodDateBegin } and co.pay_date <= #{periodDateEnd } ) pay_amount_sum, ]]> 近期销售额
        <![CDATA[ (select COUNT(1) from bu_sub_order so, bu_combine_order co where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date >= #{periodDateBegin } and co.pay_date <= #{periodDateEnd } ) sub_order_count, ]]> 近期订单数
        <![CDATA[ IF((select COUNT(1) from bu_sub_order so, bu_combine_order co, bu_customer_service_order cso where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date >= #{periodDateBegin } and co.pay_date <= #{periodDateEnd } and cso.del_flag = '0' and cso.sub_order_id = so.id and cso.service_type = 'B' ) = 0,
                    '0.0%',
                    CONCAT(ROUND(
                        (select COUNT(1) from bu_sub_order so, bu_combine_order co, bu_customer_service_order cso where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date >= #{periodDateBegin } and co.pay_date <= #{periodDateEnd } and cso.del_flag = '0' and cso.sub_order_id = so.id and cso.service_type = 'B' )
                        /(select SUM(od.quantity) from bu_sub_order so, bu_combine_order co, bu_order_dtl od where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date >= #{periodDateBegin } and co.pay_date <= #{periodDateEnd } AND od.sub_order_id = co.id )*100, 1), '%')) customer_service_order_rate, ]]> 近期退货率
        <![CDATA[ IF((select COUNT(1) from bu_sub_order so, bu_combine_order co, bu_appeal_order ao where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date >= #{periodDateBegin } and co.pay_date <= #{periodDateEnd } and ao.del_flag = '0' and ao.sub_order_id = so.id ) = 0,
                    '0.0%',
                    CONCAT(ROUND(
                        (select COUNT(1) from bu_sub_order so, bu_combine_order co, bu_appeal_order ao where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date >= #{periodDateBegin } and co.pay_date <= #{periodDateEnd } and ao.del_flag = '0' and ao.sub_order_id = so.id )
                        /(select SUM(od.quantity) from bu_sub_order so, bu_combine_order co, bu_order_dtl od where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date >= #{periodDateBegin } and co.pay_date <= #{periodDateEnd } AND od.sub_order_id = co.id )*100, 1), '%')) appeal_order_rate, ]]> 近期投诉率
        <![CDATA[ ROUND((select ifnull(sum(c.product_score), 0) from bu_comment c where c.del_flag = '0' and c.mcht_id = t.id and c.create_date >= #{periodDateBegin } and c.create_date <= #{periodDateEnd })
                        /(select COUNT(1) from bu_comment c where c.del_flag = '0' and c.mcht_id = t.id and c.create_date >= #{periodDateBegin } and c.create_date <= #{periodDateEnd } ), 2) product_score_avg, ]]> 评价平均分
        <![CDATA[ IF((select COUNT(DISTINCT od.id) from bu_sub_order so, bu_combine_order co, bu_order_dtl od, bu_customer_service_order cso, bu_intervention_order io where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date >= #{periodDateBegin } and co.pay_date <= #{periodDateEnd } and od.sub_order_id = so.id and cso.del_flag = '0' and cso.order_dtl_id = od.id and io.del_flag = '0' and io.service_order_id = cso.id ) = 0,
                    '',
                    CONCAT(ROUND(
                        (select COUNT(DISTINCT od.id) from bu_sub_order so, bu_combine_order co, bu_order_dtl od, bu_customer_service_order cso, bu_intervention_order io where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date >= #{periodDateBegin } and co.pay_date <= #{periodDateEnd } and od.sub_order_id = so.id and cso.del_flag = '0' and cso.order_dtl_id = od.id and io.del_flag = '0' and io.service_order_id = cso.id )
                         /(select SUM(od.quantity) from bu_sub_order so, bu_combine_order co, bu_order_dtl od where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date >= #{periodDateBegin } and co.pay_date <= #{periodDateEnd } and od.sub_order_id = so.id )*100, 1), '%' )) intervention_order_rate, ]]> 近期介入率
        <![CDATA[ IF((select COUNT(1) from bu_comment c where c.del_flag = '0' and c.mcht_id = t.id and c.create_date >= #{periodDateBegin } and c.create_date <= #{periodDateEnd } and c.product_score in(4, 5) ) = 0,
                    '',
                    CONCAT(TRUNCATE(
                        (select COUNT(1) from bu_comment c where c.del_flag = '0' and c.mcht_id = t.id and c.product_score in(4, 5) )
                        /(select COUNT(1) from bu_comment c where c.del_flag = '0' and c.mcht_id = t.id )*100
                    , 2), '%' )) product_applause_rate, ]]> 好评率 -->
        FUN_GET_STATUS_DESC("BU_MCHT_INFO","GRADE", t.grade) grade_desc, <!-- 商家等级 -->
        FUN_GET_STATUS_DESC("BU_MCHT_INFO", "SHOP_STATUS", t.shop_status) shop_status_desc, <!-- 商城入口 -->
        FUN_GET_STATUS_DESC("BU_MCHT_INFO", "ACTIVITY_AUTH_STATUS", t.activity_auth_status)
        activity_auth_status_desc, <!-- 活动入口 -->
        FUN_GET_STATUS_DESC("BU_MCHT_OPTIMIZE", "DEGREE_ADAPTABILITY", (select mo.degree_adaptability from
        bu_mcht_optimize mo where mo.del_flag = '0' and mo.mcht_id = t.id)) degree_adaptability_desc, <!-- 配合度 -->
        (select c.contact_name from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id
        and b.mcht_id = t.id and c.contact_type = '1' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1) zs_contact_name, <!-- 1 招商对接人 -->
        (select c.contact_name from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id
        and b.mcht_id = t.id and c.contact_type = '2' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1) yy_contact_name, <!-- 2 运营对接人 -->
        (select c.contact_name from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id
        and b.mcht_id = t.id and c.contact_type = '3' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1) dd_contact_name, <!-- 3 订单对接人 -->
        (select c.contact_name from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id
        and b.mcht_id = t.id and c.contact_type = '4' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1) sh_contact_name, <!-- 4 售后对接人 -->
        (select c.contact_name from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id
        and b.mcht_id = t.id and c.contact_type = '5' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1) cw_contact_name, <!-- 5 财务对接人 -->
        (select c.contact_name from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id
        and b.mcht_id = t.id and c.contact_type = '6' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1) kf_contact_name, <!-- 6 客服对接人 -->
        (select c.contact_name from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id
        and b.mcht_id = t.id and c.contact_type = '7' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1) fw_contact_name, <!-- 7 法务对接人 -->
        (select c.contact_name from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id
        and b.mcht_id = t.id and c.contact_type = '8' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1) sj_contact_name, <!-- 8 商家服务专员 -->
        (select c.staff_id from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id and
        b.mcht_id = t.id and c.contact_type = '2' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1) yy_staff_id,
        (select c.staff_id from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id and
        b.mcht_id = t.id and c.contact_type = '1' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1) zs_staff_id,
        (select c.staff_id from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id and
        b.mcht_id = t.id and c.contact_type = '7' and b.del_flag='0' and c.del_flag='0' and b.status='1' and
        c.status='0' LIMIT 1) fw_staff_id,
        (select mo.deposit_remarks from bu_mcht_optimize mo where mo.del_flag = '0' and mo.mcht_id = t.id)
        mcht_optimize_deposit_remarks, <!-- 保证金优化 -->
        (select mo.gross_profit_rate_remarks from bu_mcht_optimize mo where mo.del_flag = '0' and mo.mcht_id = t.id)
        mcht_optimize_gross_profit_rate_remarks, <!-- 毛利率优化 -->
        (select mo.product_remarks from bu_mcht_optimize mo where mo.del_flag = '0' and mo.mcht_id = t.id)
        mcht_optimize_product_remarks, <!-- 商品优化 -->
        (select mo.service_remarks from bu_mcht_optimize mo where mo.del_flag = '0' and mo.mcht_id = t.id)
        mcht_optimize_service_remarks, <!-- 服务优化 -->
        (select mo.wuliu_remarks from bu_mcht_optimize mo where mo.del_flag = '0' and mo.mcht_id = t.id)
        mcht_optimize_wuliu_remarks, <!-- 物流配送 -->
        FUN_GET_STATUS_DESC("BU_MCHT_OPTIMIZE", "RESOURCE_GRADE", (select mo.resource_grade from bu_mcht_optimize mo
        where mo.del_flag = '0' and mo.mcht_id = t.id)) resource_grade_desc, <!-- 站内资源等级 -->
        (select mo.spread_remarks from bu_mcht_optimize mo where mo.del_flag = '0' and mo.mcht_id = t.id)
        mcht_optimize_spread_remarks, <!-- 是否站外推广 -->
        (select mo.operate_remarks from bu_mcht_optimize mo where mo.del_flag = '0' and mo.mcht_id = t.id)
        mcht_optimize_operate_remarks, <!-- 运营备注 -->
        (select GROUP_CONCAT(CONCAT(mc.contact_name,mc.mobile)) from bu_mcht_contact mc where mc.del_flag = '0' and
        mc.contact_type = '1' and mc.mcht_id = t.id ) contact_name_mobile, <!-- 店铺电商总负责人 -->
        (select si.STAFF_NAME from bu_mcht_product_type mpt, bu_product_type pt, sys_staff_info si where mpt.mcht_id =
        t.id and mpt.is_main = '1' and mpt.del_flag = '0' and mpt.product_type_id = pt.id and pt.del_flag = '0' and
        pt.principal_staff_id = si.STAFF_ID limit 1 ) principal_staff_name, <!-- 品类负责人 -->
        <if test="periodDate=='1'">
            (select ms.activity_count_7_days from bu_mcht_statistical_info ms where ms.mcht_id=t.id and ms.del_flag='0')
            activity_count_7_days,<!-- 7天特卖数 -->
            (select ROUND(ms.pay_amount_sum_7_days,2) from bu_mcht_statistical_info ms where ms.mcht_id=t.id and
            ms.del_flag='0') pay_amount_sum_7_days,<!-- 7天销售额 -->
            (select ms.sub_order_count_7_days from bu_mcht_statistical_info ms where ms.mcht_id=t.id and
            ms.del_flag='0') sub_order_count_7_days,<!-- 7天订单量 -->
            (select CONCAT(ROUND((ms.return_rate_7_days),1),'%') from bu_mcht_statistical_info ms where ms.mcht_id=t.id
            and ms.del_flag='0') return_rate_7_days,<!-- 7天退货率 -->
            (select CONCAT(ROUND((ms.appeal_rate_7_days),1),'%') from bu_mcht_statistical_info ms where ms.mcht_id=t.id
            and ms.del_flag='0') appeal_rate_7_days,<!-- 7天投诉率 -->
            (select CONCAT(ROUND((ms.intervention_rate_7_days),1),'%') from bu_mcht_statistical_info ms where
            ms.mcht_id=t.id and ms.del_flag='0') intervention_rate_7_days,<!-- 7天介入率-->
        </if>
        <if test="periodDate=='2'">
            (select ms.activity_count_30_days from bu_mcht_statistical_info ms where ms.mcht_id=t.id and
            ms.del_flag='0') activity_count_30_days,<!-- 30天特卖数 -->
            (select ROUND(ms.pay_amount_sum_30_days,2) from bu_mcht_statistical_info ms where ms.mcht_id=t.id and
            ms.del_flag='0') pay_amount_sum_30_days,<!-- 30天销售额 -->
            (select ms.sub_order_count_30_days from bu_mcht_statistical_info ms where ms.mcht_id=t.id and
            ms.del_flag='0') sub_order_count_30_days,<!-- 30天订单量-->
            (select CONCAT(ROUND((ms.return_rate_30_days),1),'%') from bu_mcht_statistical_info ms where ms.mcht_id=t.id
            and ms.del_flag='0') return_rate_30_days,<!-- 30天退货率-->
            (select CONCAT(ROUND((ms.appeal_rate_30_days),1),'%') from bu_mcht_statistical_info ms where ms.mcht_id=t.id
            and ms.del_flag='0') appeal_rate_30_days,<!-- 30天投诉率 -->
            (select CONCAT(ROUND((ms.intervention_rate_30_days),1),'%') from bu_mcht_statistical_info ms where
            ms.mcht_id=t.id and ms.del_flag='0') intervention_rate_30_days,<!-- 30天介入率-->
        </if>
        <if test="periodDate=='3'">
            (select ms.activity_count_90_days from bu_mcht_statistical_info ms where ms.mcht_id=t.id and
            ms.del_flag='0') activity_count_90_days,<!-- 90天特卖数 -->
            (select ROUND(ms.pay_amount_sum_90_days,2) from bu_mcht_statistical_info ms where ms.mcht_id=t.id and
            ms.del_flag='0') pay_amount_sum_90_days,<!-- 90天销售额 -->
            (select ms.sub_order_count_90_days from bu_mcht_statistical_info ms where ms.mcht_id=t.id and
            ms.del_flag='0') sub_order_count_90_days,<!-- 90天订单量 -->
            (select CONCAT(ROUND((ms.return_rate_90_days),1),'%') from bu_mcht_statistical_info ms where ms.mcht_id=t.id
            and ms.del_flag='0') return_rate_90_days,<!-- 90天退货率 -->
            (select CONCAT(ROUND((ms.appeal_rate_90_days),1),'%') from bu_mcht_statistical_info ms where ms.mcht_id=t.id
            and ms.del_flag='0') appeal_rate_90_days,<!-- 90天投诉率 -->
            (select CONCAT(ROUND((ms.intervention_rate_90_days),1),'%') from bu_mcht_statistical_info ms where
            ms.mcht_id=t.id and ms.del_flag='0') intervention_rate_90_days,<!-- 90天介入率-->
        </if>
        (select CONCAT(ROUND((ms.product_applause_rate),2),'%') from bu_mcht_statistical_info ms where ms.mcht_id=t.id
        and ms.del_flag='0') product_applause_rate,<!-- 商品好评率 -->
        (select ROUND(ms.product_score_avg,2) from bu_mcht_statistical_info ms where ms.mcht_id=t.id and
        ms.del_flag='0') product_score_avg <!-- 商品平均分 -->

        from bu_mcht_info t where t.del_flag = '0'
        <if test="mchtCode != null and mchtCode != ''">
            and t.mcht_code = #{mchtCode }
        </if>
        <if test="mchtType != null and mchtType != ''">
            and t.mcht_type = #{mchtType }
        </if>
        <if test="mchtName != null and mchtName != ''">
            and (t.short_name like concat('%',#{mchtName },'%')
            or t.company_name like concat('%',#{mchtName },'%')
            or t.shop_name like concat('%',#{mchtName },'%')
            )
        </if>
        <if test="resourceGrade != null and resourceGrade != ''">
            and t.id IN (select mo.mcht_id from bu_mcht_optimize mo where mo.del_flag = '0' and mo.resource_grade =
            #{resourceGrade })
        </if>
        <if test="endYear != null and endYear != ''">
            and DATE_FORMAT(t.agreement_end_date,'%Y') = #{endYear }
        </if>
        <if test="endMonth != null and endMonth != ''">
            and DATE_FORMAT(t.agreement_end_date,'%m') = #{endMonth }
        </if>
        <if test="productBrandName != null and productBrandName != ''">
            and t.id IN (select b.mcht_id from bu_mcht_product_brand b, bu_product_brand c where b.product_brand_id =
            c.id and b.del_flag='0' and c.name like concat('%',#{productBrandName },'%'))
        </if>
        <if test="grade != null and grade != ''">
            and t.grade = #{grade }
        </if>
        <if test="productTypeId != null and productTypeId != ''">    <!-- 主营类目 -->
            and EXISTS (select mpt.id from bu_mcht_product_type mpt where mpt.mcht_id = t.id and mpt.is_main = '1' and
            mpt.del_flag = '0' and mpt.product_type_id = #{productTypeId } )
        </if>
        <if test="platContactStaffId != null and platContactStaffId != ''">
            and t.id IN (select mpc.mcht_id from bu_platform_contact pc, bu_mcht_platform_contact mpc where pc.del_flag
            = '0' and pc.status = '0' and (pc.staff_id = #{platContactStaffId } or pc.assistant_id in(select bpc.id from
            bu_platform_contact bpc where bpc.del_flag = '0' and bpc.status = '0' and bpc.staff_id =
            #{platContactStaffId }) )
            and mpc.del_flag = '0' and mpc.status = '1' and mpc.platform_contact_id = pc.id )
        </if>
        <if test="auditRisk != null and auditRisk != ''">
            and t.id IN (select mo.mcht_id from bu_mcht_optimize mo where mo.del_flag = '0' and mo.audit_risk =
            #{auditRisk })
        </if>
        <if test="mchtStatus != null and mchtStatus != ''">
            and t.status = #{mchtStatus }
            <if test="mchtStatus == 3">
                and t.cooperate_begin_date is not null
            </if>
        </if>
        <if test="degreeAdaptability != null and degreeAdaptability != ''">
            and t.id IN (select mo.mcht_id from bu_mcht_optimize mo where mo.del_flag = '0' and mo.degree_adaptability =
            #{degreeAdaptability })
        </if>
        <if test="productTypeContactIsNull != null and productTypeContactIsNull != ''">
            and (
            t.id IN (select mpt.mcht_id from sys_staff_product_type spt, bu_mcht_product_type mpt where spt.del_flag =
            '0' and spt.staff_id = #{productTypeContactIsNull }
            and mpt.del_flag = '0' and mpt.is_main = '1' and mpt.product_type_id = spt.product_type_id )
            OR
            t.id IN (select mpc.mcht_id from bu_platform_contact pc, bu_mcht_platform_contact mpc where pc.del_flag =
            '0' and pc.status = '0' and (pc.staff_id = #{productTypeContactIsNull } or pc.assistant_id in(select bpc.id
            from bu_platform_contact bpc where bpc.del_flag = '0' and bpc.status = '0' and bpc.staff_id =
            #{productTypeContactIsNull }) )
            and mpc.del_flag = '0' and mpc.status = '1' and mpc.platform_contact_id = pc.id )
            )
        </if>
        <if test="cooperateBeginDateBegin != '' and cooperateBeginDateBegin != null">
            and t.cooperate_begin_date<![CDATA[ >= ]]>#{cooperateBeginDateBegin}
        </if>
        <if test="cooperateBeginDateEnd != '' and cooperateBeginDateEnd != null">
            and t.cooperate_begin_date<![CDATA[ <= ]]>#{cooperateBeginDateEnd}
        </if>
        <if test="closeDateBegin != '' and closeDateBegin != null">
            and t.status ='3' and t.status_date<![CDATA[ >= ]]>#{closeDateBegin}
        </if>
        <if test="closeDateEnd != '' and closeDateEnd != null">
            and t.status ='3' and t.status_date<![CDATA[ <= ]]>#{closeDateEnd}
        </if>
        <if test="settledType != '' and settledType != null">
            and t.settled_type =#{settledType}
        </if>
        <if test="orderByClause != null and orderByClause != ''">
            order by ${orderByClause }
        </if>
        <if test="MAX_NUM != null and MAX_NUM != ''">
            limit #{MIN_NUM},#{MAX_NUM}
        </if>
    </select>
    <select id="selectMchtInfoCustomCount" parameterType="java.util.Map" resultType="java.lang.Integer">
        select
        count(1)
        from bu_mcht_info t where t.del_flag = '0'
        <if test="mchtCode != null and mchtCode != ''">
            and t.mcht_code = #{mchtCode }
        </if>
        <if test="mchtType != null and mchtType != ''">
            and t.mcht_type = #{mchtType }
        </if>
        <if test="mchtName != null and mchtName != ''">
            and (t.short_name like concat('%',#{mchtName },'%')
            or t.company_name like concat('%',#{mchtName },'%')
            or t.shop_name like concat('%',#{mchtName },'%')
            )
        </if>
        <if test="resourceGrade != null and resourceGrade != ''">
            and t.id IN (select mo.mcht_id from bu_mcht_optimize mo where mo.del_flag = '0' and mo.resource_grade =
            #{resourceGrade })
        </if>
        <if test="endYear != null and endYear != ''">
            and DATE_FORMAT(t.agreement_end_date,'%Y') = #{endYear }
        </if>
        <if test="endMonth != null and endMonth != ''">
            and DATE_FORMAT(t.agreement_end_date,'%m') = #{endMonth }
        </if>
        <if test="productBrandName != null and productBrandName != ''">
            and t.id IN (select b.mcht_id from bu_mcht_product_brand b, bu_product_brand c where b.product_brand_id =
            c.id and b.del_flag='0' and c.name like concat('%',#{productBrandName },'%'))
        </if>
        <if test="grade != null and grade != ''">
            and t.grade = #{grade }
        </if>
        <if test="productTypeId != null and productTypeId != ''">    <!-- 主营类目 -->
            and EXISTS (select mpt.id from bu_mcht_product_type mpt where mpt.mcht_id = t.id and mpt.is_main = '1' and
            mpt.del_flag = '0' and mpt.product_type_id = #{productTypeId } )
        </if>
        <if test="platContactStaffId != null and platContactStaffId != ''">
            and t.id IN (select mpc.mcht_id from bu_platform_contact pc, bu_mcht_platform_contact mpc where pc.del_flag
            = '0' and pc.status = '0' and (pc.staff_id = #{platContactStaffId } or pc.assistant_id in(select bpc.id from
            bu_platform_contact bpc where bpc.del_flag = '0' and bpc.status = '0' and bpc.staff_id =
            #{platContactStaffId }) )
            and mpc.del_flag = '0' and mpc.status = '1' and mpc.platform_contact_id = pc.id )
        </if>
        <if test="auditRisk != null and auditRisk != ''">
            and t.id IN (select mo.mcht_id from bu_mcht_optimize mo where mo.del_flag = '0' and mo.audit_risk =
            #{auditRisk })
        </if>
        <if test="mchtStatus != null and mchtStatus != ''">
            and t.status = #{mchtStatus }
            <if test="mchtStatus == 3">
                and t.cooperate_begin_date is not null
            </if>
        </if>
        <if test="degreeAdaptability != null and degreeAdaptability != ''">
            and t.id IN (select mo.mcht_id from bu_mcht_optimize mo where mo.del_flag = '0' and mo.degree_adaptability =
            #{degreeAdaptability })
        </if>
        <if test="productTypeContactIsNull != null and productTypeContactIsNull != ''">
            and (
            t.id IN (select mpt.mcht_id from sys_staff_product_type spt, bu_mcht_product_type mpt where spt.del_flag =
            '0' and spt.staff_id = #{productTypeContactIsNull }
            and mpt.del_flag = '0' and mpt.is_main = '1' and mpt.product_type_id = spt.product_type_id )
            OR
            t.id IN (select mpc.mcht_id from bu_platform_contact pc, bu_mcht_platform_contact mpc where pc.del_flag =
            '0' and pc.status = '0' and (pc.staff_id = #{productTypeContactIsNull } or pc.assistant_id in(select bpc.id
            from bu_platform_contact bpc where bpc.del_flag = '0' and bpc.status = '0' and bpc.staff_id =
            #{productTypeContactIsNull }) )
            and mpc.del_flag = '0' and mpc.status = '1' and mpc.platform_contact_id = pc.id )
            )
        </if>
        <if test="cooperateBeginDateBegin != '' and cooperateBeginDateBegin != null">
            and t.cooperate_begin_date<![CDATA[ >= ]]>#{cooperateBeginDateBegin}
        </if>
        <if test="cooperateBeginDateEnd != '' and cooperateBeginDateEnd != null">
            and t.cooperate_begin_date<![CDATA[ <= ]]>#{cooperateBeginDateEnd}
        </if>
        <if test="closeDateBegin != '' and closeDateBegin != null">
            and t.status ='3' and t.status_date<![CDATA[ >= ]]>#{closeDateBegin}
        </if>
        <if test="closeDateEnd != '' and closeDateEnd != null">
            and t.status ='3' and t.status_date<![CDATA[ <= ]]>#{closeDateEnd}
        </if>
        <if test="settledType != '' and settledType != null">
            and t.settled_type =#{settledType}
        </if>
    </select>

    <!-- 该商家的100天以内订单，且有快递名称的，这些快递有哪些？调取数量多的前三个快递名称（多的在前面），快递名称之间由顿号隔开 -->
    <select id="selectExpressNames" parameterType="java.util.Map" resultType="java.lang.String">
   		SELECT
			GROUP_CONCAT(A.`name`)
		FROM
			(
				SELECT
					e.name
				FROM
					bu_sub_order so,
					bu_express e
				WHERE
					so.del_flag = '0'
				AND so.create_date >= DATE_SUB(NOW(), INTERVAL 100 DAY)
				AND so.express_id = e.id
				AND so.mcht_id = #{mchtId }
				AND e.del_flag = '0'
				GROUP BY
					e.id
				ORDER BY
					count(1) DESC
				LIMIT 3
			) A
   </select>

    <!-- 通过商家序号查找商家基本信息 -->
    <select id="selectByMchtCode" parameterType="java.lang.String" resultType="java.util.Map">
   		SELECT
   			a.id as mchtId,
			a.mcht_code as mchtCode,
			a.company_name as companyName,
			a.shop_name as shopName,
			a.STATUS,
			FUN_GET_STATUS_DESC("BU_MCHT_INFO","STATUS", a.STATUS) status_desc
		FROM
			bu_mcht_info a 
		WHERE
			a.mcht_code = #{0};
   </select>


    <!-- <select id="selectMchtInfoShopCustomList" parameterType="java.util.Map" resultType="java.util.Map" >
         select
             t.*,
              <![CDATA[ (select IFNULL(SUM(so.pay_amount), 0) from bu_sub_order so, bu_combine_order co where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date >= #{paydateDate1} and co.pay_date <= #{paydateDate1o}) pay_amount_sum1,]]>
             <![CDATA[ (select IFNULL(SUM(so.pay_amount), 0) from bu_sub_order so, bu_combine_order co where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date >= #{paydateDate2} and co.pay_date <= #{paydateDate2t}) pay_amount_sum2,]]>
             <![CDATA[ (select IFNULL(SUM(so.pay_amount), 0) from bu_sub_order so, bu_combine_order co where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date >= #{paydateDate3} and co.pay_date <= #{paydateDate3s}) pay_amount_sum3,]]>
             <![CDATA[ (select IFNULL(SUM(so.pay_amount), 0) from bu_sub_order so, bu_combine_order co where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date >= #{paydateDate4} and co.pay_date <= #{paydateDate4f}) pay_amount_sum4,]]>
             <![CDATA[ (select IFNULL(SUM(so.pay_amount), 0) from bu_sub_order so, bu_combine_order co where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date >= #{paydateDate5} and co.pay_date <= #{paydateDate5fi}) pay_amount_sum5,]]>
             <![CDATA[ (select IFNULL(SUM(so.pay_amount), 0) from bu_sub_order so, bu_combine_order co where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date >= #{paydateDate6} and co.pay_date <= #{paydateDate6sx}) pay_amount_sum6,]]>
             <![CDATA[ (select IFNULL(SUM(so.pay_amount), 0) from bu_sub_order so, bu_combine_order co where so.del_flag = '0' and so.mcht_id = t.id and so.combine_order_id = co.id and co.pay_date >= #{paydateDate7} and co.pay_date <= #{paydateDate7se}) pay_amount_sum7]]>
             from bu_mcht_info t where t.status='1'
             and t.del_flag = '0'
             <if test="mchtCode != null and mchtCode != ''">
                 and t.mcht_code = #{mchtCode}
             </if>
             <if test="mchtName != null and mchtName != ''">
                 and (t.company_name like concat('%',#{mchtName},'%')
                      or t.shop_name like concat('%',#{mchtName},'%')
                  )
             </if>
             <if test="productBrandName!='' and productBrandName!=null">
                 and t.id in (select b.mcht_id from bu_mcht_product_brand b, bu_product_brand c where b.product_brand_id=c.id and b.del_flag='0' and c.name=#{productBrandName})
             </if>
             <if test="productTypeId != null and productTypeId != ''">
                 and EXISTS (select mpt.id from bu_mcht_product_type mpt where mpt.mcht_id = t.id and mpt.is_main = '1' and mpt.del_flag = '0'  and mpt.product_type_id = #{productTypeId})
             </if>
             <if test="platContactStaffId != null and platContactStaffId != ''">
                 and t.id IN (select mpc.mcht_id from bu_platform_contact pc, bu_mcht_platform_contact mpc where pc.del_flag = '0' and pc.status = '0' and (pc.staff_id = #{platContactStaffId} or pc.assistant_id in(select bpc.id from bu_platform_contact bpc where bpc.del_flag = '0' and bpc.status = '0' and bpc.staff_id = #{platContactStaffId}))
                                 and mpc.del_flag = '0' and mpc.status = '1' and mpc.platform_contact_id = pc.id)
             </if>
             <if test="productTypeContactIsNull != null and productTypeContactIsNull != ''">
                 and (
                     t.id IN (select mpt.mcht_id from sys_staff_product_type spt, bu_mcht_product_type mpt where spt.del_flag = '0' and spt.staff_id = #{productTypeContactIsNull}
                                 and mpt.del_flag = '0' and mpt.is_main = '1' and mpt.product_type_id = spt.product_type_id)
                     OR
                     t.id IN (select mpc.mcht_id from bu_platform_contact pc, bu_mcht_platform_contact mpc where pc.del_flag = '0' and pc.status = '0' and (pc.staff_id = #{productTypeContactIsNull} or pc.assistant_id in(select bpc.id from bu_platform_contact bpc where bpc.del_flag = '0' and bpc.status = '0' and bpc.staff_id = #{productTypeContactIsNull}))
                                 and mpc.del_flag = '0' and mpc.status = '1' and mpc.platform_contact_id = pc.id)
                     )
             </if>
             <if test="orderByClause != null and orderByClause != ''" >
                   order by ${orderByClause}
             </if>
              <if test="MAX_NUM != null and MAX_NUM != ''">
                    limit #{MIN_NUM},#{MAX_NUM}
             </if>
     </select> -->


    <!-- <select id="selectMchtInfoShopCustomCount" parameterType="java.util.Map" resultType="java.lang.Integer" >
           select
             count(1)
             from bu_mcht_info t where t.status='1' and t.del_flag = '0'
             <if test="mchtCode != null and mchtCode != ''">
                 and t.mcht_code = #{mchtCode}
             </if>
             <if test="mchtName != null and mchtName != ''">
                 and (t.company_name like concat('%',#{mchtName},'%')
                      or t.shop_name like concat('%',#{mchtName},'%')
                 )
             </if>
             <if test="productBrandName != null and productBrandName != ''">
                  and t.id in (select b.mcht_id from bu_mcht_product_brand b, bu_product_brand c where b.product_brand_id=c.id and b.del_flag='0' and c.name=#{productBrandName})
             </if>
             <if test="productTypeId != null and productTypeId != ''">
                 and EXISTS (select mpt.id from bu_mcht_product_type mpt where mpt.mcht_id = t.id and mpt.is_main = '1' and mpt.del_flag = '0'  and mpt.product_type_id = #{productTypeId})
             </if>
             <if test="platContactStaffId != null and platContactStaffId != ''">
                 and t.id IN (select mpc.mcht_id from bu_platform_contact pc, bu_mcht_platform_contact mpc where pc.del_flag = '0' and pc.status = '0' and (pc.staff_id = #{platContactStaffId} or pc.assistant_id in(select bpc.id from bu_platform_contact bpc where bpc.del_flag = '0' and bpc.status = '0' and bpc.staff_id = #{platContactStaffId}))
                                 and mpc.del_flag = '0' and mpc.status = '1' and mpc.platform_contact_id = pc.id)
             </if>
             <if test="productTypeContactIsNull != null and productTypeContactIsNull != ''">
                 and (
                     t.id IN (select mpt.mcht_id from sys_staff_product_type spt, bu_mcht_product_type mpt where spt.del_flag = '0' and spt.staff_id = #{productTypeContactIsNull}
                                 and mpt.del_flag = '0' and mpt.is_main = '1' and mpt.product_type_id = spt.product_type_id)
                     OR
                     t.id IN (select mpc.mcht_id from bu_platform_contact pc, bu_mcht_platform_contact mpc where pc.del_flag = '0' and pc.status = '0' and (pc.staff_id = #{productTypeContactIsNull} or pc.assistant_id in(select bpc.id from bu_platform_contact bpc where bpc.del_flag = '0' and bpc.status = '0' and bpc.staff_id = #{productTypeContactIsNull}))
                                 and mpc.del_flag = '0' and mpc.status = '1' and mpc.platform_contact_id = pc.id)
                     )
             </if>
     </select> -->


    <select id="totalmchtInfoMonthlyCustom" parameterType="java.util.HashMap" resultMap="BaseResultCustomMap">
SELECT t.each_month,SUM(mcht_Count) mcht_Count,SUM(settledun_Submitted) settledun_Submitted,SUM(settle_Daudited) settle_Daudited,SUM(settle_Dadopt) settle_Dadopt,SUM(shop_Open) shop_Open,SUM(contract_File) contract_File,SUM(mchtclose_Application) mchtclose_Application,SUM(mchtclose_Count) mchtclose_Count FROM (
SELECT DATE_FORMAT(t.create_date,'%Y-%m') AS each_month,COUNT(*) as mcht_Count, 0 AS settledun_Submitted,0 AS settle_Daudited,0 AS settle_Dadopt ,0 AS shop_Open,0 AS contract_File,0 AS mchtclose_Application,0 AS mchtclose_Count FROM bu_mcht_info t WHERE t.del_flag='0' AND DATE_FORMAT(t.create_date, '%Y-%m') <![CDATA[ >= ]]> #{DateBegin} AND DATE_FORMAT(t.create_date, '%Y-%m') <![CDATA[ <= ]]> #{DateEnd} GROUP BY DATE_FORMAT(t.create_date,'%Y-%m')
UNION ALL
SELECT DATE_FORMAT(t.create_date,'%Y-%m') AS each_month,0 AS mcht_Count, COUNT(*) AS settledun_Submitted,0 AS settle_Daudited,0 AS settle_Dadopt ,0 AS shop_Open,0 AS contract_File,0 AS mchtclose_Application,0 AS mchtclose_Count FROM bu_mcht_info t WHERE t.del_flag='0' AND t.zs_total_audit_status='4' AND t.status='0' AND DATE_FORMAT(t.create_date, '%Y-%m') <![CDATA[ >= ]]> #{DateBegin} AND DATE_FORMAT(t.create_date, '%Y-%m') <![CDATA[ <= ]]> #{DateEnd} GROUP BY DATE_FORMAT(t.create_date,'%Y-%m')
UNION ALL
SELECT DATE_FORMAT(t.create_date,'%Y-%m') AS each_month,0 AS mcht_Count, 0 AS settledun_Submitted,COUNT(*) AS settle_Daudited,0 AS settle_Dadopt ,0 AS shop_Open,0 AS contract_File,0 AS mchtclose_Application,0 AS mchtclose_Count FROM bu_mcht_info t WHERE t.del_flag='0' AND t.zs_total_audit_status in (0,2) AND t.total_audit_status in (0,4) AND t.status='0' AND DATE_FORMAT(t.create_date, '%Y-%m') <![CDATA[ >= ]]> #{DateBegin} AND DATE_FORMAT(t.create_date, '%Y-%m') <![CDATA[ <= ]]> #{DateEnd} GROUP BY DATE_FORMAT(t.create_date,'%Y-%m')
UNION ALL
SELECT DATE_FORMAT(t.create_date,'%Y-%m') AS each_month,0 AS mcht_Count, 0 AS settledun_Submitted,0 AS settle_Daudited,COUNT(*) AS settle_Dadopt ,0 AS shop_Open,0 AS contract_File,0 AS mchtclose_Application,0 AS mchtclose_Count FROM bu_mcht_info t WHERE t.del_flag='0' AND t.total_audit_status='2' AND T.zs_total_audit_status='2' AND DATE_FORMAT(t.create_date, '%Y-%m') <![CDATA[ >= ]]> #{DateBegin} AND DATE_FORMAT(t.create_date, '%Y-%m') <![CDATA[ <= ]]> #{DateEnd} GROUP BY DATE_FORMAT(t.create_date,'%Y-%m')
UNION ALL
SELECT DATE_FORMAT(t.create_date,'%Y-%m') AS each_month,0 AS mcht_Count, 0 AS settledun_Submitted,0 AS settle_Daudited,0 AS settle_Dadopt ,COUNT(*) AS shop_Open,0 AS contract_File,0 AS mchtclose_Application,0 AS mchtclose_Count FROM bu_mcht_info t WHERE t.del_flag='0' AND t.zs_total_audit_status='2' AND t.status='1' AND t.total_audit_status='2' AND DATE_FORMAT(t.create_date, '%Y-%m') <![CDATA[ >= ]]> #{DateBegin} AND DATE_FORMAT(t.create_date, '%Y-%m') <![CDATA[ <= ]]> #{DateEnd} GROUP BY DATE_FORMAT(t.create_date,'%Y-%m')
UNION ALL
SELECT DATE_FORMAT(t.create_date,'%Y-%m') AS each_month,0 AS mcht_Count, 0 AS settledun_Submitted,0 AS settle_Daudited,0 AS settle_Dadopt ,0 AS shop_Open, COUNT(*) AS contract_File,0 AS mchtclose_Application,0 AS mchtclose_Count FROM bu_mcht_contract t WHERE t.del_flag='0' AND t.archive_status='1' AND DATE_FORMAT(t.create_date, '%Y-%m') <![CDATA[ >= ]]> #{DateBegin} AND DATE_FORMAT(t.create_date, '%Y-%m') <![CDATA[ <= ]]> #{DateEnd} GROUP BY DATE_FORMAT(t.create_date,'%Y-%m')
UNION ALL
SELECT DATE_FORMAT(m.create_date,'%Y-%m') AS each_month,0 AS mcht_Count, 0 AS settledun_Submitted,0 AS settle_Daudited,0 AS settle_Dadopt ,0 AS shop_Open, 0 AS contract_File,COUNT(*) AS mchtclose_Application,0 AS mchtclose_Count FROM bu_mcht_close_application t,bu_mcht_info m WHERE t.mcht_id=m.id AND t.del_flag='0' AND DATE_FORMAT(m.create_date, '%Y-%m') <![CDATA[ >= ]]> #{DateBegin} AND DATE_FORMAT(m.create_date, '%Y-%m') <![CDATA[ <= ]]> #{DateEnd} GROUP BY DATE_FORMAT(m.create_date,'%Y-%m')
UNION ALL
SELECT DATE_FORMAT(t.create_date,'%Y-%m') AS each_month,0 AS mcht_Count, 0 AS settledun_Submitted,0 AS settle_Daudited,0 AS settle_Dadopt ,0 AS shop_Open, 0 AS contract_File, 0 AS mchtclose_Application,COUNT(*) AS mchtclose_Count FROM bu_mcht_info t WHERE t.del_flag='0' AND t.status='3' AND t.cooperate_begin_date<![CDATA[ != ]]>'' AND DATE_FORMAT(t.create_date, '%Y-%m') <![CDATA[ >= ]]> #{DateBegin} AND DATE_FORMAT(t.create_date, '%Y-%m') <![CDATA[ <= ]]> #{DateEnd} GROUP BY DATE_FORMAT(t.create_date,'%Y-%m')
)T GROUP BY t.each_month 
  </select>


    <select id="mchtinfoMonthlyCoum" parameterType="java.util.HashMap" resultMap="BaseResultCustomMap">
SELECT t.each_month,SUM(settled_Count) settled_Count,SUM(mcht_Count) mcht_Count,SUM(popcommitaudit_Count) popcommitaudit_Count,SUM(popqualificationthrough_Count) popqualificationthrough_Count,SUM(popcooperatebegin_Count) popcooperatebegin_Count,SUM(popmchtclose_AppliCation)popmchtclose_AppliCation,SUM(popmchtclose_Count)popmchtclose_Count from (
SELECT DATE_FORMAT(T.create_date,'%Y-%m') AS each_month,count(*) AS settled_Count, 0 AS mcht_Count,0 AS popcommitaudit_Count,0 AS popqualificationthrough_Count ,0 AS popcooperatebegin_Count,0 AS popmchtclose_AppliCation,0 AS popmchtclose_Count from bu_mcht_settled_apply T WHERE T.del_flag='0' AND DATE_FORMAT(T.create_date, '%Y-%m') <![CDATA[ >= ]]> #{DateBegin} AND DATE_FORMAT(T.create_date, '%Y-%m') <![CDATA[ <= ]]> #{DateEnd} GROUP BY DATE_FORMAT(T.create_date,'%Y-%m')
UNION ALL
SELECT DATE_FORMAT(T.create_date,'%Y-%m') AS each_month,0 AS settled_Count, count(*) AS mcht_Count,0 AS popcommitaudit_Count,0 AS popqualificationthrough_Count ,0 AS popcooperatebegin_Count,0 AS popmchtclose_AppliCation,0 AS popmchtclose_Count from bu_mcht_info T WHERE T.del_flag='0' AND DATE_FORMAT(T.create_date, '%Y-%m') <![CDATA[ >= ]]> #{DateBegin} AND DATE_FORMAT(T.create_date, '%Y-%m') <![CDATA[ <= ]]> #{DateEnd} GROUP BY DATE_FORMAT(T.create_date,'%Y-%m')
UNION ALL
SELECT DATE_FORMAT(T.commit_audit_date,'%Y-%m') AS each_month,0 AS settled_Count, 0 AS mcht_Count,count(*) AS popcommitaudit_Count,0 AS popqualificationthrough_Count ,0 AS popcooperatebegin_Count,0 AS popmchtclose_AppliCation,0 AS popmchtclose_Count from bu_mcht_info T WHERE T.del_flag='0'  AND T.mcht_type='2' AND T.zs_total_audit_status='0' AND DATE_FORMAT(T.commit_audit_date, '%Y-%m') <![CDATA[ >= ]]> #{DateBegin} AND DATE_FORMAT(T.commit_audit_date, '%Y-%m') <![CDATA[ <= ]]> #{DateEnd} GROUP BY DATE_FORMAT(T.commit_audit_date,'%Y-%m')
UNION ALL
SELECT DATE_FORMAT(T.total_audit_date,'%Y-%m') AS each_month,0 AS settled_Count, 0 AS mcht_Count,0 AS popcommitaudit_Count,count(*) AS popqualificationthrough_Count ,0 AS popcooperatebegin_Count,0 AS popmchtclose_AppliCation,0 AS popmchtclose_Count from bu_mcht_info T WHERE T.del_flag='0' AND T.mcht_type='2' AND DATE_FORMAT(T.total_audit_date, '%Y-%m') <![CDATA[ >= ]]> #{DateBegin} AND DATE_FORMAT(T.total_audit_date, '%Y-%m') <![CDATA[ <= ]]> #{DateEnd} AND T.total_audit_status='2' GROUP BY DATE_FORMAT(T.total_audit_date,'%Y-%m')
UNION ALL
SELECT DATE_FORMAT(T.cooperate_begin_date,'%Y-%m') AS each_month,0 AS settled_Count, 0 AS mcht_Count,0 AS popcommitaudit_Count,0 AS popqualificationthrough_Count ,count(*) AS popcooperatebegin_Count,0 AS popmchtclose_AppliCation,0 AS popmchtclose_Count from bu_mcht_info T WHERE T.del_flag='0' AND T.status='1' AND T.mcht_type='2' AND DATE_FORMAT(T.cooperate_begin_date, '%Y-%m') <![CDATA[ >= ]]> #{DateBegin} AND DATE_FORMAT(T.cooperate_begin_date, '%Y-%m') <![CDATA[ <= ]]> #{DateEnd} GROUP BY DATE_FORMAT(T.cooperate_begin_date,'%Y-%m')
UNION ALL
SELECT DATE_FORMAT(T.create_date,'%Y-%m') AS each_month,0 AS settled_Count, 0 AS mcht_Count,0 AS popcommitaudit_Count,0 AS popqualificationthrough_Count ,0 AS popcooperatebegin_Count,count(*) AS popmchtclose_AppliCation,0 AS popmchtclose_Count from bu_mcht_close_application T,bu_mcht_info m WHERE T.del_flag='0' AND T.mcht_id=m.id AND m.mcht_type='2' AND DATE_FORMAT(T.create_date, '%Y-%m') <![CDATA[ >= ]]> #{DateBegin} AND DATE_FORMAT(T.create_date, '%Y-%m') <![CDATA[ <= ]]> #{DateEnd} GROUP BY DATE_FORMAT(T.create_date,'%Y-%m')
UNION ALL
SELECT DATE_FORMAT(T.status_date,'%Y-%m') AS each_month,0 AS settled_Count, 0 AS mcht_Count,0 AS popcommitaudit_Count,0 AS popqualificationthrough_Count ,0 AS popcooperatebegin_Count,0 AS popmchtclose_AppliCation,count(*) AS popmchtclose_Count from bu_mcht_info T WHERE T.del_flag='0' AND T.status='3' AND T.cooperate_begin_date<![CDATA[ != ]]>'' AND T.mcht_type='2' AND DATE_FORMAT(T.status_date, '%Y-%m') <![CDATA[ >= ]]> #{DateBegin} AND DATE_FORMAT(T.status_date, '%Y-%m') <![CDATA[ <= ]]> #{DateEnd} GROUP BY DATE_FORMAT(T.status_date,'%Y-%m')
)T GROUP BY t.each_month 	    
</select>


    <select id="selectMchtInfoShopCustomList" parameterType="java.util.Map" resultType="java.util.Map">
        SELECT
        tmp.mcht_id mcht_id,
        (SELECT mi.mcht_code FROM bu_mcht_info mi WHERE mi.del_flag = '0' AND mi.id = tmp.mcht_id) mcht_code,
        (SELECT mi.shop_name FROM bu_mcht_info mi WHERE mi.del_flag = '0' AND mi.id = tmp.mcht_id) shop_name,
        tmp.pay_amount payAmountSum,
        <![CDATA[ (select IFNULL(SUM(so.pay_amount), 0) from bu_sub_order so, bu_combine_order co where so.del_flag = '0' and tmp.mcht_id=so.mcht_id and so.combine_order_id = co.id and co.pay_date >= #{paydateDate1} and co.pay_date <= #{paydateDate1o})  pay_amount_sum1,]]>
        <![CDATA[ (select IFNULL(SUM(so.pay_amount), 0) from bu_sub_order so, bu_combine_order co where so.del_flag = '0' and tmp.mcht_id=so.mcht_id and so.combine_order_id = co.id and co.pay_date >= #{paydateDate2} and co.pay_date <= #{paydateDate2t})  pay_amount_sum2,]]>
        <![CDATA[ (select IFNULL(SUM(so.pay_amount), 0) from bu_sub_order so, bu_combine_order co where so.del_flag = '0' and tmp.mcht_id=so.mcht_id and so.combine_order_id = co.id and co.pay_date >= #{paydateDate3} and co.pay_date <= #{paydateDate3s})  pay_amount_sum3,]]>
        <![CDATA[ (select IFNULL(SUM(so.pay_amount), 0) from bu_sub_order so, bu_combine_order co where so.del_flag = '0' and tmp.mcht_id=so.mcht_id and so.combine_order_id = co.id and co.pay_date >= #{paydateDate4} and co.pay_date <= #{paydateDate4f})  pay_amount_sum4,]]>
        <![CDATA[ (select IFNULL(SUM(so.pay_amount), 0) from bu_sub_order so, bu_combine_order co where so.del_flag = '0' and tmp.mcht_id=so.mcht_id and so.combine_order_id = co.id and co.pay_date >= #{paydateDate5} and co.pay_date <= #{paydateDate5fi}) pay_amount_sum5,]]>
        <![CDATA[ (select IFNULL(SUM(so.pay_amount), 0) from bu_sub_order so, bu_combine_order co where so.del_flag = '0' and tmp.mcht_id=so.mcht_id and so.combine_order_id = co.id and co.pay_date >= #{paydateDate6} and co.pay_date <= #{paydateDate6sx}) pay_amount_sum6,]]>
        <![CDATA[ (select IFNULL(SUM(so.pay_amount), 0) from bu_sub_order so, bu_combine_order co where so.del_flag = '0' and tmp.mcht_id=so.mcht_id and so.combine_order_id = co.id and co.pay_date >= #{paydateDate7} and co.pay_date <= #{paydateDate7se}) pay_amount_sum7]]>
        FROM
        (
        SELECT
        bso.mcht_id mcht_id,
        SUM(bso.pay_amount) pay_amount
        FROM
        bu_sub_order bso,
        bu_combine_order bco,
        bu_mcht_info mi
        WHERE
        bso.combine_order_id = bco.id
        AND bso.del_flag = '0'
        AND bco.del_flag = '0'
        AND bco.pay_date <![CDATA[ >= ]]> #{startPaydatedate}
        AND bco.pay_date <![CDATA[ <= ]]> #{endPaydatedate}
        AND bso.mcht_id=mi.id
        AND mi.del_flag='0'
        <if test="listSpecMchtCode!='' and listSpecMchtCode!=null">
            AND mi.mcht_code NOT in
            <foreach collection="listSpecMchtCode" index="index" item="listSpecMchtCode" open="(" separator=","
                     close=")">
                #{listSpecMchtCode}
            </foreach>
        </if>
        <!-- AND mi.mcht_code NOT in ('P193103', 'P193093', 'P193076') -->
        GROUP BY
        bso.mcht_id
        ) tmp
        WHERE
        EXISTS (
        SELECT
        mi.id
        FROM
        bu_mcht_info mi
        WHERE
        mi.id = tmp.mcht_id
        AND mi.del_flag = '0'
        <if test="mchtCode != null and mchtCode !=''">
            AND mi.mcht_code = #{mchtCode}
        </if>
        <if test="mchtName != null and mchtName !=''">
            AND (mi.company_name LIKE CONCAT('%',#{mchtName},'%') OR mi.shop_name LIKE CONCAT('%',#{mchtName},'%'))
        </if>

        <if test="productTypeId !=null and productTypeId != ''">
            AND tmp.mcht_id in (select mpt.mcht_id from bu_mcht_product_type mpt where mpt.del_flag = '0' and
            tmp.mcht_id=mpt.mcht_id and mpt.status = '1' and mpt.product_type_id=#{productTypeId})
        </if>
        <if test="productBrandName !=null and productBrandName != ''">
            AND tmp.mcht_id in (select mp.mcht_id from bu_product_brand pb,bu_mcht_product_brand mp where
            mp.product_brand_id=pb.id and mp.mcht_id = tmp.mcht_id and mp.audit_status = '3' and pb.del_flag='0' and
            mp.del_flag='0' and (pb.name LIKE concat('%',#{productBrandName},'%') OR pb.name_zh LIKE
            concat('%',#{productBrandName},'%') OR pb.name_en LIKE concat('%',#{productBrandName},'%')))
        </if>
        <if test="platContactStaffId != null and platContactStaffId != ''">
            AND tmp.mcht_id IN (select mpc.mcht_id from bu_platform_contact pc, bu_mcht_platform_contact mpc where
            pc.del_flag = '0' and pc.status = '0' and (pc.staff_id = #{platContactStaffId} or pc.assistant_id in(select
            bpc.id from bu_platform_contact bpc where bpc.del_flag = '0' and bpc.status = '0' and bpc.staff_id =
            #{platContactStaffId}))
            and mpc.del_flag = '0' and mpc.status = '1' and mpc.platform_contact_id = pc.id)
        </if>
        <if test="productTypeContactIsNull != null and productTypeContactIsNull != ''">
            AND (
            tmp.mcht_id IN (select mpt.mcht_id from sys_staff_product_type spt, bu_mcht_product_type mpt where
            spt.del_flag = '0' and spt.staff_id = #{productTypeContactIsNull}
            and mpt.del_flag = '0' and mpt.is_main = '1' and mpt.product_type_id = spt.product_type_id)
            OR
            tmp.mcht_id IN (select mpc.mcht_id from bu_platform_contact pc, bu_mcht_platform_contact mpc where
            pc.del_flag = '0' and pc.status = '0' and (pc.staff_id = #{productTypeContactIsNull} or pc.assistant_id
            in(select bpc.id from bu_platform_contact bpc where bpc.del_flag = '0' and bpc.status = '0' and bpc.staff_id
            = #{productTypeContactIsNull}))
            and mpc.del_flag = '0' and mpc.status = '1' and mpc.platform_contact_id = pc.id)
            )
        </if>
        )
        ORDER BY
        tmp.pay_amount DESC
        <if test="MAX_NUM != null and MAX_NUM != ''">
            limit #{MIN_NUM},#{MAX_NUM}
        </if>
    </select>


    <!-- <select id="shopCustoms" parameterType="java.util.HashMap" resultType="java.util.HashMap">
    SELECT
       t.mcht_id,
       DATE_FORMAT(a.pay_date, '%Y-%m-%d') AS pay_date,
       ifnull(sum(t.pay_amount), 0) AS payAmount,
       m.mcht_code AS mchtCode,
       m.shop_name AS shopName
   FROM
       bu_sub_order t,
       bu_combine_order a,
       bu_mcht_info m
   WHERE
       t.combine_order_id = a.id
   AND t.mcht_id=m.id
   AND a.`status` = '1'
   <if test="mchtCode != null and mchtCode != ''" >
    and m.mcht_code= #{mchtCode}
   </if>
   <if test="mchtName != null and mchtName != ''" >
    and m.short_name like concat('%',#{mchtName},'%')
   </if>
   <if test="productTypeId !=null and productTypeId !=''">
   and EXISTS (select mpt.id from bu_mcht_product_type mpt where mpt.mcht_id = t.mcht_id and mpt.is_main = '1' and mpt.del_flag = '0'  and mpt.product_type_id = #{productTypeId})
   </if>
   <if test="platContactStaffId != '' and platContactStaffId != null">
       and t.mcht_id IN(select mpc.mcht_id from bu_platform_contact pc, bu_mcht_platform_contact mpc where pc.del_flag = '0' and pc.status = '0' and (pc.staff_id = #{platContactStaffId} or pc.assistant_id in(select bpc.id from bu_platform_contact bpc where bpc.del_flag = '0' and bpc.status = '0' and bpc.staff_id = #{platContactStaffId}))
       and mpc.del_flag = '0' and mpc.status = '1' and mpc.platform_contact_id = pc.id )
   </if>
   <if test="productBrandName!='' and productBrandName!=null">
   and t.mcht_id in (select b.mcht_id from bu_mcht_product_brand b, bu_product_brand c where b.product_brand_id=c.id and b.del_flag='0' and c.name=#{productBrandName})
   </if>
   <if test="productTypeContactIsNull != '' and productTypeContactIsNull != null">
   and (
       t.mcht_id IN(select mpt.mcht_id from sys_staff_product_type spt, bu_mcht_product_type mpt where spt.del_flag = '0' and spt.staff_id = #{productTypeContactIsNull}
       and mpt.del_flag = '0' and mpt.is_main = '1' and mpt.product_type_id = spt.product_type_id )
       OR
       t.mcht_id IN(select mpc.mcht_id from bu_platform_contact pc, bu_mcht_platform_contact mpc where pc.del_flag = '0' and pc.status = '0' and (pc.staff_id = #{productTypeContactIsNull } or pc.assistant_id in(select bpc.id from bu_platform_contact bpc where bpc.del_flag = '0' and bpc.status = '0' and bpc.staff_id = #{productTypeContactIsNull}))
       and mpc.del_flag = '0' and mpc.status = '1' and mpc.platform_contact_id = pc.id )
       )
   </if>
   AND a.pay_date <![CDATA[ >= ]]> #{startPaydateDate}
   AND a.pay_date  <![CDATA[ <= ]]> #{endPaydateDate}
   GROUP BY
       t.mcht_id,
       DATE_FORMAT(a.pay_date, '%Y-%m-%d')
   order by t.mcht_id,DATE_FORMAT(a.pay_date, '%Y-%m-%d');
     </select> -->

    <select id="shopActivityInfo" parameterType="java.lang.Integer" resultType="java.util.HashMap">
  	SELECT
		a.id,
		a.specially_approved_status,
		a.specially_approved_remarks,
		a.activity_auth_status,
		p1.NAME AS product_type_name,
		p1.enterprise_activities_DSR,
		p1.enterprise_turnover,
		p1.enterprise_activity_sales,
		((p3.avg_product_score + p4.avg_serve_score)/2) AS mcht_DSR,
		p2.allPayAmount,
		p2.allQuantity
	FROM
		bu_mcht_info a
		LEFT JOIN (
		SELECT
			t.mcht_id,
			t.product_type_id,
			t1.NAME,
			t1.enterprise_activities_DSR,
			t1.enterprise_turnover,
			t1.enterprise_activity_sales 
		FROM
			bu_mcht_product_type t
			INNER JOIN bu_product_type t1 ON t1.id = t.product_type_id 
		WHERE
			t.del_flag = '0' 
			AND t1.del_flag = '0' 
			AND t.is_main = '1' 
			AND t.STATUS = '1' 
			AND t1.STATUS = '1' 
		) p1 ON p1.mcht_id = a.id
		LEFT JOIN (
		SELECT
			t2.mcht_id,
			SUM( t.pay_amount ) AS allPayAmount,
			SUM( t.quantity ) AS allQuantity 
		FROM
			bu_order_dtl t
			INNER JOIN (
			SELECT
				p.id,
				p.mcht_id 
			FROM
				bu_sub_order p
				LEFT JOIN bu_combine_order p1 ON p1.id = p.combine_order_id 
			WHERE
				p1.STATUS = "1" 
				AND p1.pay_status = "1" 
				AND p.mcht_id = 1 
			) AS t2 ON t2.id = t.sub_order_id 
		WHERE
			t.product_status = "1" 
		GROUP BY
			t2.mcht_id 
		) p2 ON p2.mcht_id = a.id
		LEFT JOIN (
		SELECT
			t.mcht_id,
			AVG( t.product_score ) AS avg_product_score 
		FROM
			bu_comment t 
		WHERE
			t.del_flag = '0' 
			AND t.is_append_comment = '0' 
			GROUP BY t.mcht_id
		) p3 ON p3.mcht_id = a.id
		LEFT JOIN (
		SELECT
			t.mcht_id,
			(( AVG( t.wuliu_score ) + AVG( t.mcht_score ) ) / 2) AS avg_serve_score 
		FROM
			bu_shop_score t
		WHERE
			t.del_flag = '0' 
			GROUP BY t.mcht_id
		) p4 ON p4.mcht_id = a.id
		WHERE a.id=#{mchtId}
  </select>

    <resultMap id="PopResultCustomMap" type="com.jf.entity.MchtInfoCustom"
               extends="com.jf.dao.MchtInfoMapper.BaseResultMap">
        <result column="open_product_type" property="openProductType" jdbcType="VARCHAR"/>
        <result column="open_product_brand" property="openProductBrand" jdbcType="VARCHAR"/>
        <result column="pop_id" property="popId" jdbcType="INTEGER"/>
        <result column="settle_type" property="settleType" jdbcType="VARCHAR"/>
        <result column="type_desc" property="typeDesc" jdbcType="VARCHAR"/>
        <result column="unpaid_count" property="unpaidCount" jdbcType="INTEGER"/>
        <result column="unpaid_amount" property="unpaidAmount" jdbcType="DECIMAL"/>
        <result column="periods" property="periods" jdbcType="INTEGER"/>
        <result column="exceed_periods" property="exceedPeriods" jdbcType="INTEGER"/>
        <result column="exceed_amount" property="exceedAmount" jdbcType="DECIMAL"/>
        <result column="settle_order_ids" property="settleOrderIds" jdbcType="VARCHAR"/>
    </resultMap>

    <sql id="Base_Column_List1">
  <![CDATA[












                                                                                                    a.id,a.mcht_code,a.shop_name,a.company_name,a.cooperate_begin_date,z.id as pop_id,z.periods,
                                                                                                    (SELECT GROUP_CONCAT(b.`name` SEPARATOR '，') FROM bu_mcht_product_type c,bu_product_type b WHERE c.mcht_id = a.id AND c.del_flag = '0' AND c.`status` = '1' AND c.product_type_id = b.id AND b.`status` = '1' ORDER BY b.t_level,b.seq_no) open_product_type,
                                                                                                    (SELECT GROUP_CONCAT(CONCAT(b.`name`,'（',CAST((IFNULL(c.pop_commission_rate, 0) * 100) AS DECIMAL (9, 2)),'%）') SEPARATOR '，') FROM bu_mcht_product_brand c,bu_product_brand b WHERE c.mcht_id = a.id AND c.del_flag = '0' AND c.`status` = '1' AND c.product_brand_id = b.id AND b.`status` = '1' ORDER BY b.id) open_product_brand,
                                                                                                    FUN_GET_STATUS_DESC ("BU_POP_SETTLE_PLAN","TYPE",z.type) type_desc,
                                                                                                    (SELECT COUNT(b.id) FROM bu_mcht_settle_order b WHERE b.mcht_id = a.id AND b.pay_status = '1' AND (b.settle_amount - b.deposit_amount) > 0 AND b.del_flag = '0') unpaid_count,
                                                                                                    (SELECT SUM(b.settle_amount - b.deposit_amount) FROM bu_mcht_settle_order b WHERE b.mcht_id = a.id AND b.pay_status = '1' AND (b.settle_amount - b.deposit_amount) > 0 AND b.del_flag = '0') unpaid_amount,
                                                                                                    (SELECT GROUP_CONCAT(b.id) from bu_mcht_settle_order b where b.mcht_id = a.id AND b.pay_status = '1' AND (b.settle_amount - b.deposit_amount) > 0 AND b.del_flag = '0') settle_order_ids












        ]]>
  </sql>

    <select id="selectByCustomExample" resultMap="PopResultCustomMap"
            parameterType="com.jf.entity.MchtInfoCustomExample">
        select
        <include refid="Base_Column_List1"/>
        from bu_mcht_info a left join bu_pop_settle_plan z
        on
        a.id = z.mcht_id and z.del_flag = '0'
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
        <if test="orderByClause != null">
            order by ${orderByClause}
        </if>
        <if test="limitStart != null and limitStart>=0">
            limit #{limitStart} , #{limitSize}
        </if>
    </select>

    <select id="countByCustomExample" parameterType="com.jf.entity.MchtInfoCustomExample"
            resultType="java.lang.Integer">
        select count(*) from bu_mcht_info a left join bu_pop_settle_plan z on a.id = z.mcht_id and z.del_flag = '0'
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
    </select>

    <sql id="ZS_Renewal_Detail_List">
	a.*,
(SELECT sum(b.quantity) FROM bu_order_dtl b,bu_sub_order c,bu_combine_order d where b.sub_order_id = c. id and c.combine_order_id = d.id and d.status = '1' and c.mcht_id = a.id and b.del_flag = '0' and c.del_flag = '0' and d.del_flag = '0') salesVolume,
(SELECT SUM(b.pay_amount) FROM bu_order_dtl b,bu_sub_order c,bu_combine_order d where b.sub_order_id = c. id and c.combine_order_id = d.id and c.mcht_id = a.id and d.status = '1' and b.del_flag = '0' and c.del_flag = '0' and d.del_flag = '0') mchtGMV,
(SELECT sum(b.quantity) FROM bu_order_dtl b,bu_sub_order c where b.sub_order_id = c. id and c.mcht_id = a.id and b.product_status = '3' and b.del_flag = '0' and c.del_flag = '0') returnGoods,
(SELECT COUNT(c.id) FROM(SELECT b.id,b.mcht_id FROM bu_intervention_order b WHERE b.del_flag = '0' GROUP BY b.service_order_id ) c where c.mcht_id = a.id) interventionOrder,
(SELECT COUNT(b.id) FROM bu_customer_service_order b,bu_order_dtl c,bu_sub_order d where d.mcht_id = a.id and c.sub_order_id = d.id and b.sub_order_id = d.id and b.order_dtl_id = c.id and b.del_flag = '0' and c.del_flag = '0' and d.del_flag = '0') customerServiceOrder,
(SELECT COUNT(b.id) FROM bu_appeal_order b where b.mcht_id = a.id and b.del_flag = '0') appealOrder,
(SELECT SUM(b.quantity) FROM bu_order_dtl b,bu_sub_order c,bu_combine_order d where c.combine_order_id = d.id and b.sub_order_id = c. id and c.mcht_id = a.id and b.product_status = '1' and c.status = '3' and b.del_flag = '0' and c.del_flag = '0' and d.del_flag = '0') completeGoods,
FUN_GET_STATUS_DESC("BU_MCHT_INFO","DEPOSIT_TYPE", a.deposit_type) depositTypeDesc,
FUN_GET_STATUS_DESC("BU_MCHT_INFO","COMPANY_INFO_ARCHIVE_STATUS", a.company_info_archive_status) companyInfoArchiveStatusDesc,
(SELECT b.company_info_archive_status from bu_mcht_info_chg b where b.mcht_id = a.id and b.del_flag = '0' order by b.id limit 1) chgCompanyInfoArchiveStatus,
(SELECT b.id from bu_mcht_license_chg b where b.mcht_id = a.id and b.del_flag = '0' order by b.id desc limit 1) mchtLicenseChgId,
(SELECT b.archive_status from bu_mcht_license_chg b where b.mcht_id = a.id and b.del_flag = '0' order by b.id desc limit 1) mchtLicenseChgLicenseArchiveStatus,
(SELECT b.total_amt FROM bu_mcht_deposit b where b.mcht_id = a.id and b.del_flag = '0') totalAmt,
(SELECT b.pay_amt FROM bu_mcht_deposit b where b.mcht_id = a.id and b.del_flag = '0') payAmt,
(select s.staff_id from bu_platform_contact s where s.id = (select c.assistant_id from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id and b.mcht_id = a.id and c.contact_type = '1' and b.del_flag='0' and c.del_flag='0' and b.status='1' LIMIT 1)) as assistantId,
(select c.staff_id from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id and b.mcht_id = a.id and c.contact_type = '1' and b.del_flag='0' and c.del_flag='0' and b.status='1' LIMIT 1) zsStaffId,
(select c.staff_id from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id and b.mcht_id = a.id and c.contact_type = '7' and b.del_flag='0' and c.del_flag='0' and b.status='1' LIMIT 1)fwStaffId,
(select s.staff_id from bu_platform_contact s where s.id = (select c.assistant_id from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id and b.mcht_id = a.id and c.contact_type = '7' and b.del_flag='0' and c.del_flag='0' and b.status='1' LIMIT 1)) as fwAssistantId,
(select c.staff_id from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id and b.mcht_id = a.id and c.contact_type = '2' and b.del_flag='0' and c.del_flag='0' and b.status='1' LIMIT 1)yyStaffId,
(select s.staff_id from bu_platform_contact s where s.id = (select c.assistant_id from bu_platform_contact c,bu_mcht_platform_contact b where c.id = b.platform_contact_id and b.mcht_id = a.id and c.contact_type = '2' and b.del_flag='0' and c.del_flag='0' and b.status='1' LIMIT 1)) as yyAssistantId
	</sql>
    <select id="selectZSRenewalDetailByExample" parameterType="com.jf.entity.MchtInfoExample"
            resultType="java.util.Map">
        select t.*, CONCAT(convert(ifnull(convert(returnGoods/salesVolume,decimal(10,4))*100,0),decimal(10,2)),'%') as
        returnGoodsRate,
        CONCAT(convert(ifnull(convert(interventionOrder/customerServiceOrder,decimal(10,4))*100,0),decimal(10,2)),'%')
        as
        interventionOrderRate,CONCAT(convert(ifnull(convert(appealOrder/completeGoods,decimal(10,4))*100,0),decimal(10,2)),'%')
        as appealOrderRate
        from(
        select
        <if test="distinct">
            distinct
        </if>
        <include refid="ZS_Renewal_Detail_List"/>
        from bu_mcht_info a
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
        ) t
    </select>

    <select id="selectLegalSpotCheck" resultType="java.util.Map" parameterType="java.util.Map">
        SELECT * FROM
        (SELECT DISTINCT m.id,m.mcht_code mchtCode,m.company_name name,m.shop_name shopName,
        (SELECT d.id FROM bu_mcht_product_type c, bu_product_type d WHERE c.mcht_id=m.id AND c.del_flag='0' AND
        c.product_type_id=d.id AND d.del_flag = '0' AND c.is_main='1' AND c.status='1' AND d.status='1') productTypeId,
        (SELECT GROUP_CONCAT(d.name SEPARATOR ',') FROM bu_mcht_product_type c, bu_product_type d WHERE c.mcht_id=m.id
        AND c.del_flag='0' AND c.product_type_id=d.id AND d.del_flag=0 AND c.is_main='1' AND c.status='1' AND
        d.status='1') productType,
        (SELECT contact_name FROM bu_platform_contact WHERE id IN (SELECT platform_contact_id FROM
        bu_mcht_platform_contact WHERE mcht_id = m.id AND STATUS='1' AND del_flag='0' ) AND contact_type = '2' AND
        del_flag='0' AND STATUS='0' AND del_flag = '0')yy_contact_name,
        (SELECT COUNT(sku) FROM bu_product_item WHERE product_id IN (SELECT id FROM bu_product WHERE mcht_id = m.id AND
        brand_id IN(SELECT product_brand_id FROM bu_mcht_product_brand mpb LEFT JOIN bu_product_brand pb ON
        mpb.product_brand_id = pb.id WHERE mpb.mcht_id = m.id AND mpb.STATUS = '1' AND mpb.audit_status = '3' AND
        mpb.del_flag = '0' AND pb.status = '1' AND pb.del_flag = '0') AND STATUS = '1' AND del_flag = '0') AND del_flag
        = '0')skuTotal,
        (SELECT (COALESCE(SUM(d.pay_amount),0)-(SELECT COALESCE(SUM(amount),0) FROM bu_customer_service_order WHERE
        order_dtl_id IN (SELECT id FROM bu_order_dtl WHERE sub_order_id IN(SELECT id FROM bu_sub_order WHERE mcht_id =
        m.id AND STATUS = '3' AND del_flag = '0') AND del_flag = '0') AND service_type IN ('A','B') AND STATUS = '1' AND
        del_flag = '0')) totalSales FROM bu_sub_order s, bu_order_dtl d WHERE s.id = d.sub_order_id AND mcht_id = m.id
        AND s.status = '3' AND s.del_flag = '0' AND d.product_status = '1' AND d.del_flag = '0' )totalSales,
        (SELECT contact_name FROM bu_platform_contact WHERE id IN (SELECT platform_contact_id FROM
        bu_mcht_platform_contact WHERE mcht_id = m.id AND STATUS='1' AND del_flag='0' ) AND contact_type = '7' AND
        del_flag='0' AND STATUS='0')totalAuditBy,
        (SELECT staff_id FROM bu_platform_contact WHERE id IN (SELECT platform_contact_id FROM bu_mcht_platform_contact
        WHERE mcht_id = m.id AND STATUS='1' AND del_flag='0' ) AND contact_type = '7' AND del_flag='0' AND
        STATUS='0')auditByStaffId
        FROM
        bu_mcht_info m LEFT JOIN bu_mcht_product_brand p ON m.id = p.mcht_id
        WHERE
        m.STATUS = '1' AND m.del_flag = '0' AND p.status = '1' AND p.audit_status = '3') tab
        <if test="productType != null">
            where tab.productTypeId = #{productType}
        </if>
        <if test="staffID != null">
            and tab.auditByStaffId = #{staffID}
        </if>
        ORDER BY tab.totalSales DESC,tab.id ASC
        <if test="limitStart != null and limitStart>=0">
            limit #{limitStart} , #{limitSize}
        </if>
    </select>


    <!--查询店铺流量报表数据-->
    <select id="getShopFlowReportData"  parameterType="java.util.HashMap"  resultMap="BaseResultCustomMap">
        SELECT
        a.id,
        a.mcht_code,
        a.shop_name,
        IFNULL(t.member_visitors_num,0) as member_visitors_num,
        IFNULL(t.unmember_visitors_num,0) as unmember_visitors_num,
        IFNULL(t.member_page_view,0) as member_page_view,
        IFNULL(t.unmember_page_view,0) as unmember_page_view,
        IFNULL(t.pay_money,0) as pay_money,
        IFNULL(t.payment_amount,0) as payment_amount,
        IFNULL(t.add_product_num,0) as add_product_num,
        IFNULL(t.submit_order_num,0) as submit_order_num,
        t.add_product_rate,
        t.submit_order_rate,
        t.payment_rate
        FROM
        bu_mcht_info a
        LEFT JOIN

        (select

        m.mcht_id,
        m.member_visitors_num,
        m.unmember_visitors_num,
        m.member_page_view,
        m.unmember_page_view,
        m.pay_money  ,
        m.payment_amount,
        sum(m.add_product_num) as add_product_num,
        sum(m.submit_order_num) as submit_order_num,
        CONCAT(ROUND(SUM(add_product_num)/(SUM(member_visitors_num)+SUM(unmember_visitors_num))*100,2),'%') AS add_product_rate,
        CONCAT(ROUND(SUM(submit_order_num)/(SUM(member_visitors_num)+SUM(unmember_visitors_num))*100,2),'%') AS submit_order_rate,
        CONCAT(ROUND(SUM(payment_amount)/(SUM(member_visitors_num)+SUM(unmember_visitors_num))*100,2),'%') AS payment_rate
        from
        (
        select
        bmps.mcht_id as mcht_id,
        bmps.total_visitor_count as member_visitors_num,
        bmps.total_visitor_count_tourist as  unmember_visitors_num,
        bmps.total_pv_count as member_page_view ,
        bmps.total_pv_count_tourist as unmember_page_view,
        bmps.pay_sub_order_count as payment_amount,
        bmps.pay_amount as pay_money,
        0 as add_product_num,
        0 as submit_order_num
        from
        bu_mcht_pv_statistical bmps
        WHERE bmps.del_flag ='0'
        AND bmps.create_date <![CDATA[ >= ]]>#{payBegin}
        AND bmps.create_date <![CDATA[ <= ]]>#{payEnd}
        GROUP BY
        bmps.mcht_id

        UNION

        SELECT
        bmp.mcht_id as mcht_id,
        0 as member_visitors_num,
        0 as  unmember_visitors_num,
        0 as member_page_view ,
        0 as unmember_page_view,
        0 as payment_amount,
        0 as pay_money,
        SUM(bsc.quantity) as add_product_num,
        0 as submit_order_num
        FROM
        bu_member_action bma,
        bu_shopping_cart bsc,
        bu_member_pv bmp
        WHERE
        bma.member_pv_id = bmp.pv_id
        AND bsc.id = bma.action_item_id
        AND bma.action_type ='14'
        AND bmp.mcht_id is not NULL
        AND  bmp.del_flag='0'
        AND  bsc.del_flag='0'
        AND  bma.del_flag='0'
        AND bmp.create_date <![CDATA[ >= ]]>#{payBegin}
        AND bmp.create_date <![CDATA[ <= ]]>#{payEnd}
        GROUP BY bmp.mcht_id

        UNION

        SELECT
        bmp.mcht_id as mcht_id,
        0 as member_visitors_num,
        0 as  unmember_visitors_num,
        0 as member_page_view ,
        0 as unmember_page_view,
        0 as payment_amount,
        0 as pay_money,
        0 as add_product_num,
        sum(bod.quantity) as submit_order_num
        FROM
        bu_member_action bma,
        bu_shopping_cart bsc,
        bu_member_pv bmp ,
        bu_order_dtl bod
        WHERE
        bmp.pv_id = bma.member_pv_id
        AND bma.action_item_id = bsc.id
        AND bsc.order_dtl_id = bod.id
        AND bmp.mcht_id is not null
        AND bma.action_type IN ('14', '15')
        AND bod.del_flag = '0'
        AND  bmp.del_flag='0'
        AND  bsc.del_flag='0'
        AND  bma.del_flag='0'
        AND bmp.create_date <![CDATA[ >= ]]>#{payBegin}
        AND bmp.create_date <![CDATA[ <= ]]>#{payEnd}
        GROUP BY bmp.mcht_id
        ) m
        GROUP BY m.mcht_id
        ) t
        on a.id = t.mcht_id

        where
        a.del_flag ='0'
        and a.status = '1'

        <if test="mchtCode != null" >
            AND a.mcht_code = #{mchtCode}
        </if>

        <if test="mchtName != null" >
            AND EXISTS(select x.id from bu_mcht_info x where x.del_flag = '0' and x.id = a.id and (x.short_name like  #{mchtName} or x.shop_name like #{mchtName}  or x.company_name like  #{mchtName} ))
        </if>

        <if test="productTypeId != null" >
            AND EXISTS(SELECT mpt.id FROM bu_mcht_product_type mpt WHERE mpt.del_flag = '0' AND mpt.is_main = '1' AND mpt.status = '1' AND mpt.mcht_id = a.id AND mpt.product_type_id = #{productTypeId}  )
        </if>

        <if test="reportColumnId != null" >
            AND EXISTS (select bmp.value_id from bu_member_pv bmp where bmp.mcht_id = a.id and bmp.column_type = #{reportColumnId})
        </if>

        ORDER BY a.id

        <if test="limitSize!=null and limitSize!=null">
            LIMIT #{limitStart},#{limitSize}
        </if>
    </select>

</mapper>